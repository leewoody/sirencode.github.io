<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/6/index.html">
<meta property="og:site_name" content="Hexo">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-AccessibilityService 辅助类实现系统监听" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/14/AccessibilityService 辅助类实现系统监听/" class="article-date">
  <time datetime="2016-11-13T16:00:00.000Z" itemprop="datePublished">2016-11-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/14/AccessibilityService 辅助类实现系统监听/">AccessibilityService</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="AccessibilityService简介"><a href="#AccessibilityService简介" class="headerlink" title="AccessibilityService简介"></a>AccessibilityService简介</h3><p>AccessibilityService运行在后台,并且能够收到由系统发出的一些事件(AccessibilityEvent,这些事件表示用户界面一系列的状态变化),比如焦点改变，收到通知，输入内容变化,按钮被点击了等等,该种服务能够请求获取当前活动窗口并查找其中的内容.换言之,界面中产生的任何变化都会产生一个时间,并由系统通知给AccessibilityService.这就像监视器监视着界面的一举一动,一旦界面发生变化,立刻发出警报.</p>
<p>最典型的例子就是自动抢红包，就是监听的系统通知，之后处理的。</p>
<h3 id="使用AccessibilityService"><a href="#使用AccessibilityService" class="headerlink" title="使用AccessibilityService"></a>使用AccessibilityService</h3><h4 id="新建服务类"><a href="#新建服务类" class="headerlink" title="新建服务类"></a>新建服务类</h4><p>新建SysListenerService服务，并实现关键方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SysListenerService</span> <span class="keyword">extends</span> <span class="title">AccessibilityService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAccessibilityEvent</span><span class="params">(AccessibilityEvent event)</span> </span>&#123;   &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onInterrupt</span><span class="params">()</span> </span>&#123;  &#125;  </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>常用方法解析：</p>
<ul>
<li>onServiceConnected() 系统成功绑定该服务时被触发,也就是当你在设置中开启相应的服务,系统成功的绑定了该服务时会触发,通常我们可以在这里做一些初始化操作</li>
<li>setServiceInfo(AccessibilityServiceInfo info) 设置当前服务的配置信息</li>
<li>getSeviceInfo() 获取当前服务的配置信息</li>
<li>onAccessibilityEvent(AccessibilityEvent event) 必须，有关AccessibilityEvent事件的回调函数.系统通过sendAccessibiliyEvent()不断的发送AccessibilityEvent到此处。我们在此处过滤发来的事件，并对特定事件进行处理。</li>
<li>onInterrupt()  必须。这个在系统想要中断AccessibilityService返给的响应时会调用。在整个生命周期里会被调用多次。</li>
<li>disableSelf() 禁用当前服务,也就是在服务可以通过该方法停止运行</li>
</ul>
<h4 id="配置AndroidManifest"><a href="#配置AndroidManifest" class="headerlink" title="配置AndroidManifest"></a>配置AndroidManifest</h4><ul>
<li><p>配置<intent-filter>,其name为固定的:</intent-filter></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android.accessibilityservice.AccessibilityService</span><br></pre></td></tr></table></figure>
</li>
<li><p>声明BIND_ACCESSIBILITY_SERVICE权限,以便系统能够绑定该服务(4.0版本后要求)</p>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;service</span><br><span class="line">        android:name=<span class="string">".SysListenerService"</span></span><br><span class="line">        android:enabled=<span class="string">"true"</span></span><br><span class="line">        android:exported=<span class="string">"true"</span>    </span><br><span class="line">        android:permission=<span class="string">"android.permission.BIND_ACCESSIBILITY_SERVICE"</span>&gt;</span><br><span class="line">    &lt;intent-filter&gt;</span><br><span class="line">        &lt;action android:name=<span class="string">"android.accessibilityservice.AccessibilityService"</span>/&gt;</span><br><span class="line">    &lt;/intent-filter&gt;</span><br><span class="line">&lt;/service&gt;</span><br></pre></td></tr></table></figure>
<h4 id="服务参数设置"><a href="#服务参数设置" class="headerlink" title="服务参数设置"></a>服务参数设置</h4><p>在AndroidManifest.xml声明了该服务之后,接下来就是需要对该服务进行一些参数设置了.该服务能够被配置用来接受指定类型的事件,监听指定package,检索窗口内容,获取事件类型的时间等等.目前有两种配置方法:</p>
<ul>
<li>方法一:4.0之后提供了可以通过<meta-data>标签进行配置</meta-data></li>
<li>方法二:通过setServiceInfo()进行配置</li>
</ul>
<h5 id="通过进行配置"><a href="#通过进行配置" class="headerlink" title="通过进行配置"></a>通过<meta-data>进行配置</meta-data></h5><p>在AndroidManifest.xml生命的的service中提供一个meta-data标签,然后通过android:resource指定相应的配置文件(在res目录下创建xml文件,并在其中创建配置文件accessibility.xml)</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;service</span><br><span class="line">    android:name=<span class="string">".SysListenerService"</span></span><br><span class="line">    android:enabled=<span class="string">"true"</span></span><br><span class="line">    android:exported=<span class="string">"true"</span></span><br><span class="line">    android:permission=<span class="string">"android.permission.BIND_ACCESSIBILITY_SERVICE"</span>&gt;</span><br><span class="line">    &lt;intent-filter&gt;</span><br><span class="line">        &lt;action android:name=<span class="string">"android.accessibilityservice.AccessibilityService"</span>/&gt;</span><br><span class="line">        &lt;/intent-filter&gt;</span><br><span class="line"></span><br><span class="line">    &lt;meta-data</span><br><span class="line">        android:name=<span class="string">"android.accessibilityservice"</span></span><br><span class="line">        android:resource=<span class="string">"@xml/accessibility"</span>/&gt;</span><br><span class="line">&lt;/service&gt;</span><br></pre></td></tr></table></figure>
<p>accessibility.xml的相关配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">accessibility-service</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag"><span class="attr">android:accessibilityEventTypes</span>=<span class="string">"typeNotificationStateChanged|typeWindowStateChanged|typeWindowContentChanged"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:accessibilityFeedbackType</span>=<span class="string">"feedbackGeneric"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:accessibilityFlags</span>=<span class="string">"flagDefault"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:canRetrieveWindowContent</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:notificationTimeout</span>=<span class="string">"100"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:packageNames</span>=<span class="string">"com.tencent.mm"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>后面,我们在只需要仿照该配置文件根据自己的需求进行修改即可.下面我们会对这些属性进行介绍.</p>
<p>要设置    android:canRetrieveWindowContent=”true”<br>属性，不然getRootInActiveWindow()会拿不到值和getsource()失败。</p>
<h5 id="通过setServiceInfo-AccessibilityServiceInfo-info"><a href="#通过setServiceInfo-AccessibilityServiceInfo-info" class="headerlink" title="通过setServiceInfo(AccessibilityServiceInfo info)"></a>通过setServiceInfo(AccessibilityServiceInfo info)</h5><p>也可以通过setServiceInfo(AccessibilityServiceInfo)为其配置信息,除此之外,通过该方法可以在运行期间动态修改服务配置.需要注意,该方法只能用来配置动态属性:eventTypes,feedbackType,flags,notificaionTimeout及packageNames.</p>
<p>通常是在onServiceConnected()进行配置,如下代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    AccessibilityServiceInfo serviceInfo = <span class="keyword">new</span> AccessibilityServiceInfo();</span><br><span class="line">    serviceInfo.eventTypes = AccessibilityEvent.TYPES_ALL_MASK;</span><br><span class="line">    serviceInfo.feedbackType = AccessibilityServiceInfo.FEEDBACK_GENERIC;</span><br><span class="line">    serviceInfo.packageNames = <span class="keyword">new</span> String[]&#123;<span class="string">"com.tencent.mm"</span>&#125;; </span><br><span class="line">    serviceInfo.notificationTimeout=<span class="number">100</span>;</span><br><span class="line">    setServiceInfo(serviceInfo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在我们对配置中的重要属性进行说明:</p>
<ul>
<li>accessibilityEventTypes:表示该服务对界面中的哪些变化感兴趣,即哪些事件通知,比如窗口打开,滑动,焦点变化,长按等.具体的值可以在AccessibilityEvent类中查到,如typeAllMask表示接受所有的事件通知.</li>
<li>accessibilityFeedbackType:表示反馈方式,比如是语音播放,还是震动</li>
<li>canRetrieveWindowContent:表示该服务能否访问活动窗口中的内容.也就是如果你希望在服务中获取窗体内容的化,则需要设置其值为true.</li>
<li>notificationTimeout:接受事件的时间间隔,通常将其设置为100即可.</li>
<li>packageNames:表示对该服务是用来监听哪个包的产生的事件</li>
</ul>
<h4 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h4><p>当我们做完以上操作,便可将app安装到手机.安装成功后,在设置-&gt;辅助功能中便可以找到我们的服务.该服务默认处在关闭状态,需要手动开启.</p>
<h4 id="过滤事件信息"><a href="#过滤事件信息" class="headerlink" title="过滤事件信息"></a>过滤事件信息</h4><p>这里我们对AccessibilityEvent进行简单的说明:<br>当用户发生发生变化时,系统会发送一系列的AccessibilityEvent事件,比如按钮被点击时会发送TYPE_VIEW_CLICKED类型的事件.</p>
<ul>
<li>getRootInActiveWindow() 如果配置能够获取窗口内容,则会返回当前活动窗口的根结点</li>
<li>getEventType()      事件类型</li>
<li>getSource() 获取事件源对应的结点信息</li>
<li>getClassName() 获取事件源对应类的类型,比如点击事件是有某个Button产生的,那么此时获取的就是Button的完整类名</li>
<li>getText() 获取事件源的文本信息,比如事件是有TextView发出的,此时获取的就是TextView的text属性.如果该事件源是树结构,那么此时获取的是这个树上所有具有text属性的值的集合</li>
<li>isEnabled() 事件源(对应的界面控件)是否处在可用状态</li>
<li>getItemCount()如果事件源是树结构,将返回该树根节点下子节点的数量</li>
</ul>
<h4 id="服务的生命周期"><a href="#服务的生命周期" class="headerlink" title="服务的生命周期"></a>服务的生命周期</h4><p>要理解该中服务的生命周期只需要记住一下三点即可:</p>
<ul>
<li>该种服务完全由系统管理,并遵循已有的服务周期.</li>
<li>开启一个服务只能由用户在设置中打开,而关闭则只能由用户在设置中关闭或者服务本身通过diableSelf()方法关闭(当然,现在有些第三放软件也可以强制关闭该类型服务)</li>
<li>系统绑定该服务之后,会调用onServiceConnected()方法,这个方法可以被重写,在其中,你可以做一些初始化的操作.</li>
</ul>
<h4 id="检测服务是否开启"><a href="#检测服务是否开启" class="headerlink" title="检测服务是否开启"></a>检测服务是否开启</h4><p>方法一:借助服务管理器AccessibilityManager来判断,但是该方法不能检测app本身开启的服务.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">enabled</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        AccessibilityManager am = (AccessibilityManager) getSystemService(Context.ACCESSIBILITY_SERVICE);</span><br><span class="line">        List&lt;AccessibilityServiceInfo&gt; serviceInfos = am.getEnabledAccessibilityServiceList(AccessibilityServiceInfo.FEEDBACK_GENERIC);</span><br><span class="line">        List&lt;AccessibilityServiceInfo&gt; installedAccessibilityServiceList = am.getInstalledAccessibilityServiceList();</span><br><span class="line">        <span class="keyword">for</span> (AccessibilityServiceInfo info : installedAccessibilityServiceList) &#123;</span><br><span class="line">            Log.d(<span class="string">"MainActivity"</span>, <span class="string">"all --&gt;"</span> + info.getId());</span><br><span class="line">            <span class="keyword">if</span> (name.equals(info.getId())) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>方法二:我们知道大部分的系统属性都在settings中进行设置,比如wifi,蓝牙状态等,而这些信息主要是存储在settings对应的的数据库中(system表和serure表),这就意味我们可以通过直接读取setting设置来判断相关服务是否开启:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">checkStealFeature1</span><span class="params">(String service)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ok = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ok = Settings.Secure.getInt(getApplicationContext().getContentResolver(), Settings.Secure.ACCESSIBILITY_ENABLED);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Settings.SettingNotFoundException e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        TextUtils.SimpleStringSplitter ms = <span class="keyword">new</span> TextUtils.SimpleStringSplitter(<span class="string">':'</span>);</span><br><span class="line">        <span class="keyword">if</span> (ok == <span class="number">1</span>) &#123;</span><br><span class="line">            String settingValue = Settings.Secure.getString(getApplicationContext().getContentResolver(), Settings.Secure.ENABLED_ACCESSIBILITY_SERVICES);</span><br><span class="line">            <span class="keyword">if</span> (settingValue != <span class="keyword">null</span>) &#123;</span><br><span class="line">                ms.setString(settingValue);</span><br><span class="line">                <span class="keyword">while</span> (ms.hasNext()) &#123;</span><br><span class="line">                    String accessibilityService = ms.next();</span><br><span class="line">                    <span class="keyword">if</span> (accessibilityService.equalsIgnoreCase(service)) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<h4 id="一些实用案例"><a href="#一些实用案例" class="headerlink" title="一些实用案例"></a>一些实用案例</h4><p>抢红包插件：</p>
<ul>
<li>状态栏出现”[微信红包]”的消息提示,点击进入聊天界面</li>
<li>点击相应的红包信息,弹出抢红包界面</li>
<li>在抢红包界面点击”开”,打开红包</li>
<li>在红包详情页面,查看详情,点击返回按钮返回微信聊天界面.</li>
</ul>
<h3 id="AccessibilityEvent类型"><a href="#AccessibilityEvent类型" class="headerlink" title="AccessibilityEvent类型"></a>AccessibilityEvent类型</h3><ul>
<li>TYPE_VIEW_CLICKED  点击事件</li>
<li>TYPE_VIEW_LONG_CLICKED 长按事件</li>
<li>TYPE_VIEW_SELECTED 选中</li>
<li>TYPE_VIEW_FOCUSED  获取焦点</li>
<li>TYPE_VIEW_TEXT_CHANGED</li>
<li>TYPE_WINDOW_STATE_CHANGED</li>
<li>TYPE_NOTIFICATION_STATE_CHANGED</li>
<li>TYPE_VIEW_HOVER_ENTER</li>
<li>TYPE_VIEW_HOVER_EXIT</li>
<li>TYPE_TOUCH_EXPLORATION_GESTURE_START</li>
<li>TYPE_TOUCH_EXPLORATION_GESTURE_END</li>
<li>TYPE_WINDOW_CONTENT_CHANGED</li>
<li>TYPE_VIEW_SCROLLED</li>
<li>TYPE_VIEW_TEXT_SELECTION_CHANGED</li>
<li>TYPE_ANNOUNCEMENT</li>
<li>TYPE_VIEW_ACCESSIBILITY_FOCUSED </li>
<li>TYPE_VIEW_ACCESSIBILITY_FOCUS_CLEARED </li>
<li>TYPE_VIEW_TEXT_TRAVERSED_AT_MOVEMENT_GRANULARITY</li>
<li>TYPE_GESTURE_DETECTION_START </li>
<li>TYPE_GESTURE_DETECTION_END </li>
<li>TYPE_TOUCH_INTERACTION_START </li>
<li>TYPE_TOUCH_INTERACTION_END </li>
<li>TYPE_WINDOWS_CHANGED </li>
<li>TYPE_VIEW_CONTEXT_CLICKED</li>
<li>TYPE_ASSIST_READING_CONTEXT</li>
<li>TYPES_ALL_MASK</li>
</ul>
<h3 id="技巧"><a href="#技巧" class="headerlink" title="技巧"></a>技巧</h3><p>在使用辅助功能进行自动化跳转的过程，每个页面的delay事件是一个很头疼的问题，设置的太短自动化容易中断，太长又会影响速度，所以一个合理的延时是非常必要的。</p>
<p>有一个方法可以大大减少页面跳转的事件，就是在开发者选项里面将页面过度动画关掉。</p>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>AccessibilityService的生命周期是由系统来管理的，开启该服务是在Android设备上的设置页面中来开启，关闭该服务也是通过在设置页面来关闭的或者是调用AccessibilityService的disableSelf()方法。通过AIDL进行进程间的通信，主要流程就是系统通过进程间通信机制把事件消息传递给AccessibilityService后调用AccessibilityService的onAccessibilityEvent()方法，在该方法中我们就可以根据事件类型做不同的业务操作了。</p>
<p>辅助事件的响应流程：系统监控view的变化并发给特定的AccessibilityService处理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AccessibilityEventSource</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 发送辅助事件，对参数进行校验 </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendAccessibilityEvent</span><span class="params">(<span class="keyword">int</span> eventType)</span></span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 发送辅助事件，不对参数进行校验 </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendAccessibilityEventUnchecked</span><span class="params">(AccessibilityEvent event)</span></span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>辅助功能的响应元 -&gt;view </li>
<li>AccessibilityEventSource实现了辅助功能发送接口</li>
<li>View的事件源码中实现了AccessibilityEventSource接口,View的onTouchEvent()的ACTION_UP分支中，经过层层判断最后调用了performClick()方法performClick()方法最后调用了sendAccessibilityEvent(事件类型)方法，该方法就是View实现AccessibilityEventSource接口中的方法，那也就是说View被点击后就会向系统发送一个事件类型为AccessibilityEvent.TYPE_VIEW_CLICKED的辅助事件，由此可猜测当点击事件发生后会向系统发送一个辅助事件消息，在系统接收到此消息就会回调注册进系统的各种AccessibilityService服务的onAccessibilityEvent()方法。sendAccessibilityEvent(AccessibilityEvent.TYPE_VIEW_CLICKED);  </li>
</ul>
<p><img src="http://img.blog.csdn.net/20161028134038200?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="图片"></p>
<p>转载 <a href="http://www.jianshu.com/p/4cd8c109cdfb" target="_blank" rel="noopener">简书:你真的理解AccessibilityService吗</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/11/14/AccessibilityService 辅助类实现系统监听/" data-id="cje0yr9pt0005cur9r8rzcf3y" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-mac wifi 暴力破解" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/11/mac wifi 暴力破解/" class="article-date">
  <time datetime="2016-11-10T16:00:00.000Z" itemprop="datePublished">2016-11-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/11/mac wifi 暴力破解/">mac wifi暴力破解</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="破解介绍"><a href="#破解介绍" class="headerlink" title="破解介绍"></a>破解介绍</h3><p>将WiFi设置成监听模式，自后攻击掉线，抓重新登录的包，然后用字典暴力破解。</p>
<h3 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h3><h4 id="安装MacPorts"><a href="#安装MacPorts" class="headerlink" title="安装MacPorts"></a>安装MacPorts</h4><p>MacPorts <a href="https://guide.macports.org/" target="_blank" rel="noopener">官网地址</a></p>
<p>下载安装，并设置环境变量。</p>
<h4 id="安装aircrack-ng"><a href="#安装aircrack-ng" class="headerlink" title="安装aircrack-ng"></a>安装aircrack-ng</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo port install aircrack-ng</span><br></pre></td></tr></table></figure>
<p>如果提示安装xcode插件，先安装插件。</p>
<h4 id="断开电脑所有的wifi连接"><a href="#断开电脑所有的wifi连接" class="headerlink" title="断开电脑所有的wifi连接"></a>断开电脑所有的wifi连接</h4><h4 id="查看周围的wifi"><a href="#查看周围的wifi" class="headerlink" title="查看周围的wifi"></a>查看周围的wifi</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ /System/Library/PrivateFrameworks/Apple80211.framework/Versions/Current/Resources/airport -s</span><br></pre></td></tr></table></figure>
<h4 id="抓包"><a href="#抓包" class="headerlink" title="抓包"></a>抓包</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo /System/Library/PrivateFrameworks/Apple80211.framework/Versions/Current/Resources/airport en0 sniff 6</span><br></pre></td></tr></table></figure>
<p>en0是无线网卡设备；6是要破解wifi的CHANNEL。</p>
<p>静等用户连接wifi，获得握手包。</p>
<p>抓的包，保存在/tmp *.cap：</p>
<h4 id="破解wifi密码"><a href="#破解wifi密码" class="headerlink" title="破解wifi密码"></a>破解wifi密码</h4><p>为了方便将字典和 *.cap文件放到一起。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ aircrack-ng -w text.txt airportSniffyuZPBA.cap</span><br></pre></td></tr></table></figure>
<p>按照提示输入要破解的WIFI对应的编号即可</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/11/11/mac wifi 暴力破解/" data-id="cje0yr9qw0019cur9r10s52s0" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Coding Dojo - 代码道场" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/10/Coding Dojo - 代码道场/" class="article-date">
  <time datetime="2016-11-09T16:00:00.000Z" itemprop="datePublished">2016-11-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/10/Coding Dojo - 代码道场/">Coding Dojo 代码道场</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>Coding Dojo是一个学习的过程。一些程序员（通常是15-20人）在一起编程解决一个程序问题。一边编程，一边互相学习。每个人可以从Coding Dojo中学到：解决问题的思路、编程技巧、面向对象设计、演进式设计、结对编程、测试驱动开发、持续集成等等。其实即使从别人犯的错误中，我们也能够学到很多。</p>
<h3 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h3><ul>
<li><p>Coding Dojo以及原则介绍 – 5分钟</p>
</li>
<li><p>问题介绍 – 10分钟</p>
</li>
<li><p>2个时段的结对编程 – 20分钟 × 2</p>
</li>
<li><p>中断（所有人一起讨论一下当前的解决方案，以及下一步方案，注意事项）- 10分钟</p>
</li>
<li><p>2个时段的结对编程 – 20分钟 × 2</p>
</li>
<li><p>反省 – 10分钟</p>
</li>
</ul>
<h3 id="会议室组织方式"><a href="#会议室组织方式" class="headerlink" title="会议室组织方式"></a>会议室组织方式</h3><p>在会议室中间有两个人结对编程，一个是驾驶员(Pilot)，另一个是领航员(Co-pilot, Navigator)。周围坐的都是顾问(Advisor, Sensei)，前面是投影仪。</p>
<h4 id="Coding-Dojo中的角色"><a href="#Coding-Dojo中的角色" class="headerlink" title="Coding Dojo中的角色"></a>Coding Dojo中的角色</h4><ul>
<li><p>教练(coach)帮助维护秩序，引导大家</p>
</li>
<li><p>驾驶员(Pilot)：负责具体实现，边写代码，边要把自己的设计意图大声说出来</p>
</li>
<li><p>领航员(Co-pilot)：负责帮助驾驶员进行设计，负责控制设计的战略方向</p>
</li>
<li><p>顾问(Advisor)：坐在周围，通过投影仪观察当前的进展，可以提出问题，但是不能给出方案。驾驶员与领航员必须先回答顾问的所有问题，才能继续写代码。</p>
</li>
</ul>
<h3 id="一些原则"><a href="#一些原则" class="headerlink" title="一些原则"></a>一些原则</h3><ul>
<li><p>不要讨论太多，先写代码</p>
</li>
<li><p>写代码之前，先写测试</p>
</li>
<li><p>每个人都能从其他人身上学到东西，哪怕是错误</p>
</li>
<li><p>所有人参与写代码</p>
</li>
<li><p>如果你知道好的方案，分享给大家</p>
</li>
<li><p>顾问只能问问题，不能提方案，驾驶员和导航员必须回答所有问题</p>
</li>
</ul>
<h3 id="建议"><a href="#建议" class="headerlink" title="建议"></a>建议</h3><ul>
<li><p>导航员应该更多帮助驾驶员</p>
</li>
<li><p>在同一个时段内导航员和驾驶员应该多切换，当然另一个方案是每次替换</p>
</li>
<li><p>结对的时候，替换导航员，然后让原来的驾驶员成为导航员引导下一个驾驶员</p>
</li>
<li><p>顾问应该保持耐心，减少对驾驶员和导航员的干扰</p>
</li>
<li><p>减少私下讨论</p>
</li>
<li><p>驾驶员应该大声把设计意图说给大家听</p>
</li>
<li><p>实现的Test Case应该事先明确</p>
</li>
<li><p>每个人应该尊重驾驶员和导航员，虚心学习</p>
</li>
<li><p>使用代码库</p>
</li>
<li><p>频繁签入代码</p>
</li>
<li><p>重构不够</p>
</li>
<li><p>每个人做驾驶员的时候使用自己的环境，使用熟悉的工具。其他人也可以学习他的技巧以及工具</p>
</li>
<li><p>重构的时候，跳跃太大</p>
</li>
<li><p>使用标准键盘</p>
</li>
<li><p>更多的面向对象设计</p>
</li>
<li><p>使用Pomodomo作为时间箱，但是使用一个Range（20分钟 +/- 五分钟）而不是一个点</p>
</li>
<li><p>鼓励每个人参与</p>
</li>
<li><p>教练确保会议秩序</p>
</li>
<li><p>替换结对的时候确保所有的测试通过。</p>
</li>
</ul>
<p><a href="http://www.danielteng.com/2011/03/15/coding-doj/" target="_blank" rel="noopener">转载自</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/11/10/Coding Dojo - 代码道场/" data-id="cje0yr9pz000acur9mh1hu0bi" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-vector drawable" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/03/vector drawable/" class="article-date">
  <time datetime="2016-11-02T16:00:00.000Z" itemprop="datePublished">2016-11-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/03/vector drawable/">Vector Drawable</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>矢量图形是计算机图形学中用点、直线或者多边形等基于数学方程的几何图元表示图像。矢量图形与使用像素表示图像的位图不同。也就是说矢量图其实是一个xml文件，文件里面涉及到一些绘制的属性。</p>
<h3 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h3><h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><ul>
<li>1 保存最少的信息，文件大小比位图要小，并且文件大小与物体的大小无关</li>
<li>2 在图像处理软件中，任意放大矢量图形，不会丢失细节或影响清晰度，因为矢量图形是与分辨率无关的。无限地放大这个圆，它仍然保持平滑；用多边形表示的曲线将会显现出不是真正的曲线</li>
</ul>
<h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><ul>
<li>android 版本兼容问题，矢量图的使用最低支持5.0以上系统。</li>
<li>要在低版本上使用矢量图，需要在项目中引入新的兼容库support-vector-drawable，并且appcompat-v7库的版本要在23.2.0+(写文章这会23.2.1已经发布了)。</li>
</ul>
<h3 id="使用矢量图"><a href="#使用矢量图" class="headerlink" title="使用矢量图"></a>使用矢量图</h3><h4 id="版本兼容"><a href="#版本兼容" class="headerlink" title="版本兼容"></a>版本兼容</h4><p>导入兼容包：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile 'com.android.support:appcompat-v7:23.2.0+'</span><br></pre></td></tr></table></figure>
<h4 id="AS配置"><a href="#AS配置" class="headerlink" title="AS配置"></a>AS配置</h4><p>AS版本低于2.0的：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">  defaultConfig &#123;</span><br><span class="line">    // 不让gradle自动生成不同屏幕分辨率的png图</span><br><span class="line">    generatedDensities = []</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  aaptOptions &#123;</span><br><span class="line">    additionalParameters "--no-version-vectors"</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>AS2.0+:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">  defaultConfig &#123;</span><br><span class="line">    vectorDrawables.useSupportLibrary = true</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="在drawable目录下创建矢量图文件"><a href="#在drawable目录下创建矢量图文件" class="headerlink" title="在drawable目录下创建矢量图文件"></a>在drawable目录下创建矢量图文件</h4><p>具体代码如下，但是一般不需要手动写，一般通过AI或者PS软件生产的。</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;vector xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
android:width=&quot;24dp&quot;
android:height=&quot;24dp&quot;
android:viewportHeight=&quot;24&quot;
android:viewportWidth=&quot;24&quot;&gt;
&lt;path
    android:name=&quot;toe1&quot;
    android:fillColor=&quot;#ffffff&quot;
    android:pathData=&quot;M 4.5 7 C 5.88071187458 7 7 8.11928812542 7 9.5 C 7 10.8807118746 5.88071187458 12 4.5 12 C 3.11928812542 12 2 10.8807118746 2 9.5 C 2 8.11928812542 3.11928812542 7 4.5 7 Z&quot; /&gt;
&lt;path
    android:name=&quot;toe2&quot;
    android:fillColor=&quot;#ffffff&quot;
    android:pathData=&quot;M 9 3 C 10.3807118746 3 11.5 4.11928812542 11.5 5.5 C 11.5 6.88071187458 10.3807118746 8 9 8 C 7.61928812542 8 6.5 6.88071187458 6.5 5.5 C 6.5 4.11928812542 7.61928812542 3 9 3 Z&quot; /&gt;
&lt;path
    android:name=&quot;toe3&quot;
    android:fillColor=&quot;#ffffff&quot;
    android:pathData=&quot;M 15 3 C 16.3807118746 3 17.5 4.11928812542 17.5 5.5 C 17.5 6.88071187458 16.3807118746 8 15 8 C 13.6192881254 8 12.5 6.88071187458 12.5 5.5 C 12.5 4.11928812542 13.6192881254 3 15 3 Z&quot; /&gt;
&lt;path
    android:name=&quot;toe4&quot;
    android:fillColor=&quot;#ffffff&quot;
    android:pathData=&quot;M 19.5 7 C 20.8807118746 7 22 8.11928812542 22 9.5 C 22 10.8807118746 20.8807118746 12 19.5 12 C 18.1192881254 12 17 10.8807118746 17 9.5 C 17 8.11928812542 18.1192881254 7 19.5 7 Z&quot; /&gt;
&lt;path
    android:fillColor=&quot;#ffffff&quot;
    android:pathData=&quot;M17.34 14.86c-.87-1.02-1.6-1.89-2.48-2.91-.46-.54-1.05-1.08-1.75-1.32-.11-.04-.22-.07-.33-.09-.25-.04-.52-.04-.78-.04s-.53 0-.79 .05 c-.11 .02 -.22 .05 -.33 .09 -.7 .24 -1.28 .78 -1.75 1.32-.87 1.02-1.6 1.89-2.48 2.91-1.31 1.31-2.92 2.76-2.62 4.79 .29 1.02 1.02 2.03 2.33 2.32 .73 .15 3.06-.44 5.54-.44h.18c2.48 0 4.81 .58 5.54 .44 1.31-.29 2.04-1.31 2.33-2.32 .31 -2.04-1.3-3.49-2.61-4.8z&quot; /&gt;
&lt;/vector&gt;
</code></pre><h4 id="只能用于AppCompatImageView或者AppCompatImageButton或其子类，而且必须在app-srcCompat标签中使用。"><a href="#只能用于AppCompatImageView或者AppCompatImageButton或其子类，而且必须在app-srcCompat标签中使用。" class="headerlink" title="只能用于AppCompatImageView或者AppCompatImageButton或其子类，而且必须在app:srcCompat标签中使用。"></a>只能用于AppCompatImageView或者AppCompatImageButton或其子类，而且必须在app:srcCompat标签中使用。</h4><h4 id="资源使用"><a href="#资源使用" class="headerlink" title="资源使用"></a>资源使用</h4><p>在xml配置文件里面:</p>
<pre><code>&lt;android.support.v7.widget.AppCompatImageView
    android:layout_width=&quot;100dp&quot;
    android:layout_height=&quot;100dp&quot;
    app:srcCompat=&quot;@drawable/vector_icon&quot;
    android:layout_centerVertical=&quot;true&quot;
    android:layout_centerHorizontal=&quot;true&quot;
    android:id=&quot;@+id/imageView&quot; /&gt;
</code></pre><h3 id="生成svg图片"><a href="#生成svg图片" class="headerlink" title="生成svg图片"></a>生成svg图片</h3><p>通过AI和PS都可以生成svg图片（要装插件）。</p>
<h4 id="在线PNG转SVG"><a href="#在线PNG转SVG" class="headerlink" title="在线PNG转SVG"></a>在线PNG转SVG</h4><p>需要注册登录才可以下载转换后格式的文件：</p>
<p><a href="http://vectormagic.com/online/how_it_works" target="_blank" rel="noopener">地址</a></p>
<h4 id="SVG压缩"><a href="#SVG压缩" class="headerlink" title="SVG压缩"></a>SVG压缩</h4><p>记得将SVG文件进行压缩</p>
<p><a href="https://jakearchibald.github.io/svgomg/?utm_source=next.36kr.com" target="_blank" rel="noopener">在线</a></p>
<h4 id="在AS中导入图片"><a href="#在AS中导入图片" class="headerlink" title="在AS中导入图片"></a>在AS中导入图片</h4><p>File -&gt; New -&gt; Vector Asset -&gt; Local SVG files</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/11/03/vector drawable/" data-id="cje0yr9r5001jcur9tkpa1vw5" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-性能优化 - 代码层问题" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/10/27/性能优化 - 代码层问题/" class="article-date">
  <time datetime="2016-10-26T16:00:00.000Z" itemprop="datePublished">2016-10-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/27/性能优化 - 代码层问题/">性能优化 - 代码层问题</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>用stringbuffer代替string</li>
<li>ArrayMap 替代 HashMap</li>
<li>ArraySet 替代 HashSet</li>
<li>SparseArray 替代 HashMap</li>
<li>SparseBooleanArray 替代 HashMap</li>
<li>SparseIntArray 替代 HashMap</li>
<li>SparseLongArray 替代 HashMap</li>
<li>LongSparseArray 替代 HashMap</li>
<li>避免匿名内部类</li>
<li>单例引用问题</li>
<li>io流，bitmap，数据库cursor等资源及时释放</li>
<li>将类、变量、方法等等的可见性修改为最小</li>
<li>尽量少使用fragment和activity(太重)</li>
<li>使用Application的Context</li>
<li>如果程序会频繁创建线程，则可以考虑使用线程池</li>
<li>尽量用色值代替图片</li>
<li>慎用透明度属性图片，大小和内存会极具增加</li>
<li>避免在Android里面使用Enum(因为枚举内存大小是静态碧昂量的两倍)</li>
<li>避免在onDraw方法里面执行对象的创建</li>
<li>注意监听器的注销</li>
<li>注意WebView的泄漏（独立进程）</li>
<li>谨慎使用static对象，因为static的生命周期过长，和应用的进程保持一致，使用不当很可能导致对象泄漏，在Android中应该谨慎使用static对象</li>
<li>常量请用static final来修饰</li>
<li>尽量采用静态内部类，这样可以避免潜在的由于内部类而导致的内存泄漏</li>
<li>在代码中减少反射调用</li>
<li>谨慎使用抽象编程</li>
<li>使用ProGuard来剔除不需要的代码</li>
<li>慎用异常,异常对性能不利</li>
<li>任何一个Java类，包括匿名类、内部类，都要占用大概500字节的内存空间</li>
<li>任何一个类的实例要消耗12-16字节的内存开支，因此频繁创建实例也是会在一定程序上影响内存的</li>
<li>LinearLayout 要比 RelativeLayout占用更小内存</li>
<li>数据不需要序列化的不要序列化，因为数据的序列化和反序列化很费时</li>
<li>代码混淆和资源混淆</li>
<li>使用更小的图片格式webp</li>
<li>将循环变量无关的计算都放到循环外</li>
<li>外提循环内的各种条件判断：比如 if（a &gt; b &amp;&amp; b &gt; c）改为if(conditionX)，循环判断条件的计算，比如i &lt; xxxList.length 改为 i &lt; xxxListLen。</li>
<li>交换内外循环，将次数多的循环放在最内层，将多次全循环合并（可能降低可读性）</li>
<li>布尔逻辑优化，比如!a &amp;&amp; !b 转换为!(a || b) 会减少计算</li>
<li>使用自增、自减表达式</li>
<li>使用尽量简单的数据类型：使用int或long代替long long，使用定点或整数代替浮点数，使单精度代替双精度</li>
<li>尽可能降低数组维度</li>
<li>尽可能减少数组的引用</li>
</ul>
<h4 id="逻辑判断优化"><a href="#逻辑判断优化" class="headerlink" title="逻辑判断优化"></a>逻辑判断优化</h4><ul>
<li>switch 语句按照出现频率排序，让最常用的放在最前面，减少无效判断</li>
<li>if 语句将弱计算的条件放在前面，避免过多的计算（短路规则）</li>
<li>逻辑判断条件转换为与0值比较</li>
<li>使用结果缓存，而不是每次都计算结果</li>
<li>使用查表的方法代替复杂的条件计算</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/10/27/性能优化 - 代码层问题/" data-id="cje0yr9rc001scur93me19oho" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-无线 adb连接" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/10/20/无线 adb连接/" class="article-date">
  <time datetime="2016-10-19T16:00:00.000Z" itemprop="datePublished">2016-10-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/20/无线 adb连接/">Android 无线adb连接</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="打开手机的xxxx端口"><a href="#打开手机的xxxx端口" class="headerlink" title="打开手机的xxxx端口"></a>打开手机的xxxx端口</h4><ul>
<li>确保手机开启了usb调试</li>
<li>用usb线把手机和电脑连接起来</li>
<li>执行命令：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb tcpip 5555</span><br></pre></td></tr></table></figure>
<h4 id="找到手机的IP地址"><a href="#找到手机的IP地址" class="headerlink" title="找到手机的IP地址"></a>找到手机的IP地址</h4><p>一般在 设置-关于手机-状态信息-IP地址可以找到。<br>比如，我这里看到手机的IP地址是192.168.1.242</p>
<h4 id="通过IP地址和端口连接手机"><a href="#通过IP地址和端口连接手机" class="headerlink" title="通过IP地址和端口连接手机"></a>通过IP地址和端口连接手机</h4><p>执行命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb connect 192.168.1.242:xxxx</span><br></pre></td></tr></table></figure>
<p>如果提示 connected to 192.168.1.242:xxxx 表示连接成功</p>
<p>如果提示 unable to connect to 192.168.1.242:xxxx Operation timed out 可能你的IP地址输错了;或者adb服务不可用;或者手机跟电脑没有正确地处在一个局域网中；或者链接被代理Block了等等等…</p>
<p>如果提示 unable to connect to 192.168.1.242:xxxx Connection refused 可能你手机的5555端口没有正确打开；或者有防火墙拦截等…</p>
<h4 id="安装-adb-wifi插件"><a href="#安装-adb-wifi插件" class="headerlink" title="安装 adb wifi插件"></a>安装 adb wifi插件</h4>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/10/20/无线 adb连接/" data-id="cje0yr9ri0020cur9oy7yrnm8" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-清空Android studio配置" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/10/19/清空Android studio配置/" class="article-date">
  <time datetime="2016-10-18T16:00:00.000Z" itemprop="datePublished">2016-10-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/19/清空Android studio配置/">清空Android studio配置</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rm -Rf /Applications/Android\ Studio.app</span><br><span class="line">rm -Rf ~/Library/Preferences/AndroidStudio*</span><br><span class="line">rm ~/Library/Preferences/com.google.android.studio.plist</span><br><span class="line">rm -Rf ~/Library/Application\ Support/AndroidStudio*</span><br><span class="line">rm -Rf ~/Library/Logs/AndroidStudio*</span><br><span class="line">rm -Rf ~/Library/Caches/AndroidStudio*</span><br><span class="line">rm -Rf .AndroidStudio*</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/10/19/清空Android studio配置/" data-id="cje0yr9rj0021cur925sqg3gx" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-gradle 常用配置" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/10/17/gradle 常用配置/" class="article-date">
  <time datetime="2016-10-16T16:00:00.000Z" itemprop="datePublished">2016-10-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/17/gradle 常用配置/">Gradle 常用配置</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Gradle简介"><a href="#Gradle简介" class="headerlink" title="Gradle简介"></a>Gradle简介</h3><p>Gradle 是 Android 现在主流的编译工具，虽然在Gradle 出现之前和之后都有对应更快的编译工具出现，但是 Gradle 的优势就在于它是亲儿子，Gradle 确实比较慢，这和它的编译过程有关，但是现在的Gradle 编译速度已经有了成倍提高。除此之外，相对其他编译工具，最重要的，他和 Android Studio 的关系非常紧密，可以说对于一些简单的程序我们几乎不需要任何代码上的配置只使用 Android Studio 就可以完成编译和运行。</p>
<h3 id="Gradle-编译周期"><a href="#Gradle-编译周期" class="headerlink" title="Gradle 编译周期"></a>Gradle 编译周期</h3><p>在编译过程中， Gradle 会根据 build 相关文件，聚合所有的project和task，执行task 中的 action。因为 build.gradle文件中的task非常多，先执行哪个后执行那个需要一种逻辑来保证。这种逻辑就是依赖逻辑，几乎所有的Task 都需要依赖其他 task 来执行，没有被依赖的task 会首先被执行。所以到最后所有的 Task 会构成一个 有向无环图（DAG Directed Acyclic Graph）的数据结构。</p>
<h3 id="Gradle-文件结构"><a href="#Gradle-文件结构" class="headerlink" title="Gradle 文件结构"></a>Gradle 文件结构</h3><ul>
<li>setting.gradle:这个 setting 文件定义了哪些module 应该被加入到编译过程，对于单个module 的项目可以不用需要这个文件，但是对于 multimodule 的项目我们就需要这个文件，否则gradle 不知道要加载哪些项目。这个文件的代码在初始化阶段就会被执行。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">include ':app', </span><br><span class="line">        ':mymoudlename'//需要编译的模块</span><br></pre></td></tr></table></figure>
<ul>
<li>顶层的build.gradle:顶层的build.gradle文件的配置最终会被应用到所有项目中。</li>
<li>模块中的build.gradle:当前模块的相关配置信息。</li>
<li>gradle/wrapper/gradle-wrapper:gradlw wrapper 包含一些脚本文件和针对不同系统下面的运行文件。wrapper 有版本区分，但是并不需要你手动去下载，当你运行脚本的时候，如果本地没有会自动下载对应版本文件。</li>
</ul>
<h4 id="Gradle-配置项解析"><a href="#Gradle-配置项解析" class="headerlink" title="Gradle 配置项解析"></a>Gradle 配置项解析</h4><h5 id="buildscript"><a href="#buildscript" class="headerlink" title="buildscript"></a>buildscript</h5><p>buildscript：定义了 Android 编译工具的类路径。repositories中,jCenter是一个著名的 Maven 仓库。<br>repositories<br>repositories 就是代码仓库，这个相信大家都知道，我们平时的添加的一些 dependency 就是从这里下载的，Gradle 支持三种类型的仓库：Maven,Ivy和一些静态文件或者文件夹。在编译的执行阶段，gradle 将会从仓库中取出对应需要的依赖文件，当然，gradle 本地也会有自己的缓存，不会每次都去取这些依赖。</p>
<h5 id="allprojects"><a href="#allprojects" class="headerlink" title="allprojects"></a>allprojects</h5><p>allprojects:中定义的属性会被应用到所有 moudle 中，但是为了保证每个项目的独立性，我们一般不会在这里面操作太多共有的东西。</p>
<h5 id="apply-plugin"><a href="#apply-plugin" class="headerlink" title="apply plugin"></a>apply plugin</h5><p>apply plugin:代码中应用了Android 程序的gradle插件，作为Android 的应用程序，这一步是必须的，因为plugin中提供了Android 编译、测试、打包等等的所有task。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: 'com.android.application'</span><br><span class="line">//Application: 对应 com.android.application. 编译的结果是一个 apk</span><br><span class="line">//Android Library: 对应 com.android.library. 编译结果为 aar</span><br><span class="line">//JavaLibrary: 对应的 java. 编译结果为 jar</span><br></pre></td></tr></table></figure>
<h5 id="android"><a href="#android" class="headerlink" title="android"></a>android</h5><p>android:这是编译文件中最大的代码块，关于android 的所有特殊配置都在这里，这就是又我们前面的声明的 plugin 提供的。</p>
<h5 id="defaultConfig"><a href="#defaultConfig" class="headerlink" title="defaultConfig"></a>defaultConfig</h5><p>defaultConfig就是程序的默认配置，注意，如果在AndroidMainfest.xml里面定义了与这里相同的属性，会以这里的为主。多模块程序开发时，建议将这些默认配置信息抽离出来成公共的地方，将项目依赖关系和默认配置信息放到一个配置信息，config.gradle文件里。</p>
<h5 id="buildTypes"><a href="#buildTypes" class="headerlink" title="buildTypes"></a>buildTypes</h5><p>buildTypes:定义了编译类型，针对每个类型我们可以有不同的编译配置，不同的编译配置对应的有不同的编译命令。默认的有debug、release 的类型。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">buildTypes &#123;</span><br><span class="line">        def BOOLEAN = "boolean"</span><br><span class="line">        def TRUE = "true"</span><br><span class="line">        def FALSE = "false"</span><br><span class="line">        def ENV_DEBUG = "ENV_DEBUG"</span><br><span class="line">        def ENABLE_LOG = "ENABLE_LOG"</span><br><span class="line">        def PERFORMANCE_DEBUG = "PERFORMANCE_DEBUG"</span><br><span class="line">        release &#123;</span><br><span class="line">            buildConfigField BOOLEAN, ENV_DEBUG, TRUE</span><br><span class="line">            buildConfigField BOOLEAN, ENABLE_LOG, TRUE</span><br><span class="line">            buildConfigField BOOLEAN, PERFORMANCE_DEBUG,FALSE</span><br><span class="line">            minifyEnabled false</span><br><span class="line">            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'</span><br><span class="line">            signingConfig signingConfigs.config</span><br><span class="line">        &#125;</span><br><span class="line">        releasePro &#123;</span><br><span class="line">            buildConfigField BOOLEAN, ENV_DEBUG, FALSE</span><br><span class="line">            buildConfigField BOOLEAN, ENABLE_LOG, FALSE</span><br><span class="line">            buildConfigField BOOLEAN, PERFORMANCE_DEBUG,FALSE</span><br><span class="line">            minifyEnabled true</span><br><span class="line">            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'</span><br><span class="line">            signingConfig signingConfigs.config</span><br><span class="line">        &#125;</span><br><span class="line">        debug &#123;</span><br><span class="line">            buildConfigField BOOLEAN, ENV_DEBUG, TRUE</span><br><span class="line">            buildConfigField BOOLEAN, ENABLE_LOG, TRUE</span><br><span class="line">            buildConfigField BOOLEAN, PERFORMANCE_DEBUG,TRUE</span><br><span class="line">        &#125;</span><br><span class="line">        debugPro &#123;</span><br><span class="line">            buildConfigField BOOLEAN, ENV_DEBUG, TRUE</span><br><span class="line">            buildConfigField BOOLEAN, ENABLE_LOG, TRUE</span><br><span class="line">            buildConfigField BOOLEAN, PERFORMANCE_DEBUG,FALSE</span><br><span class="line">            minifyEnabled true</span><br><span class="line">            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'</span><br><span class="line">            signingConfig signingConfigs.config</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h5 id="dependencies"><a href="#dependencies" class="headerlink" title="dependencies"></a>dependencies</h5><p>dependencies:是属于gradle 的依赖配置。它定义了当前项目需要依赖的其他库。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">    dependencies &#123;</span><br><span class="line">    compile 'com.netflix.rxjava:rxjava-core:0.19.+'</span><br><span class="line">    compile project(':myMoudleName')</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="signingConfigs"><a href="#signingConfigs" class="headerlink" title="signingConfigs"></a>signingConfigs</h5><p>signingConfigs 签名的配置信息，注意这里不要把密码直接打上，要放到全局变量的形式，建立一个不加入版本控制系统的gradle.properties文件。KEYSTORE_PASSWORD=password123<br>KEY_PASSWORD=password789</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">signingConfigs &#123;</span><br><span class="line">    release &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            storeFile file("myapp.keystore")</span><br><span class="line">            storePassword KEYSTORE_PASSWORD</span><br><span class="line">            keyAlias "thekey"</span><br><span class="line">            keyPassword KEY_PASSWORD</span><br><span class="line">        &#125;</span><br><span class="line">        catch (ex) &#123;</span><br><span class="line">            throw new InvalidUserDataException("You should define KEYSTORE_PASSWORD and KEY_PASSWORD in gradle.properties.")</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="多渠道打包productFlavors"><a href="#多渠道打包productFlavors" class="headerlink" title="多渠道打包productFlavors"></a>多渠道打包productFlavors</h5><p>在项目的build文件的android结构下配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">productFlavors &#123;</span><br><span class="line">        dev &#123;</span><br><span class="line">            manifestPlaceholders = [channel: "dev"]</span><br><span class="line">        &#125;</span><br><span class="line">        official &#123;</span><br><span class="line">            manifestPlaceholders = [channel: "official"]</span><br><span class="line">        &#125;</span><br><span class="line">        xiaomi &#123;</span><br><span class="line">            manifestPlaceholders = [channel: "xiaomi"]</span><br><span class="line">        &#125;</span><br><span class="line">        wandoujia &#123;</span><br><span class="line">            manifestPlaceholders = [channel: "wandoujia"]</span><br><span class="line">        &#125;</span><br><span class="line">        "360" &#123;</span><br><span class="line">            manifestPlaceholders = [channel: "360"]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/10/17/gradle 常用配置/" data-id="cje0yr9qo000zcur9fuyh4qye" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-android imageview加载" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/10/11/android imageview加载/" class="article-date">
  <time datetime="2016-10-10T16:00:00.000Z" itemprop="datePublished">2016-10-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/11/android imageview加载/">Android imageview加载实现</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>显示图片，作为APP开发中必不可少的一部分，也是问题大户。加载图片时主要分为两种，一种是加载网络图片另一种就是加载本地图片。在图片的加载中，我们为了快速的显示图片，肯定会用到缓存机制，为了避免大图出现OOM，还要对图片进行压缩。今天我们从各个角度分析一下在项目中，图片使用时会遇到的一些坑。</p>
<h3 id="图片加载"><a href="#图片加载" class="headerlink" title="图片加载"></a>图片加载</h3><h4 id="离线图片加载"><a href="#离线图片加载" class="headerlink" title="离线图片加载"></a>离线图片加载</h4><p>加载资源目录下的文件：<br>BitmapFactory.decodeResource(Resources, resId, options);</p>
<p>加载其他目录下的文件：<br>BitmapFactory.decodeFile(path, options);</p>
<h4 id="在线图片加载"><a href="#在线图片加载" class="headerlink" title="在线图片加载"></a>在线图片加载</h4><h5 id="首先要下载图片资源"><a href="#首先要下载图片资源" class="headerlink" title="首先要下载图片资源"></a>首先要下载图片资源</h5><pre><code>/**
 * 获取网络图片
 * @param imageurl 图片网络地址
 * @return Bitmap 返回位图
 */
public Bitmap GetImageInputStream(String imageurl){
    URL url;
    HttpURLConnection connection=null;
    Bitmap bitmap=null;
    try {
        url = new URL(imageurl);
        connection=(HttpURLConnection)url.openConnection();
        connection.setConnectTimeout(10000); //超时设置
        connection.setDoInput(true);
        connection.setUseCaches(false); //设置不使用缓存
        InputStream inputStream=connection.getInputStream();
        bitmap= BitmapFactory.decodeStream(inputStream);
        inputStream.close();
    } catch (Exception e) {
        e.printStackTrace();
    }
    return bitmap;
}
</code></pre><p>加载图片要放到子线程里面处理，所以再获取到图片后就要回调设置imageview的图片。</p>
<p>使用线程下载资源的时候记得开启一个线程池管理线程资源。(建议一核开三个线程，但是你的APP除了下载还需要做其他事情所以我建议线程池个数 = 核数*3/2)。</p>
<h3 id="图片压缩"><a href="#图片压缩" class="headerlink" title="图片压缩"></a>图片压缩</h3><p>为什么要压缩图片？</p>
<p>因为在加载大图的时候可能出现oom异常，在这里需要注意的是，把本地资源图片放到正确的文件夹下，否则可能导致图片所占内存急剧指数倍曾加。</p>
<p>图片的压缩分为两种，一种叫做质量压缩，一种叫做大小压缩。<br>质量压缩是比较好的一种选择，因为质量压缩可以避免将大的bitmap放到内存中去处理，避免是内存吃紧。</p>
<h5 id="质量压缩实现"><a href="#质量压缩实现" class="headerlink" title="质量压缩实现"></a>质量压缩实现</h5><p>质量压缩的原理就是重新计算比例并设置bitmap的BitmapFactory.Options。</p>
<h5 id="压缩比例的获取"><a href="#压缩比例的获取" class="headerlink" title="压缩比例的获取"></a>压缩比例的获取</h5><p>在图片处理的时候，我们大部分都是对图片的质量进行压缩，这也是我们所有需要的，你可能会好奇那为什么不直接把图片的扩大也做了。主要原因是，我们在app里面使用的大部分图片资源是矢量图，而矢量图的特点就是在压缩的时候不会失真，但是在扩大的时候就会失真，导致图片模糊。</p>
<p>在计算图片的压缩比例前，我们要知道资源bitmap的宽高以及目标imageview的宽高，之后用bitmap的宽高去除imageview的宽高，获取两个值中较大的一个作为压缩比例。</p>
<p>注意：在获取bitmap的宽高时，为了不把这个大的bitmap添加到内存中，options.inJustDecodeBounds = true; // 设置成了true,不占用内存，只获取bitmap宽高</p>
<pre><code>/**
 * @description 计算图片的压缩比率
 *
 * @param options 参数
 * @param reqWidth 目标的宽度
 * @param reqHeight 目标的高度
 * @return
 */
private static int calculateInSampleSize(BitmapFactory.Options options, int reqWidth, int reqHeight) {
    // 源图片的高度和宽度
    final int height = options.outHeight;
    final int width = options.outWidth;
    int inSampleSize = 1;
    if (height &gt; reqHeight || width &gt; reqWidth) {
        // 计算出实际宽高和目标宽高的比率
        final int halfHeight = height / 2;
        final int halfWidth = width / 2;
        while ((halfHeight / inSampleSize) &gt; reqHeight &amp;&amp; (halfWidth / inSampleSize) &gt; reqWidth) {
            inSampleSize *= 2;
        }
    }
    return inSampleSize;
}
</code></pre><p>在获取到压缩比例后：</p>
<pre><code>options.inSampleSize = calculateInSampleSize(options, reqWidth, reqHeight); // 调用上面定义的方法计算inSampleSize值
// 使用获取到的inSampleSize值再次解析图片
options.inJustDecodeBounds = false;
Bitmap src = BitmapFactory.decodeResource(res, resId, options); // 载入一个稍大的缩略图
</code></pre><h3 id="图片缓存处理"><a href="#图片缓存处理" class="headerlink" title="图片缓存处理"></a>图片缓存处理</h3><h4 id="软缓存"><a href="#软缓存" class="headerlink" title="软缓存"></a>软缓存</h4><p>软缓存，就是内存缓存，Lru算法实现：</p>
<pre><code> // 获取最大可用内存
private static long maxMemory = Runtime.getRuntime().maxMemory();
//设置内存缓存大小
private static int cacheSize = (int) (maxMemory / 4);
public static LruCache&lt;String, Bitmap&gt; MEMORYLRUCACHE= new LruCache&lt;String, Bitmap&gt;(cacheSize)
{

    @Override
    protected int sizeOf(String key, Bitmap value)
    {
        // 在每次存入缓存的时候调用
        return value.getByteCount();
    }
};
</code></pre><h4 id="磁盘缓存"><a href="#磁盘缓存" class="headerlink" title="磁盘缓存"></a>磁盘缓存</h4><p><a href="https://github.com/JakeWharton/DiskLruCache" target="_blank" rel="noopener">DiskLruCache</a></p>
<h3 id="自定义图片请求框架实现"><a href="#自定义图片请求框架实现" class="headerlink" title="自定义图片请求框架实现"></a>自定义图片请求框架实现</h3><ul>
<li>1 下载图片前先去内存缓存中读取，读取不到再去磁盘缓存中读取，再没有再去网络上加载图片。</li>
<li>2 网络加载图片，计算压缩比例，并压缩bitmap,然后将bitmap放到内存缓存中和磁盘缓存中，设置图片。</li>
</ul>
<h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><ul>
<li>合理的线程池大小(核数*3/2)。</li>
<li>合理的内存缓存大小(1/8)。</li>
<li>合理的磁盘缓存大小(15M)。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/10/11/android imageview加载/" data-id="cje0yr9qe000ocur9bzofm42l" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-android 动画" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/10/04/android 动画/" class="article-date">
  <time datetime="2016-10-03T16:00:00.000Z" itemprop="datePublished">2016-10-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/04/android 动画/">Android 动画</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在程序中使用一些动画效果可以使APP的交互变得更加生动，交互性更强，也很灵动，但是不要过分使用动画效果，因为动画的使用对于GUP和CPU的消耗是巨大的。</p>
<h3 id="插值器"><a href="#插值器" class="headerlink" title="插值器"></a>插值器</h3><ul>
<li>AccelerateDecelerateInterpolator 动画开始与结束的地方速率改变比较慢，在中间的时候加速。</li>
<li>AccelerateInterpolator 动画开始的地方速率改变比较慢，然后开始加速。</li>
<li>AnticipateInterpolator 开始的时候向后然后向前甩。</li>
<li>LinearInterpolator 以常量速率改变</li>
<li>DecelerateInterpolator 在动画开始的地方快然后慢</li>
<li>AnticipateOvershootInterpolator 开始的时候向后然后向前甩一定值后返回最后的值</li>
<li>BounceInterpolator 动画结束的时候弹起</li>
<li>CycleInterpolator 动画循环播放特定的次数，速率改变沿着正弦曲线</li>
<li>OvershootInterpolator 向前甩一定值后再回到原来位置</li>
<li>PathInterpolator 新增的，就是可以定义路径坐标，然后可以按照路径坐标来跑动；注意其坐标并不是 XY，而是单方向，也就是我可以从0~1，然后弹回0.5 然后又弹到0.7 有到0.3，直到最后时间结束</li>
</ul>
<h3 id="帧动画"><a href="#帧动画" class="headerlink" title="帧动画"></a>帧动画</h3><p>所谓的帧动画就是指像放电影一样的动画效果，动画是由一帧一帧的图片组成的，可以设置每一帧之间的间隔和总时长来实现动画效果。比如播放GIF。</p>
<h4 id="帧动画的实现"><a href="#帧动画的实现" class="headerlink" title="帧动画的实现"></a>帧动画的实现</h4><ul>
<li>1 通过数据流的形式读取gif，视屏流并播放。</li>
<li><p>2 通过xml文件配置一组图片，并设置时长循环形式。</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;  
&lt;!--   根标签为animation-list，其中oneshot代表着是否只展示一遍，设置为false会不停的循环播放动画根标签下，通过item标签对动画中的每一个图片进行声明  android:duration 表示展示所用的该图片的时间长度  --&gt;  
&lt;animation-list  xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;  android:oneshot=&quot;true&quot;  &gt;  
&lt;item android:drawable=&quot;@drawable/icon1&quot; android:duration=&quot;150&quot;&gt;&lt;/item&gt;  
&lt;item android:drawable=&quot;@drawable/icon2&quot; android:duration=&quot;150&quot;&gt;&lt;/item&gt;  
&lt;item android:drawable=&quot;@drawable/icon3&quot; android:duration=&quot;150&quot;&gt;&lt;/item&gt;  
&lt;item android:drawable=&quot;@drawable/icon4&quot; android:duration=&quot;150&quot;&gt;&lt;/item&gt;  
&lt;item android:drawable=&quot;@drawable/icon5&quot; android:duration=&quot;150&quot;&gt;&lt;/item&gt;  
&lt;item android:drawable=&quot;@drawable/icon6&quot; android:duration=&quot;150&quot;&gt;&lt;/item&gt;  
&lt;/animation-list&gt;  

//播放动画
frame_img.setBackgroundResource(R.drawable.voice);
AnimationDrawable animationDrawable = (AnimationDrawable) frame_img.getBackground();
animationDrawable.start();
</code></pre></li>
</ul>
<h3 id="视图动画和属性动画"><a href="#视图动画和属性动画" class="headerlink" title="视图动画和属性动画"></a>视图动画和属性动画</h3><h4 id="视图动画"><a href="#视图动画" class="headerlink" title="视图动画"></a>视图动画</h4><p>视图动画提供了AlphaAnimation，RotateAnimation,TranslateAnimation,ScaleAnimation四种动画方式，并提供了AnimationSet动画集合来混合使用多中动画。随着android3.0属性动画的推出，视图动画就不再风光，相比属性动画视图动画非常大的缺陷是不具有交互性，当某个元素发生视图动画后，其响应事件的位置依然在动画前的地方，所以视图动画只能做普通的动画效果，避免交互的发生。但是它的优点也非常明显：效率比较高使用也方便。 </p>
<h4 id="属性动画"><a href="#属性动画" class="headerlink" title="属性动画"></a>属性动画</h4><p>由于android3.0之前已有的动画框架Animation存在一些局限性：动画改变的只是显示，并不能响应事件。因此，在android3.0之后，谷歌就推出了新的动画框架，帮助开发者实现更加丰富的动画效果。</p>
<h4 id="ObjectAnimator"><a href="#ObjectAnimator" class="headerlink" title="ObjectAnimator"></a>ObjectAnimator</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ObjectAnimator mObjectAnimator=ObjectAnimator.ofFloat(view,<span class="string">"translationX"</span>,<span class="number">200</span>);</span><br><span class="line">mObjectAnimator.setDuration(<span class="number">300</span>);</span><br><span class="line">mObjectAnimator.start();</span><br></pre></td></tr></table></figure>
<p>属性动画常用的属性值：</p>
<ul>
<li>translationX和translationY：这两个属性作为增量控制View对象从他的布局容器的左上角开始位置。</li>
<li>rotation、rotationX、rotationY：这三个属性控制View对象围绕它的支点进行2D和3D旋转。PrivotX和PrivotY：控制View对象的支点位置，围绕这个支点进行旋转和缩放变换处理。默认该支点位置就是View对象的中心点。</li>
<li>scaleX，scaleY缩放。</li>
<li>alpha：透明度，默认是1（不透明），0代表完全透明。</li>
<li>x和y：描述View对象在它容器中的最终位置，它是最初的做上角坐标和translationX,translationY值的累计的和。</li>
</ul>
<h4 id="动画的监听"><a href="#动画的监听" class="headerlink" title="动画的监听"></a>动画的监听</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ObjectAnimator animator=ObjectAnimator.ofFloat(view,<span class="string">"alpha"</span>,<span class="number">1.5f</span>);</span><br><span class="line">        animator.addListener(<span class="keyword">new</span> Animator.AnimatorListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationStart</span><span class="params">(Animator animation)</span> </span>&#123;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animator animation)</span> </span>&#123;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationCancel</span><span class="params">(Animator animation)</span> </span>&#123;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationRepeat</span><span class="params">(Animator animation)</span> </span>&#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="组合动画-AnimatorSet"><a href="#组合动画-AnimatorSet" class="headerlink" title="组合动画-AnimatorSet"></a>组合动画-AnimatorSet</h4><p>这个类提供了一个play()方法，如果我们向这个方法中传入一个Animator对象(ValueAnimator或ObjectAnimator)将会返回一个AnimatorSet.Builder的实例，AnimatorSet.Builder中包括以下四个方法：</p>
<ul>
<li>after(Animator anim) 将现有动画插入到传入的动画之后执行</li>
<li>after(long delay) 将现有动画延迟指定毫秒后执行</li>
<li>before(Animator anim) 将现有动画插入到传入的动画之前执行</li>
<li>with(Animator anim) 将现有动画和传入的动画同时执行</li>
<li>playTogether/playSequentially</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ObjectAnimator animator1 = ObjectAnimator.ofFloat(mCustomView, <span class="string">"translationX"</span>, <span class="number">0.0f</span>, <span class="number">200.0f</span>, <span class="number">0f</span>);</span><br><span class="line">ObjectAnimator animator2 = ObjectAnimator.ofFloat(mCustomView, <span class="string">"scaleX"</span>, <span class="number">1.0f</span>, <span class="number">2.0f</span>);</span><br><span class="line">ObjectAnimator animator3 = ObjectAnimator.ofFloat(mCustomView, <span class="string">"rotationX"</span>, <span class="number">0.0f</span>, <span class="number">90.0f</span>, <span class="number">0.0F</span>);</span><br><span class="line">AnimatorSet set=<span class="keyword">new</span> AnimatorSet();</span><br><span class="line">set.setDuration(<span class="number">1000</span>);</span><br><span class="line">set.play(animator1).with(animator2).after(animator3);</span><br><span class="line">set.start();</span><br></pre></td></tr></table></figure>
<h4 id="XML使用"><a href="#XML使用" class="headerlink" title="XML使用"></a>XML使用</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">set</span></span></span><br><span class="line"><span class="tag">  <span class="attr">android:ordering</span>=<span class="string">[</span>"<span class="attr">together</span>" | "<span class="attr">sequentially</span>"]&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">objectAnimator</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:propertyName</span>=<span class="string">"string"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:duration</span>=<span class="string">"int"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:valueFrom</span>=<span class="string">"float | int | color"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:valueTo</span>=<span class="string">"float | int | color"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:startOffset</span>=<span class="string">"int"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:repeatCount</span>=<span class="string">"int"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:repeatMode</span>=<span class="string">[</span>"<span class="attr">repeat</span>" | "<span class="attr">reverse</span>"]</span></span><br><span class="line"><span class="tag">        <span class="attr">android:valueType</span>=<span class="string">[</span>"<span class="attr">intType</span>" | "<span class="attr">floatType</span>"]/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">animator</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:duration</span>=<span class="string">"int"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:valueFrom</span>=<span class="string">"float | int | color"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:valueTo</span>=<span class="string">"float | int | color"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:startOffset</span>=<span class="string">"int"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:repeatCount</span>=<span class="string">"int"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:repeatMode</span>=<span class="string">[</span>"<span class="attr">repeat</span>" | "<span class="attr">reverse</span>"]</span></span><br><span class="line"><span class="tag">        <span class="attr">android:valueType</span>=<span class="string">[</span>"<span class="attr">intType</span>" | "<span class="attr">floatType</span>"]/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">objectAnimator</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">android:duration</span>=<span class="string">"1000"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:propertyName</span>=<span class="string">"scaleX"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:valueFrom</span>=<span class="string">"1.0"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:valueTo</span>=<span class="string">"2.0"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:valueType</span>=<span class="string">"floatType"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">objectAnimator</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>java 使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Animator animator=AnimatorInflater.loadAnimator(<span class="keyword">this</span>,R.animator.scale);</span><br><span class="line">animator.setTarget(view);</span><br><span class="line">animator.start();</span><br></pre></td></tr></table></figure>
<h3 id="物理动画"><a href="#物理动画" class="headerlink" title="物理动画"></a>物理动画</h3><p>Google I/O ‘17推出了许多新的特性，在动画这一块又有新的API供开发者使用，具体视频请见Android Animations Spring to Life <a href="https://www.youtube.com/watch?v=BNcODK-Ju0g" target="_blank" rel="noopener">Google I/O ‘17</a>，主要介绍了Physics-based Animations，在动画API中引入了DynamicAnimation，并介绍了它的两个子类FlingAnimation和SpringAnimation的使用，开发者可以使用新的API创建更加动态化的动画。</p>
<p>Physics-based Animations，翻译过来就是基于物理的动画，官网上有很详细的介绍，在日常生活中当一个事物发生变化的时候，物理性的过渡或者说符合自然性的过渡，更容易让我们感知察觉，同样，更自然、不间断、有良好发展趋势的动画会给我们带来更好的用户体验。Physics-based Animations是根据物理学的基本原理构建的动画，动画由力产生，当力趋于平衡时动画处于静止。</p>
<h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><ul>
<li>动画由力驱动</li>
<li>力决定了动画的加速和减速</li>
<li>在每一帧中动画值和速度都会更新</li>
<li>当受力达到平衡时动画停止</li>
</ul>
<p>物理动画可以使动画的滑动和停止更接近现实，开起来更真实顺滑，不会有跳动和速度不服逻辑的跳动。</p>
<p>使用Physics-based Animations api创建的动画可以追踪速度，在运动过程中动态地改变动画的目标值，正确规划路线，使动画看起来更加自然。</p>
<h4 id="build-添加依赖"><a href="#build-添加依赖" class="headerlink" title="build 添加依赖"></a>build 添加依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    ...</span><br><span class="line">    compile "com.android.support:support-dynamic-animation:26.0.0-beta2"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="SpringAnimation"><a href="#SpringAnimation" class="headerlink" title="SpringAnimation"></a>SpringAnimation</h4><p>SpringAnimation弹簧动画，主要包括两个属性dampingRatio(阻尼系数)和velocity用来间接指定弹簧的初始速度。总体而言，dampingRatio 参数越小，velocity 参数越大，视图表现为剧烈的摇晃。</p>
<p>设置动画</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> View img = findViewById(R.id.imageView);</span><br><span class="line"><span class="keyword">final</span> SpringAnimation springAnim = <span class="keyword">new</span> SpringAnimation(img, DynamicAnimation.TRANSLATION_Y, <span class="number">0</span>);</span><br><span class="line">springAnim.getSpring().setDampingRatio(DAMPING_RATIO_LOW_BOUNCY);</span><br></pre></td></tr></table></figure>
<p>动画类型：</p>
<ul>
<li>ALPHA</li>
<li>TRANSLATION_X, TRANSLATION_Y, and TRANSLATION_Z</li>
<li>ROTATION, ROTATION_X, and ROTATION_Y</li>
<li>SCROLL_X and SCROLL_Y</li>
<li>SCALE_X and SCALE_Y</li>
<li>X, Y, and Z.X is a sum of the left value and TRANSLATION_X.Y is a sum of the top value and TRANSLATION_Y.Z is a sum of the elevation value and TRANSLATION_Z.</li>
</ul>
<p>阻尼stiffness：</p>
<ul>
<li>STIFFNESS_HIGH</li>
<li>STIFFNESS_MEDIUM</li>
<li>STIFFNESS_LOW</li>
<li>STIFFNESS_VERY_LOW</li>
</ul>
<p>damping：</p>
<ul>
<li>DAMPING_RATIO_HIGH_BOUNCY</li>
<li>DAMPING_RATIO_MEDIUM_BOUNCY</li>
<li>DAMPING_RATIO_LOW_BOUNCY</li>
<li>DAMPING_RATIO_NO_BOUNCY</li>
</ul>
<p>效果如下：</p>
<p><img src="https://developer.android.com/images/animation/physics-based-animation/medium_bounce.gif" alt=""></p>
<h4 id="FlingAnimation"><a href="#FlingAnimation" class="headerlink" title="FlingAnimation"></a>FlingAnimation</h4><p>实现了基于初始动能并逐渐减弱的动画效果。</p>
<p><img src="https://developer.android.com/images/topic/libraries/support-library/preview/fling-animation.gif" alt=""></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">FlingAnimation fling = <span class="keyword">new</span> FlingAnimation(view, DynamicAnimation.SCROLL_X);</span><br><span class="line">fling.setStartVelocity(-velocityX)</span><br><span class="line">        .setMinValue(<span class="number">0</span>)</span><br><span class="line">        .setMaxValue(maxScroll)</span><br><span class="line">        .setFriction(<span class="number">1.1f</span>)</span><br><span class="line">        .start();</span><br></pre></td></tr></table></figure>
<h3 id="实际问题"><a href="#实际问题" class="headerlink" title="实际问题"></a>实际问题</h3><h4 id="View-不断更新动画状态问题，每次启动动画，都会从最初位置开始。"><a href="#View-不断更新动画状态问题，每次启动动画，都会从最初位置开始。" class="headerlink" title="View 不断更新动画状态问题，每次启动动画，都会从最初位置开始。"></a>View 不断更新动画状态问题，每次启动动画，都会从最初位置开始。</h4><p>我遇到的实际问题是这样的，显示一个转盘，转盘上面有一个小指针需要一直旋转，当ui一个变量变化时，根据这个变量的变化幅度动态调整指针的转速。遇到的问题是每次更新时，动画都会从原始位置开始执行。</p>
<p>最后解决办法如下，记录下结束时的位置，我开始以为，这个结束位置应该记录在objectanimitor里面，但是一直都找不到对应的值，最后我发发现这个值记录在对应的view里面了…….</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startSmallZZAnimation</span><span class="params">(<span class="keyword">int</span> duration)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (repeat != <span class="keyword">null</span> &amp;&amp; repeat.isRunning()) &#123;</span><br><span class="line">            smallAngle = smallZP.getRotation();</span><br><span class="line">            repeat.cancel();</span><br><span class="line">            smallZP.clearAnimation();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            repeat = ObjectAnimator.ofFloat(smallZP, <span class="string">"rotation"</span>, currentAngle, currentAngle + <span class="number">360</span>);</span><br><span class="line">            repeat.setDuration(duration);</span><br><span class="line">            repeat.setRepeatCount(<span class="number">30000</span> / duration);</span><br><span class="line">            repeat.setInterpolator(<span class="keyword">new</span> LinearInterpolator());</span><br><span class="line">            repeat.start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/10/04/android 动画/" data-id="cje0yr9qh000qcur9ljyxz8mo" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/5/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/7/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/02/23/Protobuf/">Protobuf</a>
          </li>
        
          <li>
            <a href="/2018/01/31/Android 内部存储 外部存储/">(no title)</a>
          </li>
        
          <li>
            <a href="/2018/01/26/线程与CPU/">线程与CPU</a>
          </li>
        
          <li>
            <a href="/2018/01/22/Gradle 详解/">Gradle 详解</a>
          </li>
        
          <li>
            <a href="/2018/01/08/麦肯锡工作法/">麦肯锡工作法</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>