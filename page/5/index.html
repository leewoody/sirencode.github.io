<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Diablo</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Diablo">
<meta property="og:url" content="https://github.com/sirencode/page/5/index.html">
<meta property="og:site_name" content="Diablo">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Diablo">
  
    <link rel="alternative" href="/atom.xml" title="Diablo" type="application/atom+xml">
  
  
    <link rel="icon" href="http://7xkj1z.com1.z0.glb.clouddn.com/head.jpg">
  
  <link rel="stylesheet" href="/css/style.css">
  
  

  <script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>
  <script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>

  
</head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://7xkj1z.com1.z0.glb.clouddn.com/head.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">ShenYonghe</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/smackgg/hexo-theme-smackdown">smackdown</a>
			        
			        </div>
				</section>
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">ShenYonghe</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="http://7xkj1z.com1.z0.glb.clouddn.com/head.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">ShenYonghe</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-SOLID原则" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/02/08/SOLID原则/" class="article-date">
  	<time datetime="2017-02-07T16:00:00.000Z" itemprop="datePublished">2017-02-08</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/02/08/SOLID原则/">
        SOLID原则
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>S.O.L.I.D是面向对象设计和编程(OOD&amp;OOP)中几个重要编码原则(Programming Priciple)的首字母缩写。</p>
<ul>
<li>SRP    （The Single Responsibility Principle）    单一责任原则</li>
<li>OCP    （The Open Closed Principle）    开放封闭原则</li>
<li>LSP    （The Liskov Substitution Principle）    里氏替换原则</li>
<li>ISP    （The Interface Segregation Principle）    接口分离原则</li>
<li>DIP    （The Dependency Inversion Principle）    依赖倒置原则</li>
</ul>
<h4 id="单一责任原则（SRP）"><a href="#单一责任原则（SRP）" class="headerlink" title="单一责任原则（SRP）"></a>单一责任原则（SRP）</h4><p>当需要修改某个类的时候原因有且只有一个。换句话说就是让一个类只做一种类型责任，当这个类需要承当其他类型的责任的时候，就需要分解这个类。 类被修改的几率很大，因此应该专注于单一的功能。如果你把多个功能放在同一个类中，功能之间就形成了关联，改变其中一个功能，有可能中止另一个功能，这时就需要新一轮的测试来避免可能出现的问题，非常耗时耗力。</p>
<p>示例：<br>新建一个Rectangle类，该类包含两个方法，一个用于把矩形绘制在屏幕上，一个方法用于计算矩形的面积。如图</p>
<p><img src="http://img.my.csdn.net/uploads/201204/16/1334585669_3041.jpg" alt="图片"></p>
<p>Rectangle类违反了SRP原则。Rectangle类具有两个职责，如果其中一个改变，会影响到两个应用程序的变化。</p>
<p>一个好的设计是把两个职责分离出来放在两个不同的类中，这样任何一个变化都不会影响到其他的应用程序。</p>
<h4 id="开放封闭原则（OCP）"><a href="#开放封闭原则（OCP）" class="headerlink" title="开放封闭原则（OCP）"></a>开放封闭原则（OCP）</h4><p>软件实体应该是可扩展，而不可修改的。也就是说，对扩展是开放的，而对修改是封闭的。这个原则是诸多面向对象编程原则中最抽象、最难理解的一个。</p>
<ul>
<li>(1)通过增加代码来扩展功能，而不是修改已经存在的代码。</li>
<li>(2)若客户模块和服务模块遵循同一个接口来设计，则客户模块可以不关心服务模块的类型，服务模块可以方便扩展服务(代码)。</li>
<li>(3)OCP支持替换的服务，而不用修改客户模块。</li>
</ul>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">sendByEmail</span><span class="params">(String addr, String title, String content)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">sendBySMS</span><span class="params">(String addr, String content)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在其它地方调用上述方法发送信息</span></span><br><span class="line">sendByEmail(addr, title, content);</span><br><span class="line"></span><br><span class="line">sendBySMS(addr, content);</span><br></pre></td></tr></table></figure>
<p>如果现在又多了一种发送信息的方式，比如可以通过QQ发送信息，那么不仅需要增加一个方法sendByQQ()，还需要在调用它的地方进行修改，违反了OCP原则，更好的方式是</p>
<p>抽象出一个Send接口，里面有个send()方法，然后让SendByEmail和SendBySMS去实现它既可。这样即使多了一个通过QQ发送的请求，那么只要再添加一个SendByQQ实现类实现Send接口既可。这样就不需要修改已有的接口定义和已实现类，很好的遵循了OCP原则。</p>
<h4 id="里氏替换原则（LSP）"><a href="#里氏替换原则（LSP）" class="headerlink" title="里氏替换原则（LSP）"></a>里氏替换原则（LSP）</h4><p>当一个子类的实例应该能够替换任何其超类的实例时，它们之间才具有is-A关系</p>
<p>客户模块不应关心服务模块的是如何工作的；同样的接口模块之间，可以在不知道服务模块代码的情况下，进行替换。即接口或父类出现的地方，实现接口的类或子类可以代入。</p>
<ol>
<li><p>子类可以实现父类的抽象方法，但不能覆盖父类的非抽象方法。</p>
</li>
<li><p>子类中可以增加自己特有的方法。</p>
</li>
<li><p>当子类的方法重载父类的方法时，方法的前置条件（即方法的形参）要比父类方法的输入参数更宽松。</p>
</li>
<li><p>当子类的方法实现父类的抽象方法时，方法的后置条件（即方法的返回值）要比父类更严格。</p>
</li>
</ol>
<h4 id="接口分离原则（ISP）"><a href="#接口分离原则（ISP）" class="headerlink" title="接口分离原则（ISP）"></a>接口分离原则（ISP）</h4><p>不能强迫用户去依赖那些他们不使用的接口。换句话说，使用多个专门的接口比使用单一的总接口总要好。</p>
<p>客户模块不应该依赖大的接口，应该裁减为小的接口给客户模块使用，以减少依赖性。如Java中一个类实现多个接口，不同的接口给不同的客户模块使用，而不是提供给客户模块一个大的接口。</p>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span></span>;      <span class="comment">// 吃</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sleep</span><span class="params">()</span></span>;    <span class="comment">// 睡</span></span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">crawl</span><span class="params">()</span></span>;     <span class="comment">// 爬</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>;      <span class="comment">// 跑</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Snake</span> <span class="keyword">implements</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sleep</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">crawl</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Rabit</span> <span class="keyword">implements</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sleep</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">crawl</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的例子，Snake并没有run的行为而Rabbit并没有crawl的行为，而这里它们却必须实现这样不必要的方法，更好的方法是crawl()和run()单独作为一个接口，这需要根据实际情况进行调整，反正不要把什么功能都放在一个大的接口里，而这些功能并不是每个继承该接口的类都所必须的。</p>
<h4 id="依赖注入或倒置原则（DIP）"><a href="#依赖注入或倒置原则（DIP）" class="headerlink" title="依赖注入或倒置原则（DIP）"></a>依赖注入或倒置原则（DIP）</h4><ol>
<li>高层模块不应该依赖于低层模块，二者都应该依赖于抽象 </li>
<li>抽象不应该依赖于细节，细节应该依赖于抽象</li>
</ol>
<p>这个设计原则的亮点在于任何被DI框架注入的类很容易用mock对象进行测试和维护，因为对象创建代码集中在框架中，客户端代码也不混乱。有很多方式可以实现依赖倒置，比如像AspectJ等的AOP（Aspect Oriented programming）框架使用的字节码技术，或Spring框架使用的代理等。</p>
<p>(1).高层模块不要依赖低层模块；</p>
<p>(2).高层和低层模块都要依赖于抽象；</p>
<p>(3).抽象不要依赖于具体实现； </p>
<p>(4).具体实现要依赖于抽象；</p>
<p>(5).抽象和接口使模块之间的依赖分离。</p>
<p>1.低层模块尽量都要有抽象类或接口，或者两者都有。</p>
<p>2.变量的声明类型尽量是抽象类或接口。</p>
<p>3.使用继承时遵循里氏替换原则。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>一个对象只承担一种责任，所有服务接口只通过它来执行这种任务。</li>
<li>程序实体，比如类和对象，向扩展行为开放，向修改行为关闭。</li>
<li>子类应该可以用来替代它所继承的类。</li>
<li>一个类对另一个类的依赖应该限制在最小化的接口上。</li>
<li>依赖抽象层(接口)，而不是具体类。</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-android 基本知识" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/02/08/android 基本知识/" class="article-date">
  	<time datetime="2017-02-07T16:00:00.000Z" itemprop="datePublished">2017-02-08</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/02/08/android 基本知识/">
        Android 基本知识
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="Android沙箱"><a href="#Android沙箱" class="headerlink" title="Android沙箱"></a>Android沙箱</h4><p>Android“沙箱”的本质是为了实现不同应用程序和进程之间的互相隔离，即在默认情况下，应用程序没有权限访问系统资源或其它应用程序的资源。每个APP和系统进程都被分配唯一并且固定的User Id，这个uid与内核层进程的uid对应。每个APP在各自独立的Dalvik虚拟机中运行，拥有独立的地址空间和资源。运行于Dalvik虚拟机中的 进程必须依托内核层Linux进程而存在，因此Android使用Dalvik虚拟机和Linux的文件访问控制来实现沙箱机制，任何应用程序如果想要访问系统资源或者其它应用程序的资源必须在自己的manifest文件中进行声明权限或者共享uid。</p>
<p>安装在设备中的每一个apk文件，Android给每个APK进程分配一个单独的用户空间,其manifest中的userid就是对应一个Linux 用户都会被分配到一个属于自己的统一的Linux用户ID，并且为它创建一个沙箱，以防止影响其他应用程序（或者其他应用程序影响它）。用户ID 在应用程序安装到设备中时被分配，并且在这个设备中保持它的永久性。</p>
<p>通过Shared User id,拥有同一个User id的多个APK可以配置成运行在同一个进程中.所以默认就是可以互相访问任意数据. 也可以配置成运行成不同的进程, 同时可以访问其他APK的数据目录下的数据库和文件.就像访问本程序的数据一样.</p>
<h5 id="为什么做沙箱"><a href="#为什么做沙箱" class="headerlink" title="为什么做沙箱"></a>为什么做沙箱</h5><p>沙箱，对使用者来说可以理解为一种安全环境，对恶意访问者来说是一种限制。Android 沙箱实现了应用程序的相互隔离，用于对文件系统的实体访问进行控制，也可以对其他Android系统资源进行访问控制。</p>
<h4 id="APP构建过程"><a href="#APP构建过程" class="headerlink" title="APP构建过程"></a>APP构建过程</h4><p>使用Android Asset Packaging Tool(aapt) ，将AndroidManifest.xml和res下的资源编译生成R.Java文件，这样java文件就可以去引用资源了 - 使用aidl 工具去生成对应的Java interfaces - 将src和通过aapt生成的R.java，.aidl文件通过javaC命令去生成.class 文件 - 使用dex tool 将class文件转化成Dalvik byte code.这时候要将所有class文件和第三方的jar包都包括。 - 所有没有编译过得图片和编译过的图片,.dex文件传给apkbuilder去打包成.apk - 最后采用zipalign tool 打入签名.</p>
<p><img src="http://img.blog.csdn.net/20170205174903577?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvWmhlbmc1NDg=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="图片"></p>
<h5 id="编译一个application-module或者library文件，大致可以分为gradle-task代表的五个阶段："><a href="#编译一个application-module或者library文件，大致可以分为gradle-task代表的五个阶段：" class="headerlink" title="编译一个application module或者library文件，大致可以分为gradle task代表的五个阶段："></a>编译一个application module或者library文件，大致可以分为gradle task代表的五个阶段：</h5><ol>
<li>Preparation of dependecies 在这个阶段gradle检测module依赖的所有library是否ready。如果这个module依赖于另一个module，则另一个module也要被编译。 </li>
<li>Merging resources and processing Manifest 在这个阶段之后，资源和Manifest文件被打包。 </li>
<li>Compiling 在这个阶段处理编译器的注解，源码被编译成字节码。 </li>
<li>Postprocessing 所有带 “transform”前缀的task都是这个阶段进行处理的。 </li>
<li>Packaging and publishing 这个阶段library生成.aar文件，application生成.apk文件。</li>
</ol>
<h4 id="Dalvik、ART-虚拟机"><a href="#Dalvik、ART-虚拟机" class="headerlink" title="Dalvik、ART 虚拟机"></a>Dalvik、ART 虚拟机</h4><h5 id="jvm"><a href="#jvm" class="headerlink" title="jvm"></a>jvm</h5><p>JVM本质上就是一个软件，是计算机硬件的一层软件抽象，在这之上才能够运行Java程序，JAVA在编译后会生成类似于汇编语言的JVM字节码，与C语言编译后产生的汇编语言不同的是，C编译成的汇编语言会直接在硬件上跑，但JAVA编译后生成的字节码是在JVM上跑，需要由JVM把字节码翻译成机器指令，才能使JAVA程序跑起来。</p>
<p>JVM运行在操作系统上，屏蔽了底层实现的差异，从而有了JAVA吹嘘的平台独立性和Write Once Run Anywhere。根据JVM规范实现的具体虚拟机有几十种，主流的JVM包括Hotspot、Jikes RVM等，都是用C/C++和汇编编写的，每个JRE编译的时候针对每个平台编译，因此下载JRE（JVM、Java核心类库和支持文件）的时候是分平台的，JVM的作用是把平台无关的.class里面的字节码翻译成平台相关的机器码，来实现跨平台。</p>
<h5 id="dvm"><a href="#dvm" class="headerlink" title="dvm"></a>dvm</h5><p>JVM是Java Virtual Machine，而DVM就是Dalvik Virtual Machine，是安卓中使用的虚拟机，所有安卓程序都运行在安卓系统进程里，每个进程对应着一个Dalvik虚拟机实例。他们都提供了对象生命周期管理、堆栈管理、线程管理、安全和异常管理以及垃圾回收等重要功能，各自拥有一套完整的指令系统，以下简要对比两种虚拟机的不同。</p>
<ul>
<li>JAVA虚拟机运行的是JAVA字节码，Dalvik虚拟机运行的是Dalvik字节码,JAVA程序经过编译，生成JAVA字节码保存在class文件中，JVM通过解码class文件中的内容来运行程序。而DVM运行的是Dalvik字节码，所有的Dalvik字节码由JAVA字节码转换而来，并被打包到一个DEX（Dalvik Executable）可执行文件中，DVM通过解释DEX文件来执行这些字节码。</li>
<li>Dalvik可执行文件体积更小</li>
<li>JVM基于栈，DVM基于寄存器</li>
</ul>
<h5 id="JIT-AOT-ART"><a href="#JIT-AOT-ART" class="headerlink" title="JIT AOT ART"></a>JIT AOT ART</h5><p>首先了解JIT（Just In Time，即时编译技术）和AOT(Ahead Of Time，预编译技术)两种编译模式。</p>
<p>JIT以JVM为例，javac把程序源码编译成JAVA字节码，JVM通过逐条解释字节码将其翻译成对应的机器指令，逐条读入，逐条解释翻译，执行速度必然比C/C++编译后的可执行二进制字节码程序慢，为了提高执行速度，就引入了JIT技术，JIT会在运行时分析应用程序的代码，识别哪些方法可以归类为热方法，这些方法会被JIT编译器编译成对应的汇编代码，然后存储到代码缓存中，以后调用这些方法时就不用解释执行了，可以直接使用代码缓存中已编译好的汇编代码。这能显著提升应用程序的执行效率。（安卓Dalvik虚拟机在2.2中增加了JIT）</p>
<p>相对的AOT就是指C/C++这类语言，编译器在编译时直接将程序源码编译成目标机器码，运行时直接运行机器码。</p>
<p>Dalvik虚拟机执行的是dex字节码，ART虚拟机执行的是本地机器码</p>
<p>Dalvik执行的是dex字节码，依靠JIT编译器去解释执行，运行时动态地将执行频率很高的dex字节码翻译成本地机器码，然后在执行，但是将dex字节码翻译成本地机器码是发生在应用程序的运行过程中，并且应用程序每一次重新运行的时候，都要重新做这个翻译工作，因此，及时采用了JIT，Dalvik虚拟机的总体性能还是不能与直接执行本地机器码的ART虚拟机相比。</p>
<p>安卓运行时从Dalvik虚拟机替换成ART虚拟机，并不要求开发者重新将自己的应用直接编译成目标机器码，也就是说，应用程序仍然是一个包含dex字节码的apk文件。所以在安装应用的时候，dex中的字节码将被编译成本地机器码，之后每次打开应用，执行的都是本地机器码。移除了运行时的解释执行，效率更高，启动更快。（安卓在4.4中发布了ART运行时）</p>
<h4 id="Apk安装过程"><a href="#Apk安装过程" class="headerlink" title="Apk安装过程"></a>Apk安装过程</h4><p>1 将Apk文件导入或者通过网络下载到手机上面。</p>
<p>2 当Apk文件被复制到一个应用目录时，它由包管理器自动探查并安装，因为包管理器会监视这些目录的变化。</p>
<p>3 点击弹出安装，首先检查是否信任(未知来源)，packgeinstaller弹出基本GUI附带上APK文件的URI的intent，显示所需权限的确认框，</p>
<p>4 点击确认按钮，packgeinstaller 会调用pachgemanagerservice服务，它会执行真实的安装过程。pachgemanagerservice负责解析Apk文件，启动应用安装，更新和卸载包，维护包数据库，并且负责权限管理。</p>
<p>5 pachgemanagerservice并没有root权限来创建删除和更改应用目录的所有者，因此pachgemanagerservice将这些操作托付给installed守护进程</p>
<ul>
<li>打开一个Apk文件会触发application/vnd.android.package-achive处理程序启动，这一程序通常是packageinstaller系统中的packageinstalleractivity组件。</li>
<li>packageinstalleractivity首先检查(根据Apk的UID和包名，并检查它是不是特权应用，可以安装在/system/priv-app/目录下)应用是否受信任，如果不具有特权就会被标记为”未知来源”，弹出警示框并结束安装。</li>
<li>如果允许安装，packageinstalleractivity解析Apk,并且从AndroidManifest.xml文件获取信息和包签名，当使用java.util.jar.JarFile和相关类对每个条目提取签名验证证书时，apk的完整性会被自动验证。(系统应用是被隐式信任的，并且在解析时只验证AndroidManifest.xml的完整性，非系统应用全部文件都会被验证)。</li>
<li>一旦解析完毕packageinstalleractivity会在一个对话框里面显示该应用的相关信息和所需权限。用户点击确认后，packageinstalleractivity将Apk文件和manifest摘要发给InstallerAppProgress，然后由它启动实际的安装过程。manifest摘要包含了安装元数据，例如引用URL，安装包名和初始UID。</li>
<li>InstallerAppProgress将apk的url和安装元数据传递给PackageManagerService的installPackageWithVerificationAndEncryption()方法，从而启动安装进程。</li>
<li>安装方法首先验证调用者是否具备INSTALL_PACKAGES权限，该权限是signature保护的，并且系统应用默认拥有该权限(多用户系统验证)。</li>
<li>确定首选安装位置，可以是内存，或者sdcard。</li>
<li>如果apk文件没有加密，就不需要验证，下一步就是将它复制到应用程序的目录中（/data/app）。</li>
<li>当Apk文件成功复制后，它包含的任何本地库都会被提取到一个指定的app目录（/data/app-lib/）。</li>
<li>接下来，临时的apk和库目录均会被重命名为它们最终基于包名称的名字</li>
<li>包扫描，包管理器首先创建packagesettings结构，其中包括包名，代码路径，单独的资源路径和一个本地库路径。然后给新包赋予一个UID，并将其存在配置结构里。一旦新的app拥有UID，则其数据目录就可以创建了。</li>
<li>创建数据目录，调用install守护进程，创建数据目录(/data/data/包名，data/app-lib/包名，需要root权限)。</li>
<li>生成odex文件，如果是ART则生成本地机器代码。</li>
<li>将包添加到系统包的数据库中。</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-函数执行时间监控-hugo" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/02/07/函数执行时间监控-hugo/" class="article-date">
  	<time datetime="2017-02-06T16:00:00.000Z" itemprop="datePublished">2017-02-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/02/07/函数执行时间监控-hugo/">
        函数执行时间监控-hugo
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>在进行Android性能调优、减少应用卡顿时，寻找可优化的code是一个必要的过程。如何发现应用中的耗时任务甚至是耗时函数呢，如果可以在log中打印每个方法的执行时间，甚至把执行方法时的输入输出同时打印，绝对是非常棒的功能。</p>
<p><a href="https://github.com/JakeWharton/hugo">Hugo Githup 地址</a></p>
<h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><p>Hugo可以打印一个方法的输入参数和函数的运行时间：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DebugLog</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">(String first, String last)</span> </span>&#123;</span><br><span class="line">  SystemClock.sleep(<span class="number">15</span>); <span class="comment">// Don't ever really do this!</span></span><br><span class="line">  <span class="keyword">return</span> first + <span class="string">" "</span> + last;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">V/Example: ⇢ getName(first=<span class="string">"Jake"</span>, last=<span class="string">"Wharton"</span>)</span><br><span class="line">V/Example: ⇠ getName [<span class="number">16</span>ms] = <span class="string">"Jake Wharton"</span></span><br></pre></td></tr></table></figure>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>配置maven库：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">  repositories &#123;</span><br><span class="line">    mavenCentral()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  dependencies &#123;</span><br><span class="line">    classpath 'com.jakewharton.hugo:hugo-plugin:1.2.1'</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">apply plugin: 'com.android.application'</span><br><span class="line">apply plugin: 'com.jakewharton.hugo'</span><br></pre></td></tr></table></figure>
<p>不可用hugo：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hugo &#123;</span><br><span class="line">  enabled false</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>动态设置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hugo.setEnabled(<span class="keyword">true</span>|<span class="keyword">false</span>)</span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-性能优化 - java" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/01/17/性能优化 - java/" class="article-date">
  	<time datetime="2017-01-16T16:00:00.000Z" itemprop="datePublished">2017-01-17</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/17/性能优化 - java/">
        性能优化 - java
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="避免创建不必要的对象"><a href="#避免创建不必要的对象" class="headerlink" title="避免创建不必要的对象"></a>避免创建不必要的对象</h4><p>虽然GC可以回收不用的对象，可是为这些对象分配内存，并回收它们同样是需要耗费资源的。<br>因此请尽量避免创建不必要的对象，有下面一些例子来说明这个问题：</p>
<ul>
<li>如果你需要返回一个String对象，并且你知道它最终会需要连接到一个StringBuffer，请修改你的实现方式，避免直接进行连接操作，应该采用创建一个临时对象来做这个操作.</li>
<li>当从输入的数据集中抽取出Strings的时候，尝试返回原数据的substring对象，而不是创建一个重复的对象。<br>一个稍微激进点的做法是把所有多维的数据分解成1维的数组:</li>
<li>一组int数据要比一组Integer对象要好很多。可以得知，两组1维数组要比一个2维数组更加的有效率。同样的，这个道理可以推广至其他原始数据类型。</li>
<li>如果你需要实现一个数组用来存放(Foo,Bar)的对象，尝试分解为Foo[]与Bar[]要比(Foo,Bar)好很多。(当然，为了某些好的API的设计，可以适当做一些妥协。但是在自己的代码内部，你应该多多使用分解后的容易。<br>通常来说，需要避免创建更多的对象。更少的对象意味者更少的GC动作，GC会对用户体验有比较直接的影响。</li>
</ul>
<h4 id="常量声明为Static-Final"><a href="#常量声明为Static-Final" class="headerlink" title="常量声明为Static Final"></a>常量声明为Static Final</h4><p>编译器会在类首次被使用到的时候，使用初始化<clinit>方法来初始化上面的值，之后访问的时候会需要先到它那里查找，然后才返回数据。</clinit></p>
<p>这时再也不需要上面的那个方法来做多余的查找动作了。<br>所以，请尽可能的为常量声明为static final类型的。</p>
<h4 id="避免内部的Getters-Setters"><a href="#避免内部的Getters-Setters" class="headerlink" title="避免内部的Getters/Setters"></a>避免内部的Getters/Setters</h4><p>然而，在Android上，这是一个糟糕的写法。Virtual method的调用比起直接访问变量要耗费更多。那么合理的做法是：在面向对象的设计当中应该使用getter/setter，但是在类的内部你应该直接访问变量。</p>
<h4 id="使用增强的For循环写法"><a href="#使用增强的For循环写法" class="headerlink" title="使用增强的For循环写法"></a>使用增强的For循环写法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> mSplat;</span><br><span class="line">&#125;</span><br><span class="line">Foo[] mArray = ...</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">zero</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mArray.length; ++i) &#123;</span><br><span class="line">        sum += mArray[i].mSplat;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">one</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    Foo[] localArray = mArray;</span><br><span class="line">    <span class="keyword">int</span> len = localArray.length;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">        sum += localArray[i].mSplat;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">two</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (Foo a : mArray) &#123;</span><br><span class="line">        sum += a.mSplat;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>zero()是最慢的，因为JIT没有办法对它进行优化。</li>
<li>one()稍微快些。</li>
<li>two() 在没有做JIT时是最快的，可是如果经过JIT之后，与方法one()是差不多一样快的。它使用了增强的循环方法for-each。</li>
</ul>
<p>所以请尽量使用for-each的方法，但是对于ArrayList，请使用方法one()。</p>
<h4 id="使用包级访问而不是内部类的私有访问"><a href="#使用包级访问而不是内部类的私有访问" class="headerlink" title="使用包级访问而不是内部类的私有访问"></a>使用包级访问而不是内部类的私有访问</h4><h4 id="避免使用float类型"><a href="#避免使用float类型" class="headerlink" title="避免使用float类型"></a>避免使用float类型</h4><p>Android系统中float类型的数据存取速度是int类型的一半，尽量优先采用int类型。</p>
<h4 id="使用库函数"><a href="#使用库函数" class="headerlink" title="使用库函数"></a>使用库函数</h4><p>尽量使用System.arraycopy()等一些封装好的库函数，它的效率是手动编写copy实现的9倍多。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-shell脚本" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/01/12/shell脚本/" class="article-date">
  	<time datetime="2017-01-11T16:00:00.000Z" itemprop="datePublished">2017-01-12</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/12/shell脚本/">
        shell脚本
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="从第一行开始"><a href="#从第一行开始" class="headerlink" title="从第一行开始"></a>从第一行开始</h4><p>此行称为 shebang（就是 sharp (#) + bang (!) 的意思），会指引操作系统使用接下来指定的程序运行此文件.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br></pre></td></tr></table></figure>
<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p>Shell 变量默认全都是字符串。</p>
<h4 id="变量赋值和引用"><a href="#变量赋值和引用" class="headerlink" title="变量赋值和引用"></a>变量赋值和引用</h4><p>Shell 编程中，使用变量无需事先声明。变量名的命名遵守大小写字母数字和下划线组成，且不能以数字开头。请注意 shell 环境中的确有以数字和特殊符号开头的变量名，但是那些东西不可以用接下来的方式赋值。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">varname=值 [var2=val2 ....]</span><br></pre></td></tr></table></figure>
<h5 id="请注意这边等号左右不能有空格。-要取用一个变量的值，只需在变量名前面加一个"><a href="#请注意这边等号左右不能有空格。-要取用一个变量的值，只需在变量名前面加一个" class="headerlink" title="请注意这边等号左右不能有空格。 要取用一个变量的值，只需在变量名前面加一个 $"></a>请注意这边等号左右不能有空格。 要取用一个变量的值，只需在变量名前面加一个 $</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># assign</span></span><br><span class="line">a=<span class="string">"hello world"</span>  <span class="comment"># 等号两边均不能有空格存在</span></span><br><span class="line"><span class="comment"># print</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">'%s\n'</span> <span class="string">"A is: <span class="variable">$a</span>"</span></span><br></pre></td></tr></table></figure>
<p>有时候变量名可能会和其它文字（匹配最长的符合变量名或特殊变量名要求的内容）混淆，比如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">num=2</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"this is the <span class="variable">$numnd</span>"</span>   <span class="comment"># 输出 this is the       — shell 尝试寻找 $numnd 的值</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"this is the <span class="variable">$&#123;num&#125;</span>nd"</span> <span class="comment"># 输出 this is the 2nd   — 修好了！</span></span><br><span class="line"><span class="comment"># 花括号可以隔开变量名，但是放歪了的话…</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"this is the &#123;<span class="variable">$num</span>&#125;nd"</span> <span class="comment"># 输出 this is the &#123;2&#125;nd — 切是切开了，但是…</span></span><br></pre></td></tr></table></figure>
<h4 id="变量计算"><a href="#变量计算" class="headerlink" title="变量计算"></a>变量计算</h4><p>我们可以用很多方法达成我们的目标。首先是好孩子的方法——C 风格表达式。bash 里面可以用 (( )) 执行 C 风格的算术表达式。$(( )) 会展开成为这个 C 表达式求值的结果。以前 bash 有个 $[ ] 一样，但是别去用。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var=0</span><br><span class="line">(( var += 1 )) <span class="comment"># 这是一种，现在 var 是 1</span></span><br><span class="line">(( var++ ))    <span class="comment"># 这也是一种自增，2</span></span><br><span class="line">(( var = var * var )) <span class="comment"># 怎么来乘法了！var 现在是 4。</span></span><br><span class="line"><span class="built_in">let</span> <span class="string">'var = var / 3'</span>   <span class="comment"># 还是只有 bash 才能用的拓展。除法是整数除法，向 0 舍入，1。</span></span><br><span class="line"><span class="built_in">echo</span> $((var += 2))    <span class="comment"># echo 出 3，var 现在是 3。</span></span><br><span class="line">var=$((var-1))        <span class="comment"># 展开成 var=2，var 现在是……还用说吗，2。</span></span><br></pre></td></tr></table></figure>
<h3 id="Shell里的流程控制"><a href="#Shell里的流程控制" class="headerlink" title="Shell里的流程控制"></a>Shell里的流程控制</h3><h4 id="if语句"><a href="#if语句" class="headerlink" title="if语句"></a>if语句</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> </span><br><span class="line">  判断命令，可以有很多个，真假取最后的返回值</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  如果前述为真做什么</span><br><span class="line">[ <span class="comment"># 方括号代表可选，别真打进去了！</span></span><br><span class="line"><span class="keyword">elif</span></span><br><span class="line">  可以再来个判断，如果签名为假继续尝试这里</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  如果前述为真做什么 ]</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  如果全都不行做什么</span><br><span class="line"><span class="keyword">fi</span> <span class="comment"># 结束，就是倒写的 if 啦。</span></span><br></pre></td></tr></table></figure>
<h5 id="amp-amp-和-操作符"><a href="#amp-amp-和-操作符" class="headerlink" title="&amp;&amp; 和 || 操作符"></a>&amp;&amp; 和 || 操作符</h5><h5 id="case-语句"><a href="#case-语句" class="headerlink" title="case 语句"></a>case 语句</h5><p>case表达式可以用来匹配一个给定的字符串，而不是数字（可别和C语言里的switch…case混淆）。</p>
<p>我们利用这点写了一个名为smartzip的脚本，该脚本可以自动解压bzip2, gzip和zip 类型的压缩文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ftype=<span class="string">"<span class="variable">$(file "$1")</span>"</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$ftype</span>"</span> <span class="keyword">in</span></span><br><span class="line"><span class="string">"<span class="variable">$1</span>: Zip archive"</span>*)</span><br><span class="line">   unzip <span class="string">"<span class="variable">$1</span>"</span> ;;</span><br><span class="line"><span class="string">"<span class="variable">$1</span>: gzip compressed"</span>*)</span><br><span class="line">   gunzip <span class="string">"<span class="variable">$1</span>"</span> ;;</span><br><span class="line"><span class="string">"<span class="variable">$1</span>: bzip2 compressed"</span>*)</span><br><span class="line">   bunzip2 <span class="string">"<span class="variable">$1</span>"</span> ;;</span><br><span class="line">*)</span><br><span class="line">   <span class="built_in">echo</span> <span class="string">"File <span class="variable">$1</span> can not be uncompressed with smartzip"</span>;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>
<p>你可能注意到上面使用了一个特殊变量 $1，该变量包含有传递给该脚本的第一个参数值。也就是说，当我们运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smartzip articles.zip</span><br></pre></td></tr></table></figure>
<h4 id="select-循环语句"><a href="#select-循环语句" class="headerlink" title="select 循环语句"></a>select 循环语句</h4><p>select 循环语句是bash的一种扩展应用，擅长于交互式场合。<br>用户可以从一组不同的值中进行选择</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">pocket=()</span><br><span class="line">select var <span class="keyword">in</span> 跳跳糖 糖 很多糖 企鹅糖; <span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"除了 <span class="variable">$var</span> 还要什么吗？"</span></span><br><span class="line">  <span class="keyword">if</span> ((RANDOM%4 == 0)); <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"呀！时间不够了，快上车！"</span></span><br><span class="line">    <span class="built_in">break</span> <span class="comment"># break 还是那个 break</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  pocket+=(<span class="string">"<span class="variable">$var</span>"</span>)</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"你最后说的那个 <span class="variable">$var</span> 弄丢了……"</span></span><br><span class="line">IFS=<span class="string">'、'</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"现在口袋里只有：<span class="variable">$&#123;pocket[*]&#125;</span>。"</span></span><br><span class="line">IFS=$<span class="string">' \t\n'</span></span><br></pre></td></tr></table></figure>
<h4 id="while-for-循环"><a href="#while-for-循环" class="headerlink" title="while/for 循环"></a>while/for 循环</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> ...; <span class="keyword">do</span></span><br><span class="line">   ....</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>只要测试表达式条件为真，则while循环将一直运行。关键字”break”用来跳出循环，而关键字”continue”则可以跳过一个循环的余下部分，直接跳到下一次循环中。<br>for循环会查看一个字符串列表（字符串用空格分隔），并将其赋给一个变量：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> var <span class="keyword">in</span> ....; <span class="keyword">do</span></span><br><span class="line">   ....</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h3 id="Shell里的一些特殊符号"><a href="#Shell里的一些特殊符号" class="headerlink" title="Shell里的一些特殊符号"></a>Shell里的一些特殊符号</h3><h4 id="引号"><a href="#引号" class="headerlink" title="引号"></a>引号</h4><p>在向程序传递任何参数之前，程序会扩展通配符和变量。这里所谓的扩展是指程序会把通配符（比如*）替换成适当的文件名，把变量替换成变量值。我们可以使用引号来防止这种扩展，先来看一个例子，假设在当前目录下有两个jpg文件：mail.jpg和tux.jpg。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> *.jpg   <span class="comment"># =&gt; mail.jpg tux.jpg</span></span><br></pre></td></tr></table></figure>
<p>引号（单引号和双引号）可以防止通配符*的扩展：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"*.jpg"</span>  <span class="comment"># =&gt; *.jpg</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'*.jpg'</span>  <span class="comment"># =&gt; *.jpg</span></span><br></pre></td></tr></table></figure>
<p>其中单引号更严格一些，它可以防止任何变量扩展；而双引号可以防止通配符扩展但允许变量扩展：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$SHELL</span>   <span class="comment"># =&gt; /bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$SHELL</span>"</span> <span class="comment"># =&gt; /bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'$SHELL'</span> <span class="comment"># =&gt; $SHELL</span></span><br></pre></td></tr></table></figure>
<p>此外还有一种防止这种扩展的方法，即使用转义字符——反斜杠\：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> \*.jpg   <span class="comment"># =&gt; *.jpg</span></span><br><span class="line"><span class="built_in">echo</span> \<span class="variable">$SHELL</span>  <span class="comment"># =&gt; $SHELL</span></span><br></pre></td></tr></table></figure>
<h3 id="Shell里的函数"><a href="#Shell里的函数" class="headerlink" title="Shell里的函数"></a>Shell里的函数</h3><p>如果你写过比较复杂的脚本，就会发现可能在几个地方使用了相同的代码，这时如果用上函数，会方便很多。函数的大致样子如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 别笑，bash 里面函数名的确可以这样……</span></span><br><span class="line"><span class="comment"># (POSIX sh 函数名倒是和变量名要求差不多)</span></span><br><span class="line">我是一个函数() &#123;</span><br><span class="line">  <span class="comment"># 函数里面 $1 $2 对应函数所接受到的第一、第二……个参数。</span></span><br><span class="line">  这里有很多命令</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-app启动速度检测" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/01/06/app启动速度检测/" class="article-date">
  	<time datetime="2017-01-05T16:00:00.000Z" itemprop="datePublished">2017-01-06</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/06/app启动速度检测/">
        App启动速度检测
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="启动时间监控"><a href="#启动时间监控" class="headerlink" title="启动时间监控"></a>启动时间监控</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell am start -W -S packagename/activity</span><br></pre></td></tr></table></figure>
<ul>
<li>-W 列出启动过程中统计到的具体数据</li>
<li>-S 强制停止当前的Activity,重新启动</li>
</ul>
<h4 id="WaitTime"><a href="#WaitTime" class="headerlink" title="WaitTime"></a>WaitTime</h4><p>WaitTime 返回从 startActivity 到应用第一帧完全显示这段时间. 就是总的耗时，包括前一个应用 Activity pause 的时间和新应用启动的时间；</p>
<h4 id="ThisTime"><a href="#ThisTime" class="headerlink" title="ThisTime"></a>ThisTime</h4><p>ThisTime 表示一连串启动 Activity 的最后一个 Activity 的启动耗时；</p>
<h4 id="TotalTime"><a href="#TotalTime" class="headerlink" title="TotalTime"></a>TotalTime</h4><p>TotalTime 表示新应用启动的耗时，包括新进程的启动和 Activity 的启动，但不包括前一个应用Activity pause的耗时。</p>
<p>开发者一般只要关心 TotalTime 即可，这个时间才是自己应用真正启动的耗时。</p>
<h3 id="自动化统计脚本"><a href="#自动化统计脚本" class="headerlink" title="自动化统计脚本"></a>自动化统计脚本</h3><p>因为统计APP的启动速度，次数太少了会影响结果的准确性，所以为了方便，将之写成了脚本的形式，自动运行，自动计算，之后就一目了然了。</p>
<p>效果图：</p>
<p><img src="http://oc4zuck5v.bkt.clouddn.com/%E7%BB%93%E6%9E%9C.png" alt="结果"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">filePath=<span class="string">"/Users/shenyonghe/Desktop/qdsd.log"</span></span><br><span class="line">rm -f <span class="variable">$filePath</span></span><br><span class="line">sleep 1</span><br><span class="line">count=3 </span><br><span class="line">thisTime=0</span><br><span class="line">totalTime=0</span><br><span class="line">waitTime=0</span><br><span class="line">pageName=<span class="string">"com.baidao.futures"</span></span><br><span class="line">activityPath=<span class="string">"com.baidao.futures/com.baidao.futures.module.splash.SplashActivity"</span></span><br><span class="line"><span class="keyword">for</span>((i=0;i&lt;<span class="variable">$count</span>;i++))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    adb shell am start -W -S <span class="variable">$activityPath</span> | tee -a <span class="variable">$filePath</span></span><br><span class="line">    sleep 5</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> “============分割线============”</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	 <span class="comment">#筛选ThisTime</span></span><br><span class="line">     thisResult=$(<span class="built_in">echo</span> <span class="variable">$line</span> | grep <span class="string">"ThisTime:"</span>)</span><br><span class="line">     <span class="keyword">if</span> [[ <span class="string">"<span class="variable">$thisResult</span>"</span> != <span class="string">""</span> ]]</span><br><span class="line">     <span class="keyword">then</span></span><br><span class="line">     tmp=$(<span class="built_in">echo</span> <span class="variable">$line</span> | egrep -o <span class="string">'[0-9]+'</span>)</span><br><span class="line">     val=$((thisTime + tmp))</span><br><span class="line">     thisTime=<span class="variable">$val</span></span><br><span class="line">     <span class="keyword">fi</span> </span><br><span class="line"></span><br><span class="line">     <span class="comment">#筛选TotalTime</span></span><br><span class="line">     totalResult=$(<span class="built_in">echo</span> <span class="variable">$line</span> | grep <span class="string">"TotalTime:"</span>)</span><br><span class="line">     <span class="keyword">if</span> [[ <span class="string">"<span class="variable">$totalResult</span>"</span> != <span class="string">""</span> ]]</span><br><span class="line">     <span class="keyword">then</span></span><br><span class="line">     tmp=$(<span class="built_in">echo</span> <span class="variable">$line</span> | egrep -o <span class="string">'[0-9]+'</span>)</span><br><span class="line">     val=$((totalTime + tmp))</span><br><span class="line">     totalTime=<span class="variable">$val</span></span><br><span class="line">     <span class="keyword">fi</span> </span><br><span class="line"></span><br><span class="line">     <span class="comment">#筛选WaitTime</span></span><br><span class="line">     waitResult=$(<span class="built_in">echo</span> <span class="variable">$line</span> | grep <span class="string">"WaitTime:"</span>)</span><br><span class="line">     <span class="keyword">if</span> [[ <span class="string">"<span class="variable">$waitResult</span>"</span> != <span class="string">""</span> ]]</span><br><span class="line">     <span class="keyword">then</span></span><br><span class="line">     tmp=$(<span class="built_in">echo</span> <span class="variable">$line</span> | egrep -o <span class="string">'[0-9]+'</span>)</span><br><span class="line">     val=$((waitTime + tmp))</span><br><span class="line">     waitTime=<span class="variable">$val</span></span><br><span class="line">     <span class="keyword">fi</span> </span><br><span class="line"><span class="keyword">done</span> &lt; <span class="variable">$filePath</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'============分析结果============'</span> | tee -a <span class="variable">$filePath</span></span><br><span class="line">adb shell getprop ro.product.model | tee -a <span class="variable">$filePath</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'分析次数:'</span><span class="variable">$count</span> | tee -a <span class="variable">$filePath</span></span><br><span class="line">valThis=$((thisTime / count))</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'平均启动时间 ThisTime:'</span><span class="variable">$valThis</span> | tee -a <span class="variable">$filePath</span></span><br><span class="line">valTotal=$((totalTime / count))</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'平均启动时间 Totalime:'</span><span class="variable">$valTotal</span> | tee -a <span class="variable">$filePath</span></span><br><span class="line">valWait=$((waitTime / count))</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'平均启动时间 WaitTime:'</span><span class="variable">$valWait</span> | tee -a <span class="variable">$filePath</span></span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-自动化测试Espresso" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/12/23/自动化测试Espresso/" class="article-date">
  	<time datetime="2016-12-22T16:00:00.000Z" itemprop="datePublished">2016-12-23</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/23/自动化测试Espresso/">
        Espresso
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>Espresso 也是一款自动化测试的框架，和UiAutomator类似。<br>基本上使用流程和UiAutomator类似。</p>
<h4 id="步骤："><a href="#步骤：" class="headerlink" title="步骤："></a>步骤：</h4><ul>
<li>查找元素：找到UI上测试的元素位置，比如找到一个按钮</li>
<li>执行操作：给某个元素执行一个动作，比如触发按钮的点击事件</li>
<li>检查结果：判断做出的动作是否符合期望，比如按钮点击后，是否符合我的期望</li>
</ul>
<h3 id="访问UI元素"><a href="#访问UI元素" class="headerlink" title="访问UI元素"></a>访问UI元素</h3><p>对比与UiAutomator，Espresso可以直接根据id来访问元素，同样Espresso也是可以根据文本信息匹配进行访问的。<br>Espresso 提供onView()方法来访问UI元素，然后在执行一种操作，最后再进行验证。</p>
<p>下面的一个代码示例，表示访问一个EditText，输入一些内容，关闭输入法，最后点击按钮。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testChangeText_sameActivity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Type text and then press the button.</span></span><br><span class="line">    onView(withId(R.id.editTextUserInput)).perform(typeText(STRING_TO_BE_TYPED), closeSoftKeyboard());</span><br><span class="line">    onView(withId(R.id.changeTextButton)).perform(click());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="使用withId-进行Id访问，也可以使用withText-进行文本匹配。"><a href="#使用withId-进行Id访问，也可以使用withText-进行文本匹配。" class="headerlink" title="使用withId()进行Id访问，也可以使用withText()进行文本匹配。"></a>使用withId()进行Id访问，也可以使用withText()进行文本匹配。</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Espresso.onView(ViewMatchers.withText(<span class="string">"Sign-in"</span>));</span><br><span class="line">Espresso.onView(ViewMatchers.withId(R.id.button_signin));</span><br></pre></td></tr></table></figure>
<h4 id="结合-Hamcrest库中的Matchers，可以使用allOf-来组合选择多个UI元素。"><a href="#结合-Hamcrest库中的Matchers，可以使用allOf-来组合选择多个UI元素。" class="headerlink" title="结合 Hamcrest库中的Matchers，可以使用allOf()来组合选择多个UI元素。"></a>结合 Hamcrest库中的Matchers，可以使用allOf()来组合选择多个UI元素。</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">onView(allOf(withId(R.id.button_signin), withText(<span class="string">"Sign-in"</span>)));</span><br><span class="line">onView(allOf(withId(R.id.button_signin), not(withText(<span class="string">"Sign-out"</span>))));</span><br></pre></td></tr></table></figure>
<h3 id="执行动作"><a href="#执行动作" class="headerlink" title="执行动作"></a>执行动作</h3><p>调用ViewInteraction.perform()和 DataInteraction.perform()，可以模拟用户执行UI元素的操作。可以指定一个或者多个动作，Espresso会按照指定的顺序，依次发送动作事件，这些动作是线程安全的。</p>
<p>ViewActions 可以提供一些列常用的方法，我们可以利用写方法来操作UI元素。</p>
<ul>
<li>ViewActions.click(): 点击事件</li>
<li>ViewActions.typeText(): 输入指定的文字内容</li>
<li>ViewActions.scrollTo(): 滑动</li>
<li>ViewActions.pressKey(): 按下按键</li>
<li>ViewActions.clearText(): 清空文本</li>
<li>ViewActions.pressBack() 返回键</li>
<li>ViewActions.pressMenuKey() 菜单键</li>
<li>ViewActions.doubleClick() 双击</li>
<li>ViewActions.longClick() 长按</li>
<li>ViewActions.closeSoftKeyboard() 收起键盘</li>
<li>ViewActions.swipeLeft(): 从右向左滑动</li>
<li>ViewActions.swipeRight(): 从左向右滑动</li>
<li>ViewActions.swipeDown(): 从上向下滑动</li>
<li>ViewActions.swipeUp(): 从下向上滑动</li>
</ul>
<p>注意：</p>
<ul>
<li>输入内容时，会出现无法输入的状况，一般是由于键盘类型导致的，切换为系统的google输入法就OK了。</li>
</ul>
<h3 id="在命令行中通过-Gradle-执行"><a href="#在命令行中通过-Gradle-执行" class="headerlink" title="在命令行中通过 Gradle 执行"></a>在命令行中通过 Gradle 执行</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ​./gradlew connectedAndroidTest</span><br><span class="line">    等价于</span><br><span class="line">$ ./gradlew cAT</span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-RSA加密" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/12/20/RSA加密/" class="article-date">
  	<time datetime="2016-12-19T16:00:00.000Z" itemprop="datePublished">2016-12-20</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/20/RSA加密/">
        RSA
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>RSA是一种非对称加密算法，常用来对传输数据进行加密，配合上数字摘要算法，也可以进行文字签名。</p>
<h3 id="加密方式"><a href="#加密方式" class="headerlink" title="加密方式"></a>加密方式</h3><ul>
<li><p>加密：公钥放在客户端，并使用公钥对数据进行加密，服务端拿到数据后用私钥进行解密；</p>
</li>
<li><p>加签：私钥放在客户端，并使用私钥对数据进行加签，服务端拿到数据后用公钥进行验签。</p>
</li>
</ul>
<p>前者完全为了加密；后者主要是为了防恶意攻击，防止别人模拟我们的客户端对我们的服务器进行攻击，导致服务器瘫痪。</p>
<p>RSA使用“密钥对”对数据进行加密解密，在加密解密前需要先生存公钥（Public Key）和私钥（Private Key）。</p>
<ul>
<li><p>公钥(Public key): 用于加密数据. 用于公开, 一般存放在数据提供方, 例如iOS客户端。</p>
</li>
<li><p>私钥(Private key): 用于解密数据. 必须保密, 私钥泄露会造成安全问题。</p>
</li>
</ul>
<h3 id="生成公钥私钥"><a href="#生成公钥私钥" class="headerlink" title="生成公钥私钥"></a>生成公钥私钥</h3><h4 id="1-生成模长为1024bit的私钥"><a href="#1-生成模长为1024bit的私钥" class="headerlink" title="1 生成模长为1024bit的私钥"></a>1 生成模长为1024bit的私钥</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ openssl </span><br><span class="line">$ genrsa -out private_key.pem 1024</span><br></pre></td></tr></table></figure>
<h4 id="2-生成certification-require-file"><a href="#2-生成certification-require-file" class="headerlink" title="2 生成certification require file"></a>2 生成certification require file</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ openssl </span><br><span class="line">$ req -new -key private_key.pem -out rsaCertReq.csr</span><br></pre></td></tr></table></figure>
<h4 id="3-生成certification-并指定过期时间"><a href="#3-生成certification-并指定过期时间" class="headerlink" title="3 生成certification 并指定过期时间"></a>3 生成certification 并指定过期时间</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ openssl </span><br><span class="line">$ x509 -req -days 3650 -<span class="keyword">in</span> rsaCertReq.csr -signkey private_key.pem -out rsaCert.crt</span><br></pre></td></tr></table></figure>
<h4 id="4-生成java公钥"><a href="#4-生成java公钥" class="headerlink" title="4 生成java公钥"></a>4 生成java公钥</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rsa -<span class="keyword">in</span> private_key.pem -pubout -out public_key.pem</span><br></pre></td></tr></table></figure>
<h4 id="5-生成pem结尾的私钥供Java使用-需要验证密码"><a href="#5-生成pem结尾的私钥供Java使用-需要验证密码" class="headerlink" title="5 生成pem结尾的私钥供Java使用(需要验证密码)"></a>5 生成pem结尾的私钥供Java使用(需要验证密码)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ openssl </span><br><span class="line">$ pkcs8 -topk8 -<span class="keyword">in</span> private_key.pem -out pkcs8_private_key.pem -nocrypt</span><br></pre></td></tr></table></figure>
<h4 id="6-生成公钥供iOS使用"><a href="#6-生成公钥供iOS使用" class="headerlink" title="6 生成公钥供iOS使用"></a>6 生成公钥供iOS使用</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ openssl </span><br><span class="line"><span class="variable">$x509</span> -outform der -<span class="keyword">in</span> rsaCert.crt -out public_key.der</span><br></pre></td></tr></table></figure>
<h4 id="7-生成私钥供iOS使用-这边会让你输入密码，后期用到在生成secKeyRef的时候会用到这个密码"><a href="#7-生成私钥供iOS使用-这边会让你输入密码，后期用到在生成secKeyRef的时候会用到这个密码" class="headerlink" title="7 生成私钥供iOS使用 这边会让你输入密码，后期用到在生成secKeyRef的时候会用到这个密码"></a>7 生成私钥供iOS使用 这边会让你输入密码，后期用到在生成secKeyRef的时候会用到这个密码</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ openssl </span><br><span class="line">$ pkcs12 -<span class="built_in">export</span> -out private_key.p12 -inkey private_key.pem -<span class="keyword">in</span> rsaCert.crt</span><br></pre></td></tr></table></figure>
<h4 id="8-查看公钥私钥内容"><a href="#8-查看公钥私钥内容" class="headerlink" title="8 查看公钥私钥内容"></a>8 查看公钥私钥内容</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat public_key.pem/private_key.pem</span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-jrebel" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/12/16/jrebel/" class="article-date">
  	<time datetime="2016-12-15T16:00:00.000Z" itemprop="datePublished">2016-12-16</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/16/jrebel/">
        Android  jrebel
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>Jrebel 是一款 Java 程序的开发工具，它允许你的应用程序代码更新之后不用重新部署或重启。毫无疑问，支持 Android 应用程序，无须配置，使用起来超简单方便，亲测确实很快速，能极大的节省你调试的时间，<a href="https://zeroturnaround.com/" target="_blank" rel="noopener">官方地址：</a></p>
<h3 id="安装与使用"><a href="#安装与使用" class="headerlink" title="安装与使用"></a>安装与使用</h3><p>AS:打开 Preference -&gt; Plugins -&gt; Browse Repositories ，搜索 JRebel ，直接点击安装。</p>
<p>安装成功之后重启 AS，然后会发现在顶部工具栏会出现如下三个按钮：</p>
<ul>
<li>Run app with JRebel for Android</li>
<li>Debug app with JRebel for Android</li>
<li>Apply changes with JRebel for Android</li>
</ul>
<p>顾名思义，一般我们只需要第一次安装的时候使用第一个按钮运行一次，之后代码变动，只需要点击第三个按钮，你的真机或者模拟器很快就展示出来修改代码之后的效果。</p>
<p>最后，还有一个很关键的，JRebel 是收费的，个人用户每年要 49 刀，还是蛮贵的，不过如果每天可以节省你几十分钟甚至成个小时的时间，一年下来这些时间相较这个价格来说是很合算的。但是如果你不想付费，这里也有一个方法，可以去官网用邮箱注册个账号获取体验码，可以免费体验 21 天，21 天到期之后你可以重新注册，据说官方对邮件没有验证，感兴趣的同学不妨试下。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-7.0适配问题" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/12/11/7.0适配问题/" class="article-date">
  	<time datetime="2016-12-10T16:00:00.000Z" itemprop="datePublished">2016-12-11</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/11/7.0适配问题/">
        Android7.0变更以及适配问题
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>Android 7.0 除了提供诸多新特性和功能外，还对系统和 API 行为做出了各种变更。本文重点介绍您应该了解并在开发应用时加以考虑的一些主要变更。</p>
<h3 id="电池和内存"><a href="#电池和内存" class="headerlink" title="电池和内存"></a>电池和内存</h3><p>Android 7.0 包括旨在延长设备电池寿命和减少 RAM 使用的系统行为变更。这些变更可能会影响应用访问系统资源，以及应用通过特定隐式 intent 与其他应用交互的方式。</p>
<h4 id="低电耗模式"><a href="#低电耗模式" class="headerlink" title="低电耗模式"></a>低电耗模式</h4><p>Android 6.0（API 级别 23）引入了低电耗模式，当用户设备未插接电源、处于静止状态且屏幕关闭时，该模式会推迟 CPU 和网络活动，从而延长电池寿命。而 Android 7.0 则通过在设备未插接电源且屏幕关闭状态下、但不一定要处于静止状态（例如用户外出时把手持式设备装在口袋里）时应用部分 CPU 和网络限制，进一步增强了低电耗模式。</p>
<p>当设备处于充电状态且屏幕已关闭一定时间后，设备会进入低电耗模式并应用第一部分限制：</p>
<ul>
<li>关闭应用网络访问、推迟作业和同步。</li>
</ul>
<p>如果进入低电耗模式后设备处于静止状态达到一定时间:</p>
<ul>
<li>系统则会对 PowerManager.WakeLock、AlarmManager 闹铃、GPS 和 WLAN 扫描应用余下的低电耗模式限制。</li>
</ul>
<font color="#0099ff" size="2" face="黑体">无论是应用部分还是全部低电耗模式限制，系统都会唤醒设备以提供简短的维护时间窗口，在此窗口期间，应用程序可以访问网络并执行任何被推迟的作业/同步(9分钟)。</font>

<ul>
<li>从6.0的推迟访问到7.0的限制访问，这个时候我们要做好低功耗模式下的处理。</li>
</ul>
<h4 id="低电耗模式限制"><a href="#低电耗模式限制" class="headerlink" title="低电耗模式限制"></a>低电耗模式限制</h4><p>在低电耗模式下，您的应用会受到以下限制：</p>
<ul>
<li>暂停访问网络。</li>
<li>系统将忽略 wake locks。</li>
<li>标准 AlarmManager 闹铃（包括 setExact() 和 setWindow()）  推迟到下一维护时段。</li>
<li>如果您需要设置在低电耗模式下触发的闹铃，请使用 * setAndAllowWhileIdle() 或 setExactAndAllowWhileIdle()。<br>一般情况下，使用 setAlarmClock() 设置的闹铃将继续触发 — 但系统会在这些闹铃触发之前不久退出低电耗模式。</li>
<li>系统不执行 Wi-Fi 扫描。</li>
<li>系统不允许运行同步适配器。</li>
<li>系统不允许运行 JobScheduler。</li>
<li>低电耗模式检查清单<br>如果可能，请使用 GCM 进行下游消息传递。</li>
<li>如果您的用户必须立即查看通知，请务必使用 GCM 高优先级消息。</li>
<li>在初始消息负载中提供足够的信息，这样随后就无需访问网络。</li>
<li>使用 setAndAllowWhileIdle() 和 setExactAndAllowWhileIdle() 设置关键闹铃。</li>
</ul>
<h3 id="后台优化"><a href="#后台优化" class="headerlink" title="后台优化"></a>后台优化</h3><p>Android 7.0 移除了三项隐式广播，以帮助优化内存使用和电量消耗。此项变更很有必要，因为隐式广播会在后台频繁启动已注册侦听这些广播的应用。删除这些广播可以显著提升设备性能和用户体验。</p>
<p>移动设备会经历频繁的连接变更，例如在 WLAN 和移动数据之间切换时。目前，可以通过在应用清单中注册一个接收器来侦听隐式 CONNECTIVITY_ACTION 广播，让应用能够监控这些变更。由于很多应用会注册接收此广播，因此单次网络切换即会导致所有应用被唤醒并同时处理此广播。</p>
<p>同理，在之前版本的 Android 中，应用可以注册接收来自其他应用（例如相机）的隐式 ACTION_NEW_PICTURE 和 ACTION_NEW_VIDEO 广播。当用户使用相机应用拍摄照片时，这些应用即会被唤醒以处理广播。</p>
<p>为缓解这些问题，Android 7.0 应用了以下优化措施：</p>
<p>面向 Android 7.0 开发的应用不会收到 CONNECTIVITY_ACTION 广播，即使它们已有清单条目来请求接受这些事件的通知。在前台运行的应用如果使用 BroadcastReceiver 请求接收通知，则仍可以在主线程中侦听 CONNECTIVITY_CHANGE。<br>应用无法发送或接收 ACTION_NEW_PICTURE 或 ACTION_NEW_VIDEO 广播。此项优化会影响所有应用，而不仅仅是面向 Android 7.0 的应用。<br>如果您的应用使用任何 intent，您仍需要尽快移除它们的依赖关系，以正确适配 Android 7.0 设备。Android 框架提供多个解决方案来缓解对这些隐式广播的需求。例如，JobScheduler API 提供了一个稳健可靠的机制来安排满足指定条件（例如连入无限流量网络）时所执行的网络操作。您甚至可以使用 JobScheduler 来适应内容提供程序变化。</p>
<ul>
<li>移除了三项隐式广播，网络变化，照相和录视频。网络变化在前台可以监听，其他两项完全删除，删除的两项面向所有API。</li>
</ul>
<h3 id="权限变更"><a href="#权限变更" class="headerlink" title="权限变更"></a>权限变更</h3><h4 id="系统权限更改"><a href="#系统权限更改" class="headerlink" title="系统权限更改"></a>系统权限更改</h4><p>为了提高私有文件的安全性，面向 Android 7.0 或更高版本的应用私有目录被限制访问　(0700)。此设置可防止私有文件的元数据泄漏，如它们的大小或存在性。此权限更改有多重副作用：</p>
<ul>
<li>私有文件的文件权限不应再由所有者放宽，为使用 MODE_WORLD_READABLE 和/或 MODE_WORLD_WRITEABLE 而进行的此类尝试将触发 SecurityException。（用来控制其他应用是否有权限读写该文件权限受限）</li>
</ul>
<p>注：迄今为止，这种限制尚不能完全执行。应用仍可能使用原生 API 或 File API 来修改它们的私有目录权限。但是，我们强烈反对放宽私有目录的权限。</p>
<ul>
<li><p>传递软件包网域外的 file:// URI 可能给接收器留下无法访问的路径。因此，尝试传递 file:// URI 会触发 FileUriExposedException。分享私有文件内容的推荐方法是使用 FileProvider。</p>
</li>
<li><p>DownloadManager 不再按文件名分享私人存储的文件。旧版应用在访问 COLUMN_LOCAL_FILENAME 时可能出现无法访问的路径。面向 Android 7.0 或更高版本的应用在尝试访问 COLUMN_LOCAL_FILENAME 时会触发 SecurityException。通过使用 DownloadManager.Request.setDestinationInExternalFilesDir() 或 DownloadManager.Request.setDestinationInExternalPublicDir() 将下载位置设置为公共位置的旧版应用仍可以访问 COLUMN_LOCAL_FILENAME 中的路径，但是我们强烈反对使用这种方法。对于由 DownloadManager 公开的文件，首选的访问方式是使用ContentResolver.openFileDescriptor()。</p>
</li>
</ul>
<h4 id="在应用间共享文件"><a href="#在应用间共享文件" class="headerlink" title="在应用间共享文件"></a>在应用间共享文件</h4><p>对于面向 Android 7.0 的应用，Android 框架执行的 StrictMode API 政策禁止在您的应用外部公开 file:// URI。如果一项包含文件 URI 的 intent 离开您的应用，则应用出现故障，并出现 FileUriExposedException 异常。</p>
<p>要在应用间共享文件，您应发送一项 content:// URI，并授予 URI 临时访问权限。进行此授权的最简单方式是使用 FileProvider 类。</p>
<h3 id="无障碍改进"><a href="#无障碍改进" class="headerlink" title="无障碍改进"></a>无障碍改进</h3><h4 id="屏幕缩放"><a href="#屏幕缩放" class="headerlink" title="屏幕缩放"></a>屏幕缩放</h4><p>Android 7.0 支持用户设置显示尺寸，以放大或缩小屏幕上的所有元素，从而提升设备对视力不佳用户的可访问性。用户无法将屏幕缩放至低于最小屏幕宽度 sw320dp，该宽度是 Nexus 4 的宽度，也是常规中等大小手机的宽度。</p>
<ul>
<li><p>当设备密度发生更改时，系统会以如下方式通知正在运行的应用：</p>
</li>
<li><p>如果是面向 API 级别 23 或更低版本系统的应用，系统会自动终止其所有后台进程。这意味着如果用户切换离开此类应用，转而打开 Settings 屏幕并更改 Display size 设置，则系统会像处理内存不足的情况一样终止该应用。如果应用具有任何前台进程，则系统会如处理运行时更改中所述将配置变更通知给这些进程，就像对待设备屏幕方向变更一样。</p>
</li>
<li>如果是面向 Android 7.0 的应用，则其所有进程（前台和后台）都会收到有关配置变更的通知，如处理运行时更改中所述。<br>大多数应用并不需要进行任何更改即可支持此功能，不过前提是这些应用遵循 Android 最佳做法。具体要检查的事项：</li>
<li>在屏幕宽度为 sw320dp 的设备上测试您的应用，并确保其充分运行。</li>
<li>当设备配置发生变更时，更新任何与密度相关的缓存信息，例如缓存位图或从网络加载的资源。当应用从暂停状态恢复运行时，检查配置变更。<br>注：如果您要缓存与配置相关的数据，则最好也包括相关元数据，例如该数据对应的屏幕尺寸或像素密度。保存这些元数据便于您在配置变更后决定是否需要刷新缓存数据。</li>
<li>避免用像素单位指定尺寸，因为像素不会随屏幕密度缩放。应改为使用与密度无关像素 (dp) 单位指定尺寸。</li>
</ul>
<h3 id="NDK-应用链接至平台库"><a href="#NDK-应用链接至平台库" class="headerlink" title="NDK 应用链接至平台库"></a>NDK 应用链接至平台库</h3><p>从 Android 7.0 开始，系统将阻止应用动态链接非公开 NDK 库，这种库可能会导致您的应用崩溃。此行为变更旨在为跨平台更新和不同设备提供统一的应用体验。即使您的代码可能不会链接私有库，但您的应用中的第三方静态库可能会这么做。因此，所有开发者都应进行相应检查，确保他们的应用不会在运行 Android 7.0 的设备上崩溃。如果您的应用使用原生代码，则只能使用公开 NDK API。</p>
<p>您的应用可通过以下三种方式尝试访问私有平台 API：</p>
<ul>
<li>您的应用直接访问私有平台库。您应更新您的应用以添加该应用的库副本，或使用公开 NDK API。</li>
<li>您的应用使用一个可访问私有平台库的第三方库。即使您确定您的应用不会直接访问私有库，您仍应针对此情景测试您的应用。</li>
<li>您的应用引用一个其 APK 中未包含的库。例如，如果您尝试使用您自己的 OpenSSL 副本，但忘记将它与应用的 APK 进行捆绑，则可能会出现此情况。正常情况下，此应用可在包含 libcrypto.so 的 Android 平台版本上运行。不过，此应用在不包含此库的新版 Android（例如，Android 6.0 和更高的版本）上会崩溃。为修复此问题，请确保您的 APK 捆绑您的所有非 NDK 库。</li>
<li><p>应用不应使用 NDK 中未包含的原生库，因为这些库可能会发生更改或在不同 Android 版本之间的可用性不同。例如，从 OpenSSL 切换至 BoringSSL 即属于此类更改。此外，由于不属于 NDK 中的平台库没有兼容性要求，因此不同的设备可能提供不同级别的兼容性。</p>
</li>
<li><p>为降低此限制可能对当前发布的应用的影响，面向 API 级别 23 或更低级别的应用在 Android N 上可暂时访问颇为常用的一组库，例如 libandroid_runtime.so、libcutils.so、libcrypto.so 和 libssl.so。如果您的应用加载其中某个库，logcat 会生成一个警告，并在目标设备上显示一个 Toast 来通知您。如果您看到这些警告，您应更新您的应用以添加该应用自己的库副本，或仅使用公开 NDK API。将来发布的 Android 平台可能会完全限制对私有库的使用，并导致您的应用崩溃。</p>
</li>
<li><p>所有应用在调用既非公开又不可暂时访问的 API 时都会生成一个运行时错误。结果就是 System.loadLibrary 和 dlopen(3) 同时返回 NULL，并可能导致您的应用崩溃。您应检查应用代码以移除对私有平台 API 的使用，并使用预览版设备或模拟器全面测试应用。如果您不确定您的应用是否使用私有库，您可以检查 logcat 以识别运行时错误。</p>
</li>
<li><p>下表描述的是根据应用使用的私有原生库及其目标 API 级别 (android:targetSdkVersion)，应用预期显示的行为。</p>
</li>
</ul>
<p><img src="http://oc4zuck5v.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-12-11%20%E4%B8%8B%E5%8D%882.02.33.png" alt="图片"></p>
<h3 id="Android-for-Work"><a href="#Android-for-Work" class="headerlink" title="Android for Work"></a>Android for Work</h3><p>Android 7.0 包含一些针对面向 Android for Work 的应用的变更，包括对证书安装、密码重置、二级用户管理、设备标识符访问权限的变更。如果您是要针对 Android for Work 环境开发应用，则应仔细检查这些变更并相应地修改您的应用。</p>
<ul>
<li><p>您必须先安装授权证书安装程序，然后 DPC 才能对其进行设置。对于面向 N SDK 的配置文件和设备所有者应用，您应在设备规范控制器 (DPC) 调用 DevicePolicyManager.setCertInstallerPackage() 之前安装授权证书安装程序。如果尚未安装此安装程序，则系统会引发 IllegalArgumentException。</p>
</li>
<li><p>针对设备管理员的重置密码限制现在也适用于配置文件所有者。设备管理员无法再使用 DevicePolicyManager.resetPassword() 来清除或更改已经设置的密码。设备管理员仍可以设置密码，但只能在设备没有密码、PIN 码或图案时这样做。</p>
</li>
<li><p>即使设置了限制，设备所有者和配置文件所有者仍可以管理帐户。而且，即使具有 DISALLOW_MODIFY_ACCOUNTS 用户限制，设备所有者和配置文件所有者仍可调用 Account Management API。</p>
</li>
<li><p>设备所有者可以更轻松地管理二级用户。当设备在设备所有者模式下运行时，系统将自动设置 DISALLOW_ADD_USER 限制。这样可以防止用户创建非托管二级用户。此外，CreateUser() 和 createAndInitializeUser() 方法已弃用，取而代之的是 DevicePolicyManager.createAndManageUser() 方法。</p>
</li>
<li><p>设备所有者可以访问设备标识符。设备所有者可以使用 DevicePolicyManagewr.getWifiMacAddress() 访问设备的 WLAN MAC 地址。如果设备上从未启用 WLAN，则此方法将返回一个 null 值。</p>
</li>
<li><p>工作模式设置控制工作应用访问。当工作模式关闭时，系统启动器通过使工作应用显示为灰色来指示它们不可用。启用工作模式会再次恢复正常行为。</p>
</li>
<li><p>从 Settings UI 安装包含客户端证书链和对应的私钥的 PKCS #12 文件时，系统不再将该证书链中的 CA 证书安装到受信任的凭据存储空间。当应用稍后尝试检索客户端证书链时，这不会影响 KeyChain.getCertificateChain() 的结果。如果需要，使用 .crt 或 .cer 文件扩展名的 DER 编码格式通过 Settings UI 单独将 CA 证书安装到受信任的凭据存储空间。</p>
</li>
<li><p>从 Android 7.0 开始，可针对每个用户管理指纹登记和存储空间。如果配置文件所有者的设备规范客户端 (DPC) 面向 Android N 设备上的 Android N 之前的版本，则用户仍可以在该设备上设置指纹，但工作应用不能访问设备指纹。当 DPC 面向 Android N 和更高版本时，用户可以通过转到 Settings &gt; Security &gt; Work profile security 专门为托管配置文件设置指纹。</p>
</li>
<li><p>DevicePolicyManager.getStorageEncryptionStatus() 返回新的加密状态 ENCRYPTION_STATUS_ACTIVE_PER_USER，以表明加密处于活动状态，且加密密钥与用户关联。仅当 DPC 面向 API 级别 24 和更高级别时才会返回新的状态。对于面向更早的 API 级别的应用，即使加密密钥是用户或配置文件特有的，系统也会返回 ENCRYPTION_STATUS_ACTIVE。</p>
</li>
<li><p>在 Android 7.0 中，如果设备通过单独的工作挑战安装了托管配置文件，则原本通常会影响整个设备的多个方法将会改变其行为方式。这些方法将仅应用于托管配置文件，而不是影响整个设备。（此类方法的完整列表位于 DevicePolicyManager.getParentProfileInstance() 文档中。）例如，DevicePolicyManager.lockNow() 只锁定托管配置文件，而不是锁定整个设备。对于上述每个方法，您可以通过对 DevicePolicyManager 的父实例调用该方法来获取以前的行为；您可以通过调用 DevicePolicyManager.getParentProfileInstance() 获取此父项。例如，如果您调用父实例的 lockNow() 方法，则整个设备将被锁定。</p>
</li>
</ul>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li><p>如果一个应用在 Android 7.0 上运行，但却是针对更低 API 级别开发的，那么在用户更改显示尺寸时，系统将终止此应用进程。应用必须能够妥善处理此情景。否则，当用户从最近使用记录中恢复运行应用时，应用将会出现崩溃现象。<br>您应测试应用以确保不会发生此行为。要进行此测试，您可以通过 DDMS 手动终止应用，以造成相同的崩溃现象。<br>在密度发生更改时，系统不会自动终止面向 N 及更高版本的应用；不过，这些应用仍可能对配置变更做出不良响应。</p>
</li>
<li><p>Android 7.0 上的应用应能够妥善处理配置变更，并且在后续启动时不会出现崩溃现象。您可以通过更改字体大小 (Setting &gt;Display &gt; Font size) 并随后从最近使用记录中恢复运行应用，来验证应用行为。</p>
</li>
<li><p>由于之前的 Android 版本中的一项错误，系统未能将对主线程上的一个 TCP 套接字的写入操作举报为违反严格模式。Android 7.0 修复了此错误。呈现出这种行为的应用现在会引发 android.os.NetworkOnMainThreadException。一般情况下，我们不建议在主线程上执行网络操作，因为这些操作通常会出现可能导致 ANR 和卡顿的高尾延迟。</p>
</li>
<li><p>Debug.startMethodTracing() 方法系列现在默认在您的共享存储空间上的软件包特定目录中存储输出，而非 SD 卡根目录。这意味着应用不再需要请求 WRITE_EXTERNAL_STORAGE 权限来使用这些 API 。</p>
</li>
<li><p>许多平台 API 现在开始检查在 Binder 事务间发送的大负载，系统现在会将 TransactionTooLargeExceptions 作为 RuntimeExceptions 再次引发，而不再只是默默记录或抑制它们。一个常见例子是在 Activity.onSaveInstanceState() 上存储过多数据，导致 ActivityThread.StopInfo 在您的应用面向 Android 7.0 时引发 RuntimeException。</p>
</li>
<li><p>如果应用向 View 发布 Runnable 任务，并且 View 未附加到窗口，系统会用 View 为 Runnable 任务排队；在 View 附加到窗口之前，不会执行 Runnable 任务。此行为会修复以下错误：</p>
<pre><code>如果一项应用是从并非预期窗口 UI 线程的其他线程发布到 View，则 Runnable 可能会因此运行错误的线程。

如果 Runnable 任务是从并非环路线程的其他线程发布，则应用可能会曝光 Runnable 任务。
</code></pre></li>
<li><p>如果 Android 7.0 上一项有 DELETE_PACKAGES 权限的应用尝试删除一个软件包，但另一项应用已经安装了这个软件包，则系统需要用户进行确认。在这种情况下，应用在调用 PackageInstaller.uninstall() 时预计的返回状态应为 STATUS_PENDING_USER_ACTION。</p>
</li>
<li><p>名为 Crypto 的 JCA 提供程序已弃用，因为它仅有的 SHA1PRNG 算法为弱加密。应用无法再使用 SHA1PRNG（不安全地）派生密钥，因为不再提供此提供程序。如需了解详细信息，请参阅博文 Android N 中已弃用“Crypto”安全提供程序</p>
</li>
</ul>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><h4 id="打开系统相机或者图片裁剪崩溃"><a href="#打开系统相机或者图片裁剪崩溃" class="headerlink" title="打开系统相机或者图片裁剪崩溃"></a>打开系统相机或者图片裁剪崩溃</h4><p>问题就出现在Uri uri = Uri.parse(“file://“+ path),Uri.fromFile(file); 按照Android N的要求，若要在应用间共享文件，您应发送一项 content://URI，并授予 URI 临时访问权限。</p>
<p>FileProvider 的使用:</p>
<h5 id="注册provider"><a href="#注册provider" class="headerlink" title="注册provider"></a>注册provider</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">provider</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:name</span>=<span class="string">"android.support.v4.content.FileProvider"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:authorities</span>=<span class="string">"cn.lovexiaoai.myapp.fileprovider"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:grantUriPermissions</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:exported</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">meta-data</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">android:name</span>=<span class="string">"android.support.FILE_PROVIDER_PATHS"</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">android:resource</span>=<span class="string">"@xml/filepaths"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">provider</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="资源文件下创建相应的xml文件（如上：则创建filepaths-xml）"><a href="#资源文件下创建相应的xml文件（如上：则创建filepaths-xml）" class="headerlink" title="资源文件下创建相应的xml文件（如上：则创建filepaths.xml）"></a>资源文件下创建相应的xml文件（如上：则创建filepaths.xml）</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">paths</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">external-path</span> <span class="attr">path</span>=<span class="string">"images"</span> <span class="attr">name</span>=<span class="string">"camera_photos"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">paths</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p><files-path>代表的根目录： Context.getFilesDir()</files-path></p>
</li>
<li><p><external-path>代表的根目录: Environment.getExternalStorageDirectory()</external-path></p>
</li>
<li><p><cache-path>代表的根目录: getCacheDir()</cache-path></p>
</li>
</ul>
<h5 id="使用FileProcider"><a href="#使用FileProcider" class="headerlink" title="使用FileProcider"></a>使用FileProcider</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Uri photoURI = FileProvider.getUriForFile(context, <span class="string">"cn.lovexiaoai.myapp.fileprovider"</span>, file);</span><br><span class="line">intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION); <span class="comment">//一定要加上权限申请，添加这一句表示对目标应用临时授权该Uri所代表的文件</span></span><br></pre></td></tr></table></figure>
<h5 id="定义多个provider问题"><a href="#定义多个provider问题" class="headerlink" title="定义多个provider问题"></a>定义多个provider问题</h5><p>Studio uggestion: add ‘tools:replace=”android: authorities”  </p>
<p>在provider里面添加tools:replace=”android: authorities” 属性即可。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/4/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/6/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2018 ShenYonghe
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/smackgg/hexo-theme-smackdown" target="_blank">Smackdown</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="/js/main.js"></script>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js"></script>


  </div>
</body>
</html>