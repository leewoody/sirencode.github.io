<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Diablo</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Diablo">
<meta property="og:url" content="https://github.com/sirencode/page/7/index.html">
<meta property="og:site_name" content="Diablo">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Diablo">
  
    <link rel="alternative" href="/atom.xml" title="Diablo" type="application/atom+xml">
  
  
    <link rel="icon" href="http://7xkj1z.com1.z0.glb.clouddn.com/head.jpg">
  
  <link rel="stylesheet" href="/css/style.css">
  
  

  <script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>
  <script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>

  
</head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://7xkj1z.com1.z0.glb.clouddn.com/head.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">ShenYonghe</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/smackgg/hexo-theme-smackdown">smackdown</a>
			        
			        </div>
				</section>
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">ShenYonghe</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="http://7xkj1z.com1.z0.glb.clouddn.com/head.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">ShenYonghe</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-messenger" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/07/06/messenger/" class="article-date">
  	<time datetime="2017-07-05T16:00:00.000Z" itemprop="datePublished">2017-07-06</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/06/messenger/">
        Messenger 信使
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>Messenger 是用来实现进程间通信的一种方式，具体的通信方式是使用handler - message的方式来实现消息的互发(底层实现和aidl一致，也是通过binder通信)。和AIDL方式相比较使用起来更加便捷，不需要编写晦涩难懂的aild文件。</p>
<p>转载<a href="http://blog.csdn.net/lmj623565791/article/details/47017485" target="_blank" rel="noopener">Android 基于Message的进程间通信 Messenger完全解析</a></p>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><h4 id="Server端"><a href="#Server端" class="headerlink" title="Server端"></a>Server端</h4><p>服务端就一个Service，可以看到代码相当的简单，只需要去声明一个Messenger对象，然后onBind方法返回mMessenger.getBinder().</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessengerService</span> <span class="keyword">extends</span> <span class="title">Service</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MSG_SUM = <span class="number">0x110</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//最好换成HandlerThread的形式</span></span><br><span class="line">    <span class="keyword">private</span> Messenger mMessenger = <span class="keyword">new</span> Messenger(<span class="keyword">new</span> Handler()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msgfromClient)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            Message msgToClient = Message.obtain(msgfromClient);<span class="comment">//返回给客户端的消息</span></span><br><span class="line">            <span class="keyword">switch</span> (msgfromClient.what)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//msg 客户端传来的消息</span></span><br><span class="line">                <span class="keyword">case</span> MSG_SUM:</span><br><span class="line">                    msgToClient.what = MSG_SUM;</span><br><span class="line">                    <span class="keyword">try</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="comment">//模拟耗时</span></span><br><span class="line">                        Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                        msgToClient.arg2 = msgfromClient.arg1 + msgfromClient.arg2;</span><br><span class="line">                        msgfromClient.replyTo.send(msgToClient);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e)</span><br><span class="line">                    &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (RemoteException e)</span><br><span class="line">                    &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">super</span>.handleMessage(msgfromClient);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mMessenger.getBinder();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注册service</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">service</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">".MessengerService"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:enabled</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:exported</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"com.zhy.aidl.calc"</span>&gt;</span><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">service</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h4><p>客户端首先bindService，然后在onServiceConnected中拿到回调的service（IBinder）对象，通过service对象去构造一个mService =new Messenger(service);然后就可以使用mService.send(msg)给服务端了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"MainActivity"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MSG_SUM = <span class="number">0x110</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Button mBtnAdd;</span><br><span class="line">    <span class="keyword">private</span> LinearLayout mLyContainer;</span><br><span class="line">    <span class="comment">//显示连接状态</span></span><br><span class="line">    <span class="keyword">private</span> TextView mTvState;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Messenger mService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isConn;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Messenger mMessenger = <span class="keyword">new</span> Messenger(<span class="keyword">new</span> Handler()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msgFromServer)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">switch</span> (msgFromServer.what)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">case</span> MSG_SUM:</span><br><span class="line">                    TextView tv = (TextView) mLyContainer.findViewById(msgFromServer.arg1);</span><br><span class="line">                    tv.setText(tv.getText() + <span class="string">"=&gt;"</span> + msgFromServer.arg2);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">super</span>.handleMessage(msgFromServer);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ServiceConnection mConn = <span class="keyword">new</span> ServiceConnection()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName name, IBinder service)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            mService = <span class="keyword">new</span> Messenger(service);</span><br><span class="line">            isConn = <span class="keyword">true</span>;</span><br><span class="line">            mTvState.setText(<span class="string">"connected!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceDisconnected</span><span class="params">(ComponentName name)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            mService = <span class="keyword">null</span>;</span><br><span class="line">            isConn = <span class="keyword">false</span>;</span><br><span class="line">            mTvState.setText(<span class="string">"disconnected!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mA;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//开始绑定服务</span></span><br><span class="line">        bindServiceInvoked();</span><br><span class="line"></span><br><span class="line">        mTvState = (TextView) findViewById(R.id.id_tv_callback);</span><br><span class="line">        mBtnAdd = (Button) findViewById(R.id.id_btn_add);</span><br><span class="line">        mLyContainer = (LinearLayout) findViewById(R.id.id_ll_container);</span><br><span class="line"></span><br><span class="line">        mBtnAdd.setOnClickListener(<span class="keyword">new</span> View.OnClickListener()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span></span></span><br><span class="line"><span class="function">            </span>&#123;</span><br><span class="line">                <span class="keyword">try</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">int</span> a = mA++;</span><br><span class="line">                    <span class="keyword">int</span> b = (<span class="keyword">int</span>) (Math.random() * <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//创建一个tv,添加到LinearLayout中</span></span><br><span class="line">                    TextView tv = <span class="keyword">new</span> TextView(MainActivity.<span class="keyword">this</span>);</span><br><span class="line">                    tv.setText(a + <span class="string">" + "</span> + b + <span class="string">" = caculating ..."</span>);</span><br><span class="line">                    tv.setId(a);</span><br><span class="line">                    mLyContainer.addView(tv);</span><br><span class="line"></span><br><span class="line">                    Message msgFromClient = Message.obtain(<span class="keyword">null</span>, MSG_SUM, a, b);</span><br><span class="line">                    msgFromClient.replyTo = mMessenger;</span><br><span class="line">                    <span class="keyword">if</span> (isConn)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="comment">//往服务端发送消息</span></span><br><span class="line">                        mService.send(msgFromClient);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (RemoteException e)</span><br><span class="line">                &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">bindServiceInvoked</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent();</span><br><span class="line">        intent.setAction(<span class="string">"com.zhy.aidl.calc"</span>);</span><br><span class="line">        bindService(intent, mConn, Context.BIND_AUTO_CREATE);</span><br><span class="line">        Log.e(TAG, <span class="string">"bindService invoked !"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        unbindService(mConn);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h3><p>服务端：</p>
<p>服务端的onBind是这么写的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mMessenger.getBinder();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>点进去</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> IBinder <span class="title">getBinder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mTarget.asBinder();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>构造mMessenger对象的代码：new Messenger(new Handler())；</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Messenger</span><span class="params">(Handler target)</span> </span>&#123;</span><br><span class="line">        mTarget = target.getIMessenger();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>继续跟进去</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> IMessenger <span class="title">getIMessenger</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (mQueue) &#123;</span><br><span class="line">            <span class="keyword">if</span> (mMessenger != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> mMessenger;</span><br><span class="line">            &#125;</span><br><span class="line">            mMessenger = <span class="keyword">new</span> MessengerImpl();</span><br><span class="line">            <span class="keyword">return</span> mMessenger;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">MessengerImpl</span> <span class="keyword">extends</span> <span class="title">IMessenger</span>.<span class="title">Stub</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">            msg.sendingUid = Binder.getCallingUid();</span><br><span class="line">            Handler.<span class="keyword">this</span>.sendMessage(msg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>mTarget是一个MessengerImpl对象，那么asBinder实际上是返回this，也就是MessengerImpl对象；</p>
<p>这是个内部类，可以看到继承自IMessenger.Stub，然后实现了一个send方法，该方法就是将接收到的消息通过 Handler.this.sendMessage(msg);发送到handleMessage方法。</p>
<p>看到这，大家有没有想到什么，难道不觉得extends IMessenger.Stub这种写法异常的熟悉么？</p>
<p>我们传统写aidl文件，aapt给我们生成什么，生成IXXX.Stub类，然后我们服务端继承IXXX.Stub实现接口中的方法。</p>
<p>没错，其实这里内部其实也是依赖一个aidl生成的类，这个aidl位于：frameworks/base/core/Java/android/os/IMessenger.aidl。</p>
<p>实际上，就是依赖该aidl文件生成的类，继承了IMessenger.Stub类，实现了send方法，send方法中参数会通过客户端传递过来，最终发送给handler进行处理。</p>
<p>客户端：</p>
<p>客户端首先通过onServiceConnected拿到sevice（Ibinder）对象，这里没什么特殊的，我们平时的写法也是这样的，只不过我们平时会这么写：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IMessenger.Stub.asInterface(service)拿到接口对象进行调用；</span><br></pre></td></tr></table></figure>
<p>而，我们的代码中是</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mService = <span class="keyword">new</span> Messenger(service);</span><br></pre></td></tr></table></figure>
<p>跟进去，你会发现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Messenger</span><span class="params">(IBinder target)</span> </span>&#123;</span><br><span class="line">        mTarget = IMessenger.Stub.asInterface(target);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>到这里就可以明白，客户端与服务端通信，实际上和我们平时的写法没有任何区别，通过编写aidl文件，服务端onBind利用Stub编写接口实现返回；客户端利用回调得到的IBinder对象，使用IMessenger.Stub.asInterface(target)拿到接口实例进行调用.</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-跳转到fragment指定页" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/06/22/跳转到fragment指定页/" class="article-date">
  	<time datetime="2017-06-21T16:00:00.000Z" itemprop="datePublished">2017-06-22</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/22/跳转到fragment指定页/">
        定位跳转到fragment里面的子fragment的页面
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>我们现在的项目大都是，Mainactivity 里面几个tag，每个tag对应一个fragment。而恰巧有的时候在对应的fragment tag 里面还是会有类似外层那种多个tag的情况，而我们有的时候需要在任意位置定位到里面的tag。</p>
<p>比如我们的app MainActivity有4个tag分别是首页，直播，交易，我，每个tag对应一个Fragment进行切换。然而在交易的主fragment里面的页面结构也是多个tag对应多个fragment的形式。这个时候需要准确定位到交易里面的一个tag，比如定位到登录的tag这种情况。</p>
<h3 id="解决问题思路"><a href="#解决问题思路" class="headerlink" title="解决问题思路"></a>解决问题思路</h3><p>基本点：每次MainActivity的tag显隐都会调用onNewIntent方法，我们只需要将跳转命令传到这里(根)进行处理。</p>
<p>痛点：当然最简单的方法就是销毁对应的fragmeng重新新建，并指定位置，这样做内存消耗太大。如过直接调用set位置的方法又不一定会生效，因为这个时候view可能还没有绘制成功。</p>
<p>解决方法：将参数传递到onNewIntent中的intent中，在根activity中对数据进行解析处理。拿到数据后，模拟点击对应的tag,在对应tag的点击事件中获取对应的fragment并进行位置更新。</p>
<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><p>根Activity实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">BaseActivity</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * navigateType intent</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String INTENT_NAVIGATE_TYPE = <span class="string">"navigateType"</span>;</span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String INTENT_NAVIGATE_DATA = <span class="string">"navigate_data"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onNewIntent</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onNewIntent(intent);</span><br><span class="line">        trackStartEvent();</span><br><span class="line">        <span class="keyword">if</span> (hasIntentNavigate(intent)) &#123;</span><br><span class="line">            initNavigateIntent(intent);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">hasIntentNavigate</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> intent != <span class="keyword">null</span> &amp;&amp; intent.hasExtra(INTENT_NAVIGATE_TYPE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initNavigateIntent</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        NavigateType type = (NavigateType) intent.getSerializableExtra(INTENT_NAVIGATE_TYPE);</span><br><span class="line">        intent.removeExtra(INTENT_NAVIGATE_TYPE);</span><br><span class="line">        Parcelable parcelable = intent.getParcelableExtra(INTENT_NAVIGATE_DATA);</span><br><span class="line">        intent.removeExtra(INTENT_NAVIGATE_DATA);</span><br><span class="line"></span><br><span class="line">        navigation(type, parcelable);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置tab</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTabSelected</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        selectedIndex = index;</span><br><span class="line">        homeView.setSelected(index == INDEX_HOME ? <span class="keyword">true</span> : <span class="keyword">false</span>);</span><br><span class="line">        liveView.setSelected(index == INDEX_LIVE ? <span class="keyword">true</span> : <span class="keyword">false</span>);</span><br><span class="line">        quoteView.setSelected(index == INDEX_QUOTE ? <span class="keyword">true</span> : <span class="keyword">false</span>);</span><br><span class="line">        meView.setSelected(index == INDEX_ME ? <span class="keyword">true</span> : <span class="keyword">false</span>);</span><br><span class="line">        tradeView.setSelected(index == INDEX_TRADE ? <span class="keyword">true</span> : <span class="keyword">false</span>);</span><br><span class="line">        switcher.switchToFragment(index);</span><br><span class="line">        updateFragmentData(index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">updateFragmentData</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        Object data = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (index == INDEX_QUOTE) &#123;</span><br><span class="line">            data = quoteView.getTag();</span><br><span class="line">            quoteView.setTag(<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (index == INDEX_TRADE) &#123;</span><br><span class="line">            data = tradeView.getTag();</span><br><span class="line">            tradeView.setTag(<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (data != <span class="keyword">null</span>) &#123;</span><br><span class="line">            IHandleBackFragment fragment = getCurrentFragment();</span><br><span class="line">            <span class="keyword">if</span> (fragment <span class="keyword">instanceof</span> Updatable) &#123;</span><br><span class="line">                ((Updatable) fragment).update(data);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">navigation</span><span class="params">(NavigateType type, Parcelable data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">            <span class="keyword">case</span> HOME:</span><br><span class="line">                homeView.performClick();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> LIVE:</span><br><span class="line">                liveView.performClick();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> QUOTE:</span><br><span class="line">                quoteView.performClick();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> TRADE:</span><br><span class="line">                <span class="keyword">if</span> (data != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    tradeView.setTag(data);</span><br><span class="line">                &#125;</span><br><span class="line">                tradeView.performClick();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> ME:</span><br><span class="line">                meView.performClick();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对应的fragment实现updatable接口,在对应的fragment里面将数据解析，并点模拟点击对应的tag,如果需要再往下传，就继续获取对应的子fragment，并调用update接口。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">ublic <span class="class"><span class="keyword">class</span> <span class="title">TradeMainFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> <span class="keyword">implements</span> <span class="title">Updatable</span></span>&#123;</span><br><span class="line">       <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Object data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (data != <span class="keyword">null</span> &amp;&amp; getView() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            handleIntentData(data);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            intentData = data;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">handleIntentData</span><span class="params">(Object data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (data <span class="keyword">instanceof</span> TradeNavigation) &#123;</span><br><span class="line">            TradeNavigation tradeNavigation = (TradeNavigation) data;</span><br><span class="line">            <span class="keyword">if</span> (tradeNavigation.getPage() &gt; (pageViewAdapter.getCount() - <span class="number">1</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            tradeViewPager.setCurrentItem(tradeNavigation.getPage());</span><br><span class="line">            Fragment fragment = pageViewAdapter.getCurrentItem();</span><br><span class="line">            <span class="keyword">if</span> (fragment <span class="keyword">instanceof</span> Updatable) &#123;</span><br><span class="line">                ((Updatable) fragment).update(data);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-网络传输" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/06/12/网络传输/" class="article-date">
  	<time datetime="2017-06-11T16:00:00.000Z" itemprop="datePublished">2017-06-12</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/12/网络传输/">
        网络传输
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>网络传输五层模型：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/206855-efc1c8d2c47ac859.png?imageView2/2/w/1240/q/100" alt=""></p>
<h4 id="层与协议"><a href="#层与协议" class="headerlink" title="层与协议"></a>层与协议</h4><p>每一层都是为了完成一种功能。为了实现这些功能，就需要大家都遵守共同的规则。大家都遵守的规则，就叫做”协议”（protocol）。</p>
<h4 id="实体层-物理层"><a href="#实体层-物理层" class="headerlink" title="实体层/物理层"></a>实体层/物理层</h4><p>实体层就是把电脑连接起来的物理手段(可以用光缆、电缆、双绞线、无线电波等方式)。它主要规定了网络的一些电气特性，作用是负责传送0和1的电信号。</p>
<h4 id="链接层-链路层"><a href="#链接层-链路层" class="headerlink" title="链接层/链路层"></a>链接层/链路层</h4><p>单纯的0和1没有任何意义，必须规定解读方式：多少个电信号算一组？每个信号位有何意义？这就是”链接层”的功能，它在”实体层”的上方，确定了0和1的分组方式。</p>
<h5 id="以太网协议"><a href="#以太网协议" class="headerlink" title="以太网协议"></a>以太网协议</h5><p>早期的时候，每家公司都有自己的电信号分组方式。逐渐地，一种叫做”以太网”（Ethernet）的协议，占据了主导地位。以太网规定，一组电信号构成一个数据包，叫做”帧”（Frame）。每一帧分成两个部分：标头（Head）和数据（Data）。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/206855-c57bb4ac35d430ff.png?imageView2/2/w/1240/q/100" alt=""></p>
<p>head包含数据包的一些说明项，比如发送者、接受者、数据类型等等；data则是数据包的具体内容。head的长度，固定为18字节。data的长度，最短为46字节，最长为1500字节。因此，整个”帧”最短为64字节，最长为1518字节。如果数据很长，就必须分割成多个帧进行发送。</p>
<h5 id="MAC地址"><a href="#MAC地址" class="headerlink" title="MAC地址"></a>MAC地址</h5><p>MAC地址是发送者和接受者是的标识。网卡的地址，就是数据包的发送地址和接收地址，这叫做MAC地址。每块网卡出厂的时候，都有一个全世界独一无二的MAC地址，长度是48个二进制位，通常用12个十六进制数表示。前6个十六进制数是厂商编号，后6个是该厂商的网卡流水号。</p>
<h5 id="广播"><a href="#广播" class="headerlink" title="广播"></a>广播</h5><p>以太网采用了一种很”原始”的方式，它不是把数据包准确送到接收方，而是向本网络内所有计算机发送，让每台计算机自己判断，是否为接收方。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/206855-064346740c398d0a.png?imageView2/2/w/1240/q/100" alt=""></p>
<p>1号计算机向2号计算机发送一个数据包，同一个子网络的3号、4号、5号计算机都会收到这个包。它们读取这个包的”标头”，找到接收方的MAC地址，然后与自身的MAC地址相比较，如果两者相同，就接受这个包，做进一步处理，否则就丢弃这个包。这种发送方式就叫做”广播”（broadcasting）。</p>
<h4 id="网络层"><a href="#网络层" class="headerlink" title="网络层"></a>网络层</h4><p>以太网采用广播方式发送数据包，所有成员人手一”包”，不仅效率低，而且局限在发送者所在的子网络。也就是说，如果两台计算机不在同一个子网络，广播是传不过去的。这种设计是合理的，否则互联网上每一台计算机都会收到所有包，那会引起灾难。</p>
<p>因此，必须找到一种方法，能够区分哪些MAC地址属于同一个子网络，哪些不是。如果是同一个子网络，就采用广播方式发送，否则就采用”路由”方式发送。这就导致了”网络层”的诞生。它的作用是引进一套新的地址，使得我们能够区分不同的计算机是否属于同一个子网络。这套地址就叫做”网络地址”，简称”网址”。</p>
<p>于是，”网络层”出现以后，每台计算机有了两种地址，一种是MAC地址，另一种是网络地址。两种地址之间没有任何联系，MAC地址是绑定在网卡上的，网络地址则是管理员分配的，它们只是随机组合在一起。网络地址帮助我们确定计算机所在的子网络，MAC地址则将数据包送到该子网络中的目标网卡。因此，从逻辑上可以推断，必定是先处理网络地址，然后再处理MAC地址。</p>
<h5 id="IP协议"><a href="#IP协议" class="headerlink" title="IP协议"></a>IP协议</h5><p>规定网络地址的协议，叫做IP协议。它所定义的地址，就被称为IP地址。</p>
<p>互联网上的每一台计算机，都会分配到一个IP地址。这个地址分成两个部分，前一部分代表网络，后一部分代表主机。比如，IP地址172.16.254.1，这是一个32位的地址，假定它的网络部分是前24位（172.16.254），那么主机部分就是后8位（最后的那个1）。处于同一个子网络的电脑，它们IP地址的网络部分必定是相同的，也就是说172.16.254.2应该与172.16.254.1处在同一个子网络。</p>
<p>但是，问题在于单单从IP地址，我们无法判断网络部分。还是以172.16.254.1为例，它的网络部分，到底是前24位，还是前16位，甚至前28位，从IP地址上是看不出来的。</p>
<p>那么，怎样才能从IP地址，判断两台计算机是否属于同一个子网络呢？这就要用到另一个参数”子网掩码”（subnet mask）。</p>
<p>所谓”子网掩码”，就是表示子网络特征的一个参数。它在形式上等同于IP地址，也是一个32位二进制数字，它的网络部分全部为1，主机部分全部为0。比如，IP地址172.16.254.1，如果已知网络部分是前24位，主机部分是后8位，那么子网络掩码就是11111111.11111111.11111111.00000000，写成十进制就是255.255.255.0。</p>
<p>知道”子网掩码”，我们就能判断，任意两个IP地址是否处在同一个子网络。方法是将两个IP地址与子网掩码分别进行AND运算（两个数位都为1，运算结果为1，否则为0），然后比较结果是否相同，如果是的话，就表明它们在同一个子网络中，否则就不是。</p>
<p>比如，已知IP地址172.16.254.1和172.16.254.233的子网掩码都是255.255.255.0，请问它们是否在同一个子网络？两者与子网掩码分别进行AND运算，结果都是172.16.254.0，因此它们在同一个子网络。</p>
<p>总结一下，IP协议的作用主要有两个，一个是为每一台计算机分配IP地址，另一个是确定哪些地址在同一个子网络。</p>
<h5 id="IP数据包"><a href="#IP数据包" class="headerlink" title="IP数据包"></a>IP数据包</h5><p>IP数据包直接放进以太网数据包的”数据”部分.IP数据包的”标头”部分的长度为20到60字节，整个数据包的总长度最大为65,535字节。因此，理论上，一个IP数据包的”数据”部分，最长为65,515字节。前面说过，以太网数据包的”数据”部分，最长只有1500字节。因此，如果IP数据包超过了1500字节，它就需要分割成几个以太网数据包，分开发送了。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/206855-622e82567f43612f.png?imageView2/2/w/1240/q/100" alt=""></p>
<h5 id="ARP协议"><a href="#ARP协议" class="headerlink" title="ARP协议"></a>ARP协议</h5><p>因为IP数据包是放在以太网数据包里发送的，所以我们必须同时知道两个地址，一个是对方的MAC地址，另一个是对方的IP地址。通常情况下，对方的IP地址是已知的（后文会解释），但是我们不知道它的MAC地址。</p>
<p>所以，我们需要一种机制，能够从IP地址得到MAC地址。</p>
<p>这里又可以分成两种情况。第一种情况，如果两台主机不在同一个子网络，那么事实上没有办法得到对方的MAC地址，只能把数据包传送到两个子网络连接处的”网关”（gateway），让网关去处理。</p>
<p>第二种情况，如果两台主机在同一个子网络，那么我们可以用ARP协议，得到对方的MAC地址。ARP协议也是发出一个数据包（包含在以太网数据包中），其中包含它所要查询主机的IP地址，在对方的MAC地址这一栏，填的是FF:FF:FF:FF:FF:FF，表示这是一个”广播”地址。它所在子网络的每一台主机，都会收到这个数据包，从中取出IP地址，与自身的IP地址进行比较。如果两者相同，都做出回复，向对方报告自己的MAC地址，否则就丢弃这个包。</p>
<p>总之，有了ARP协议之后，我们就可以得到同一个子网络内的主机MAC地址，可以把数据包发送到任意一台主机之上了。</p>
<h4 id="传输层"><a href="#传输层" class="headerlink" title="传输层"></a>传输层</h4><p>有了MAC地址和IP地址，我们已经可以在互联网上任意两台主机上建立通信。</p>
<p>接下来的问题是，同一台主机上有许多程序都需要用到网络，比如，你一边浏览网页，一边与朋友在线聊天。当一个数据包从互联网上发来的时候，你怎么知道，它是表示网页的内容，还是表示在线聊天的内容？</p>
<p>也就是说，我们还需要一个参数，表示这个数据包到底供哪个程序（进程）使用。这个参数就叫做”端口”（port），它其实是每一个使用网卡的程序的编号。每个数据包都发到主机的特定端口，所以不同的程序就能取到自己所需要的数据。</p>
<p>“端口”是0到65535之间的一个整数，正好16个二进制位。0到1023的端口被系统占用，用户只能选用大于1023的端口。不管是浏览网页还是在线聊天，应用程序会随机选用一个端口，然后与服务器的相应端口联系。</p>
<p>“传输层”的功能，就是建立”端口到端口”的通信。相比之下，”网络层”的功能是建立”主机到主机”的通信。只要确定主机和端口，我们就能实现程序之间的交流。因此，Unix系统就把主机+端口，叫做”套接字”（socket）。有了它，就可以进行网络应用程序开发了。</p>
<h4 id="应用层"><a href="#应用层" class="headerlink" title="应用层"></a>应用层</h4><p>应用程序收到”传输层”的数据，接下来就要进行解读。由于互联网是开放架构，数据来源五花八门，必须事先规定好格式，否则根本无法解读。</p>
<p>“应用层”的作用，就是规定应用程序的数据格式。</p>
<p>这是最高的一层，直接面对用户。它的数据就放在TCP数据包的”数据”部分。因此，现在的以太网的数据包就变成下面这样。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/206855-fe25e1016f4034b8.png?imageView2/2/w/1240/q/100" alt=""></p>
<p>实体层(它就是把电脑连接起来的物理手段，作用是负责传送0和1的电信号)-&gt;连接层(确定了0和1的分组方式)-&gt;网络层(区分不同的计算机是否属于同一个子网络,根据ip)-&gt;传输层(就是建立”端口到端口”的通信)-&gt;应用层(规定应用程序的数据格式，www/ftp等)</p>
<h3 id="TCP-IP"><a href="#TCP-IP" class="headerlink" title="TCP/IP"></a>TCP/IP</h3><p>TCP：传输控制协议，面向连接的的协议，稳定可靠。当客户和服务器彼此交换数据前，必须先在双方之间建立一个TCP连接，之后才能传输数据。</p>
<p>UDP：广播式数据传输，UDP不提供可靠性，它只是把应用程序传给IP层的数据报发送出去，但是并不能保证它们能到达目的地。由于UDP在传输数据报前不用在客户和服务器之间建立一个连接，且没有超时重发等机制，故而传输速度很快。</p>
<p>TCP/UDP区别</p>
<p>1.TCP是面向连接的、可靠的、有序的、速度慢的协议；UDP是无连接的、不可靠的、无序的、速度快的协议。</p>
<p>2.TCP开销比UDP大，TCP头部需要20字节，UDP头部只要8个字节。</p>
<p>3.TCP无界有拥塞控制，TCP有界无拥塞控制。（拥塞控制主要是四种方法：慢开始、拥塞避免、快重传、快恢复==这里面有一个拥塞窗口的概念）</p>
<h4 id="三次握手"><a href="#三次握手" class="headerlink" title="三次握手"></a>三次握手</h4><ul>
<li><p>第一次握手：建立连接。客户端发送连接请求报文段，将SYN位置为1，Sequence Number为x；然后，客户端进入SYN_SEND状态，等待服务器的确认。即A发送信息给B</p>
</li>
<li><p>第二次握手：服务器收到客户端的SYN报文段，需要对这个SYN报文段进行确认。即B收到连接信息后向A返回确认信息</p>
</li>
<li><p>第三次握手：客户端收到服务器的（SYN+ACK）报文段，并向服务器发送ACK报文段。即A收到确认信息后再次向B返回确认连接信息</p>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/944365-ca6e707d5bef40fd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h4 id="四次挥手"><a href="#四次挥手" class="headerlink" title="四次挥手"></a>四次挥手</h4><ul>
<li><p>第一次挥手：A发送释放信息到B；（发出去之后，A-&gt;B发送数据这条路径就断了）</p>
</li>
<li><p>第二次挥手：B收到A的释放信息之后，回复确认释放的信息：我同意你的释放连接请求</p>
</li>
<li><p>第三次挥手：B发送“请求释放连接“信息给A</p>
</li>
<li><p>第四次挥手：A收到B发送的信息后向B发送确认释放信息：我同意你的释放连接请求</p>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/944365-a59e6fb7b501f1e9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h3 id="Socket-与-Http-对比"><a href="#Socket-与-Http-对比" class="headerlink" title="Socket 与 Http 对比"></a>Socket 与 Http 对比</h3><p>Socket属于传输层，因为TCP/IP协议属于传输层，解决的是数据如何在网络中传输的问题，HTTP协议属于应用层，解决的是如何包装数据。</p>
<p>Http:采用请求—响应方式。</p>
<p>Socket：采用 服务器主动发送数据 的方式</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-ASNDK开发" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/06/07/ASNDK开发/" class="article-date">
  	<time datetime="2017-06-06T16:00:00.000Z" itemprop="datePublished">2017-06-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/07/ASNDK开发/">
        AS NDK开发
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="配置ndk"><a href="#配置ndk" class="headerlink" title="配置ndk"></a>配置ndk</h3><p>as -&gt; sdk -&gt; ndk下载</p>
<h3 id="配置External-Tools"><a href="#配置External-Tools" class="headerlink" title="配置External Tools"></a>配置External Tools</h3><h4 id="javah"><a href="#javah" class="headerlink" title="javah"></a>javah</h4><p>Program:$JDKPath$/bin/javah</p>
<p>Parameters:-classpath $Classpath$ -v -jni $FileClass$</p>
<p>Working directory:$SourcepathEntry$/../jni</p>
<h4 id="ndk-build"><a href="#ndk-build" class="headerlink" title="ndk-build"></a>ndk-build</h4><p>Program:/Users/Diablo/Library/Android/sdk/ndk-bundle/ndk-build</p>
<p>Parameters:~</p>
<p>Working directory:$ProjectFileDir$/app/src/main</p>
<h4 id="ndk-build-clean"><a href="#ndk-build-clean" class="headerlink" title="ndk-build-clean"></a>ndk-build-clean</h4><p>Program:/Users/Diablo/Library/Android/sdk/ndk-bundle/ndk-build</p>
<p>Parameters:clean</p>
<p>Working directory:$ProjectFileDir$/app/src/main</p>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>local.properties配置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ndk.dir=/Users/Diablo/Library/Android/sdk/ndk-bundle</span><br></pre></td></tr></table></figure>
<p>gradle.properties配置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android.useDeprecatedNdk=<span class="keyword">true</span></span><br></pre></td></tr></table></figure>
<p>app/build配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">defaultConfig &#123;</span><br><span class="line">        ndk &#123;</span><br><span class="line">            moduleName "TradeC"</span><br><span class="line">            stl "stlport_static"</span><br><span class="line">            ldLibs "log"</span><br><span class="line">        &#125;</span><br><span class="line">        sourceSets.main&#123;</span><br><span class="line">            jni.srcDirs = []</span><br><span class="line">            jniLibs.srcDir "src/main/libs"</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>moduleName    模块名称，即编译出来的.so的名字</li>
<li>stl 默认情况下JNI中是无法使用STL标准库的，加入此字段表示使用STL标准库。</li>
<li>ldLibs (#include &lt;android/log.h&gt;)<br>就可以使用__android_log_print方法打印日志到logcat中。</li>
</ul>
<h3 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h3><h4 id="1-新建jni文件夹"><a href="#1-新建jni文件夹" class="headerlink" title="1 新建jni文件夹"></a>1 新建jni文件夹</h4><p>app右键 -&gt; new -&gt; folder -&gt; jni foider</p>
<h4 id="2-新建MyNdk-java"><a href="#2-新建MyNdk-java" class="headerlink" title="2 新建MyNdk.java"></a>2 新建MyNdk.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyNdk</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">"MyLibrary"</span>);    </span><br><span class="line">&#125;   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">getString</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>注：声明jni的方法必须带有native关键字，否则将视为一般的方法。设置native的方法允许为静态/非静态方法（即加或不加static关键字）。</li>
</ul>
<h4 id="3-右键MyNdk-gt-External-Tools-gt-javah"><a href="#3-右键MyNdk-gt-External-Tools-gt-javah" class="headerlink" title="3 右键MyNdk -&gt; External Tools -&gt; javah"></a>3 右键MyNdk -&gt; External Tools -&gt; javah</h4><p>执行后在jni文件夹会自动生成一个包名_MyNdk.h文件，包含了MyNdk.java里面生成的native方法。</p>
<ul>
<li>在右键之前先要build一下项目，才可以右键生成.h文件。</li>
</ul>
<h4 id="4-然后我们在jni目录下编写-MyLibrary-cpp、Android-mk、Application-mk这三个文件"><a href="#4-然后我们在jni目录下编写-MyLibrary-cpp、Android-mk、Application-mk这三个文件" class="headerlink" title="4 然后我们在jni目录下编写 MyLibrary.cpp、Android.mk、Application.mk这三个文件"></a>4 然后我们在jni目录下编写 MyLibrary.cpp、Android.mk、Application.mk这三个文件</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">包名_MyNdk.h</span><br><span class="line"><span class="comment">/* DO NOT EDIT THIS FILE - it is machine generated */</span></span><br><span class="line">#include &lt;jni.h&gt;</span><br><span class="line"><span class="comment">/* Header for class com_zhangyp_higo_myndk_MyNdk */</span></span><br><span class="line"></span><br><span class="line">#ifndef _Included_com_zhangyp_higo_myndk_MyNdk</span><br><span class="line">#define _Included_com_zhangyp_higo_myndk_MyNdk</span><br><span class="line">#ifdef __cplusplus</span><br><span class="line">extern <span class="string">"C"</span> &#123;</span><br><span class="line">#endif</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Class:     com_zhangyp_higo_myndk_MyNdk</span></span><br><span class="line"><span class="comment"> * Method:    getString</span></span><br><span class="line"><span class="comment"> * Signature: ()Ljava/lang/String;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">JNIEXPORT jstring JNICALL Java_com_zhangyp_higo_myndk_MyNdk_getString</span><br><span class="line">  (JNIEnv *, jobject);</span><br><span class="line"></span><br><span class="line">#ifdef __cplusplus</span><br><span class="line">&#125;</span><br><span class="line">#endif</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">MyLibrary.cpp</span><br><span class="line"></span><br><span class="line">#include "com_zhangyp_higo_myndk_MyNdk.h"</span><br><span class="line"></span><br><span class="line">JNIEXPORT jstring JNICALL Java_com_zhangyp_higo_myndk_MyNdk_getString</span><br><span class="line">  (JNIEnv * env, jobject obj)&#123;</span><br><span class="line">   <span class="keyword">return</span> (*env).NewStringUTF(<span class="string">"This is mylibrary !!!"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">Android.mk</span><br><span class="line"></span><br><span class="line">LOCAL_PATH := $(call my-dir)</span><br><span class="line"></span><br><span class="line">include $(CLEAR_VARS)</span><br><span class="line"></span><br><span class="line">LOCAL_MODULE := MyLibrary</span><br><span class="line">LOCAL_SRC_FILES =: MyLibrary.cpp</span><br><span class="line">include $(BUILD_SHARED_LIBRARY)</span><br><span class="line"></span><br><span class="line">Application.mk</span><br><span class="line"></span><br><span class="line">APP_MODULES := MyLibrary</span><br><span class="line">APP_ABI := all</span><br></pre></td></tr></table></figure>
<h4 id="5-生成-so文件，在jni文件夹右键执行ndk-build"><a href="#5-生成-so文件，在jni文件夹右键执行ndk-build" class="headerlink" title="5 生成.so文件，在jni文件夹右键执行ndk-build"></a>5 生成.so文件，在jni文件夹右键执行ndk-build</h4><h4 id="6-使用"><a href="#6-使用" class="headerlink" title="6 使用"></a>6 使用</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> MyNdk().getString()</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-积极心理学-瑜伽篇" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/06/05/积极心理学-瑜伽篇/" class="article-date">
  	<time datetime="2017-06-04T16:00:00.000Z" itemprop="datePublished">2017-06-05</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/05/积极心理学-瑜伽篇/">
        积极心理学-瑜伽篇(晨读)
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="第一章-理解疼痛，消灭它"><a href="#第一章-理解疼痛，消灭它" class="headerlink" title="第一章 理解疼痛，消灭它"></a>第一章 理解疼痛，消灭它</h2><p>瑜伽不仅能帮你缓解慢性疼痛，减轻痛苦，还能帮你把”慢性疼痛反应”变成”慢性愈合反应”，为你带来巨大的能量和喜悦。</p>
<h3 id="疼痛"><a href="#疼痛" class="headerlink" title="疼痛"></a>疼痛</h3><p>疼痛是一种身心相连的过程。疼痛不仅受到身体损伤和疾病的影响，也受想法，情绪，压力的影响。当疼痛变成慢性疼痛的时候，患者的反应就不是健康时的反应了。</p>
<h4 id="疼痛是一种自我保护的反应"><a href="#疼痛是一种自我保护的反应" class="headerlink" title="疼痛是一种自我保护的反应"></a>疼痛是一种自我保护的反应</h4><p><img src="http://oc4zuck5v.bkt.clouddn.com/tengtong.png" alt=""></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-期货" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/06/01/期货/" class="article-date">
  	<time datetime="2017-05-31T16:00:00.000Z" itemprop="datePublished">2017-06-01</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/01/期货/">
        期货
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="结算公式"><a href="#结算公式" class="headerlink" title="结算公式"></a>结算公式</h2><h3 id="结算价"><a href="#结算价" class="headerlink" title="结算价"></a>结算价</h3><p>指当天交易结束后，对未平仓合约进行当日交易保证金及当日盈亏结算的基准价。</p>
<h3 id="开仓"><a href="#开仓" class="headerlink" title="开仓"></a>开仓</h3><p>开仓也称建仓，是指期货交易者新建期货头寸的行为。</p>
<h3 id="结算"><a href="#结算" class="headerlink" title="结算"></a>结算</h3><ul>
<li>若是股指期货，则算式中的价格改为”点数”；”交易单位”改为”合约乘数”</li>
</ul>
<h4 id="结算准备金余额的计算公式"><a href="#结算准备金余额的计算公式" class="headerlink" title="结算准备金余额的计算公式"></a>结算准备金余额的计算公式</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">当日结算准备金余额 = 上一交易日结算准备金余额 + 上一交易日交易保证金 - 当日交易保证金 + 当日盈亏 + 入金 - 出金 - 手续分</span><br></pre></td></tr></table></figure>
<h4 id="当日盈亏的计算公式"><a href="#当日盈亏的计算公式" class="headerlink" title="当日盈亏的计算公式"></a>当日盈亏的计算公式</h4><h5 id="商品期货当日盈亏计算"><a href="#商品期货当日盈亏计算" class="headerlink" title="商品期货当日盈亏计算"></a>商品期货当日盈亏计算</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">当日盈亏 = ∑[(卖出成交价 - 当日结算价) * 卖出量] + ∑[(当日结算价价 - 买入成交价) * 买入量] + (上一交易日结算价 - 当日结算价) * (上一交易日卖出持仓量 - 上一交易日买入持仓量)</span><br></pre></td></tr></table></figure>
<h5 id="股票指数期货交易当日盈亏计算"><a href="#股票指数期货交易当日盈亏计算" class="headerlink" title="股票指数期货交易当日盈亏计算"></a>股票指数期货交易当日盈亏计算</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">当日盈亏 = ∑[(卖出成交价 - 当日结算价) * 卖出手数 * 合约乘数] +∑[(当日结算价 - 买入成交价) * 买入手数 * 合约乘数] + (上一交易日结算价 - 当日结算价) * (上一交易日卖出持仓手数 - 上一交易日买入持仓手数) * 合约乘数</span><br></pre></td></tr></table></figure>
<h4 id="当日交易保证金计算公式"><a href="#当日交易保证金计算公式" class="headerlink" title="当日交易保证金计算公式"></a>当日交易保证金计算公式</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">当日交易保证金 = 当日结算价 * 当日交易结束后的持仓总量 * 交易保证金比例</span><br></pre></td></tr></table></figure>
<h5 id="股票当日交易保证金计算公式"><a href="#股票当日交易保证金计算公式" class="headerlink" title="股票当日交易保证金计算公式"></a>股票当日交易保证金计算公式</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">当日交易保证金 = 当日结算价 * 当日交易结束后的持仓总量 * 交易保证金比例 * 合约乘数</span><br></pre></td></tr></table></figure>
<ul>
<li>注意：股票期货交易计算中，”成交价”与”结算价”均以”点数”表示。</li>
</ul>
<h3 id="期货结算"><a href="#期货结算" class="headerlink" title="期货结算"></a>期货结算</h3><p>分为逐日盯市和逐笔对冲两种结算方式</p>
<h4 id="平仓盈亏"><a href="#平仓盈亏" class="headerlink" title="平仓盈亏"></a>平仓盈亏</h4><h5 id="逐日盯市"><a href="#逐日盯市" class="headerlink" title="逐日盯市"></a>逐日盯市</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">平仓盈亏 = 平当日仓盈亏 + 平历史仓盈亏</span><br><span class="line"></span><br><span class="line">平当日仓盈亏 = ∑[(卖出成交价 - 买入成交价) * 交易单位 * 平仓手数]</span><br><span class="line"></span><br><span class="line">平历史仓盈亏 = ∑[(卖出成交价 - 上日结算价) * 交易单位 * 平仓手数] + ∑[(上日结算价 - 买入成交价) * 交易单位 * 平仓手数]</span><br></pre></td></tr></table></figure>
<h5 id="逐笔对冲"><a href="#逐笔对冲" class="headerlink" title="逐笔对冲"></a>逐笔对冲</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">平当日仓盈亏 = ∑[(卖出成交价 - 买入成交价) * 交易单位 * 平仓手数]</span><br></pre></td></tr></table></figure>
<h4 id="持仓盯市盈亏-逐日盯市"><a href="#持仓盯市盈亏-逐日盯市" class="headerlink" title="持仓盯市盈亏(逐日盯市)"></a>持仓盯市盈亏(逐日盯市)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">持仓当日盈亏 = 当日持仓盈亏 + 历史持仓盈亏</span><br><span class="line"></span><br><span class="line">当日持仓盈亏 = ∑[(卖出成交价 - 当日结算价) * 交易单位 * 卖出手数] + ∑[(当日结算价 - 买入成交价) * 交易单位 * 买入手数]</span><br><span class="line"></span><br><span class="line">历史持仓盈亏 = ∑[(上次结算价 - 当日结算价) * 交易单位 * 卖出手数] + ∑[(当日结算价 - 上日结算价) * 交易单位 * 买入手数]</span><br></pre></td></tr></table></figure>
<h4 id="浮动盈亏"><a href="#浮动盈亏" class="headerlink" title="浮动盈亏"></a>浮动盈亏</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">浮动盈亏 = ∑[(卖出成交价 - 当日结算价) * 交易单位 * 卖出手数] + ∑[(当日结算价 - 买入成交价) * 交易单位 * 买入手数]</span><br></pre></td></tr></table></figure>
<h4 id="当日盈亏"><a href="#当日盈亏" class="headerlink" title="当日盈亏"></a>当日盈亏</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">当日盈亏 = 平仓盈亏(逐日盯市) + 持仓盯市盈利(逐日盯市)</span><br></pre></td></tr></table></figure>
<h4 id="当日结存"><a href="#当日结存" class="headerlink" title="当日结存"></a>当日结存</h4><h5 id="逐日盯市-1"><a href="#逐日盯市-1" class="headerlink" title="逐日盯市"></a>逐日盯市</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">当日结存 = 上日结存(逐日盯市) + 当日盈亏 + 入金 - 出金 - 手续费(等)</span><br></pre></td></tr></table></figure>
<h5 id="逐笔对冲-1"><a href="#逐笔对冲-1" class="headerlink" title="逐笔对冲"></a>逐笔对冲</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">当日结存 = 上日结存(逐笔对冲) + 平仓盈亏(逐笔对冲) + 入金 - 出金 - 手续费(等)</span><br></pre></td></tr></table></figure>
<h4 id="客户权益"><a href="#客户权益" class="headerlink" title="客户权益"></a>客户权益</h4><h5 id="逐日盯市-2"><a href="#逐日盯市-2" class="headerlink" title="逐日盯市"></a>逐日盯市</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">客户权益 = 当日结存(逐日盯市)</span><br></pre></td></tr></table></figure>
<h5 id="逐笔对冲-2"><a href="#逐笔对冲-2" class="headerlink" title="逐笔对冲"></a>逐笔对冲</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">客户权益 = 当日结存(逐笔对冲) + 浮动盈亏</span><br></pre></td></tr></table></figure>
<h3 id="期货及其衍生品"><a href="#期货及其衍生品" class="headerlink" title="期货及其衍生品"></a>期货及其衍生品</h3><h4 id="期货"><a href="#期货" class="headerlink" title="期货"></a>期货</h4><p>期货：通常是指以某种大宗商品或金融资产为标的可交易的标准化合约。<br>根据标的物种类分为商品期货和金融期货，其他期货。</p>
<p>商品期货：标的物为实物商品的期货合约，主要包括农产品期货，金属期货和能源化工期货。<br>金融期货：标的物金融产品，外汇期货，利率期货，股指期货，股票期货。</p>
<h4 id="远期-远期合同-远期合约"><a href="#远期-远期合同-远期合约" class="headerlink" title="远期/远期合同/远期合约"></a>远期/远期合同/远期合约</h4><p>远期：指交易双方约定在未来的某一确定时间，以确定的价格买卖一定数量的某种标的资产合约。</p>
<h4 id="互换"><a href="#互换" class="headerlink" title="互换"></a>互换</h4><p>指两个或两个以上当事人按照商定条件，在约定的时间内交换一系列现金流的合约。</p>
<h4 id="期权"><a href="#期权" class="headerlink" title="期权"></a>期权</h4><p>期权是一种选择的权利，即买方能够在未来的特定事件或者一段时间内按照事先约定的价格买入或者卖出某种约定标的物的权利。</p>
<h3 id="期货及衍生品的主要特征"><a href="#期货及衍生品的主要特征" class="headerlink" title="期货及衍生品的主要特征"></a>期货及衍生品的主要特征</h3><h4 id="合约标准化"><a href="#合约标准化" class="headerlink" title="合约标准化"></a>合约标准化</h4><p>期货合约是由交易所统一制定的标准化合约。</p>
<h4 id="场内集中竞价交易"><a href="#场内集中竞价交易" class="headerlink" title="场内集中竞价交易"></a>场内集中竞价交易</h4><p>期货交易实行场内交易，所有买卖指令必须在交易所内进行集中竞价成交。只有交易所的会员方能进场交易，其他交易者只能委托交易所代理进行期货交易。</p>
<h4 id="保证金交易"><a href="#保证金交易" class="headerlink" title="保证金交易"></a>保证金交易</h4><p>期货交易实行保证金制度。交易者在买卖期货合约时按合约价值的一定比率缴纳保证金(一般为5% - 15%)作为履约保证，即可进行数倍于保证金的交易。这种以大博小的保证金交易，也被称为”杠杆交易”。保证金比率越低，杠杆效应就越大，高收益和高风险的特点就越明显。</p>
<h4 id="双向交易"><a href="#双向交易" class="headerlink" title="双向交易"></a>双向交易</h4><p>交易者既可以买入建仓，即通过买入期货合约开始交易，也可以卖出建仓，即通过卖出期货合约开始交易。双向投资机会，在价格上升时，可通过低买高卖来获利，在货价下降时，可以通过高卖低买来获利。</p>
<h4 id="对冲了解"><a href="#对冲了解" class="headerlink" title="对冲了解"></a>对冲了解</h4><p>交易者在期货市场建仓后，大多并不是通过交割(即交收现货)来结束交易，而是通过对冲了解。通过卖出/买入同一期货合约来解除履约责任。</p>
<h4 id="当日无负债结算-逐日盯市"><a href="#当日无负债结算-逐日盯市" class="headerlink" title="当日无负债结算(逐日盯市)"></a>当日无负债结算(逐日盯市)</h4><p>按当日结算价对交易者结算所有合约的盈亏，交易保证金及手续费，税金等费用，确保无负债。</p>
<h3 id="期货交易"><a href="#期货交易" class="headerlink" title="期货交易"></a>期货交易</h3><h4 id="合约主要条款"><a href="#合约主要条款" class="headerlink" title="合约主要条款"></a>合约主要条款</h4><h5 id="合约名称"><a href="#合约名称" class="headerlink" title="合约名称"></a>合约名称</h5><p>合约品种名称及上市交易所名称。</p>
<h5 id="交易单位-合约价值"><a href="#交易单位-合约价值" class="headerlink" title="交易单位/合约价值"></a>交易单位/合约价值</h5><p>交易单位指交易所交易每手期货合约代表的标的物的数量，”10吨/手”。合约价格指每手期货合约代表的标的物的价值，只能以合约价格整数倍交易，””。</p>
<h5 id="最小变动价位"><a href="#最小变动价位" class="headerlink" title="最小变动价位"></a>最小变动价位</h5><p>交易所公开竞价过程中，对合约 每计量单位报价的最小变动数值。每次报价的变动值必须是最小变动价的整数倍。</p>
<h5 id="报价单位"><a href="#报价单位" class="headerlink" title="报价单位"></a>报价单位</h5><p>指在公开竞价过程中对期货合约报价所使用的单位，即每计量单位的货币价格，”100元/吨”。</p>
<h5 id="每日价格最大波动限制"><a href="#每日价格最大波动限制" class="headerlink" title="每日价格最大波动限制"></a>每日价格最大波动限制</h5><p>每日价格最大波动限制规定了期货合约在一个交易日中的交易价格波动不得高于或者低于规定的涨跌幅度。</p>
<h5 id="合约交割月份"><a href="#合约交割月份" class="headerlink" title="合约交割月份"></a>合约交割月份</h5><p>指某种期货合约到期交割的月份</p>
<h5 id="交易时间"><a href="#交易时间" class="headerlink" title="交易时间"></a>交易时间</h5><p>只能在规定的交易时间内进行交易</p>
<h5 id="最后交易日"><a href="#最后交易日" class="headerlink" title="最后交易日"></a>最后交易日</h5><p>在交割月份中进行交易的最后一个交易日，过了期限必须按规定进行实物交割或现金交割。</p>
<h5 id="交割日期"><a href="#交割日期" class="headerlink" title="交割日期"></a>交割日期</h5><p>指合约标的物所有权进行转移，以实物交割或现金交割方式了结未平仓合约的时间。</p>
<h4 id="交割等级"><a href="#交割等级" class="headerlink" title="交割等级"></a>交割等级</h4><p>合约标的物质量等级</p>
<h5 id="交割地点"><a href="#交割地点" class="headerlink" title="交割地点"></a>交割地点</h5><p>实物交割指定地点</p>
<h5 id="交易手续费"><a href="#交易手续费" class="headerlink" title="交易手续费"></a>交易手续费</h5><p>成交合约金额的一定比例或按成交手数收取费用</p>
<h5 id="交割方式"><a href="#交割方式" class="headerlink" title="交割方式"></a>交割方式</h5><p>实物交割和现金交割。</p>
<h5 id="交易代码"><a href="#交易代码" class="headerlink" title="交易代码"></a>交易代码</h5><p>交易所对每一期货品种都规定了交易代码。</p>
<h4 id="期货市场基本制度"><a href="#期货市场基本制度" class="headerlink" title="期货市场基本制度"></a>期货市场基本制度</h4><h4 id="1-保障金制度"><a href="#1-保障金制度" class="headerlink" title="1 保障金制度"></a>1 保障金制度</h4><h4 id="2-保障金制度一般特点"><a href="#2-保障金制度一般特点" class="headerlink" title="2 保障金制度一般特点"></a>2 保障金制度一般特点</h4><ul>
<li>保障金要求与其面临的风险相对应，风险越大，保障金越高。</li>
<li>交易所根据合约特点设定最低保障金标准。</li>
<li>交易所或结算机构只向其会员收取保证金，会员期货公司向其客户收取保证金。</li>
</ul>
<h4 id="3-当日无负债结算制度"><a href="#3-当日无负债结算制度" class="headerlink" title="3 当日无负债结算制度"></a>3 当日无负债结算制度</h4><p>当天的盈亏进行结算，并进行资金划转。</p>
<h4 id="4-涨跌停板制度"><a href="#4-涨跌停板制度" class="headerlink" title="4 涨跌停板制度"></a>4 涨跌停板制度</h4><h4 id="5-持仓限额及大户报告制度"><a href="#5-持仓限额及大户报告制度" class="headerlink" title="5 持仓限额及大户报告制度"></a>5 持仓限额及大户报告制度</h4><p>持仓额度指交易所规定会员或客户可以持有的，按单位计算的某一合约投机头寸的最大数额。</p>
<p>大户报告制度指当交易所会员或客户某品种某合约持仓达到交易所规定的持仓报告标准时，会员或客户应向交易所报告。</p>
<h4 id="6-强行平仓制度"><a href="#6-强行平仓制度" class="headerlink" title="6 强行平仓制度"></a>6 强行平仓制度</h4><ul>
<li>1 交易保证金不足而强行平仓</li>
<li>2 违反持仓限额制度而实行强行平仓</li>
</ul>
<h4 id="7-信息披露制度"><a href="#7-信息披露制度" class="headerlink" title="7 信息披露制度"></a>7 信息披露制度</h4><ul>
<li>即时行情</li>
<li>持仓量，成交量排名情况</li>
<li>期货交易所交易规则及其实施细规定的其他信息</li>
</ul>
<h3 id="期货交易流程"><a href="#期货交易流程" class="headerlink" title="期货交易流程"></a>期货交易流程</h3><h4 id="开户"><a href="#开户" class="headerlink" title="开户"></a>开户</h4><p>申请开户 -&gt; 阅读”期货交易风险说明书”并签字确认 -&gt; 签署”期货经纪合同书” -&gt; 申请交易编码并确认资金账号</p>
<h4 id="下单"><a href="#下单" class="headerlink" title="下单"></a>下单</h4><p>下单，是指客户在每笔交易前向期货公司业务人员下达交易指令，说明拟买卖合约的种类，数量价格</p>
<h5 id="1市价指令"><a href="#1市价指令" class="headerlink" title="1市价指令"></a>1市价指令</h5><p>按当时市场价格即刻成交的指令，以当时市场上可执行的最好交个达成交易。</p>
<h5 id="2限价指令"><a href="#2限价指令" class="headerlink" title="2限价指令"></a>2限价指令</h5><p>客户必须指明具体的价位，必须按限定的价格或更好的价格成交的指令。</p>
<h5 id="3止损指令"><a href="#3止损指令" class="headerlink" title="3止损指令"></a>3止损指令</h5><p>降到这一价位，出手，防止配的更多。</p>
<h5 id="4停止限价指令"><a href="#4停止限价指令" class="headerlink" title="4停止限价指令"></a>4停止限价指令</h5><p>当价格达到客户预设的触发价时，变为限价指令。</p>
<h5 id="5-触价指令"><a href="#5-触价指令" class="headerlink" title="5 触价指令"></a>5 触价指令</h5><h5 id="6-限时指令"><a href="#6-限时指令" class="headerlink" title="6 限时指令"></a>6 限时指令</h5><h5 id="7-长效指令"><a href="#7-长效指令" class="headerlink" title="7 长效指令"></a>7 长效指令</h5><h5 id="8-套利指令"><a href="#8-套利指令" class="headerlink" title="8 套利指令"></a>8 套利指令</h5><h5 id="9-取消指令"><a href="#9-取消指令" class="headerlink" title="9 取消指令"></a>9 取消指令</h5><h4 id="竞价"><a href="#竞价" class="headerlink" title="竞价"></a>竞价</h4><p>竞价方式主要有公开喊价方式和计算机撮合成交两种方式。</p>
<h3 id="期权-1"><a href="#期权-1" class="headerlink" title="期权"></a>期权</h3><p>期权也称选择权，是指期权的买方有权在约定的期限内。按照事先确定的价格，买入或卖出一定数量某种特定商品或金融指标的权利。</p>
<h4 id="期权基本要素"><a href="#期权基本要素" class="headerlink" title="期权基本要素"></a>期权基本要素</h4><ul>
<li>期权的价格又称权利金，期权费和保险费。</li>
<li>标的资产又称标的物(买入卖出的资产)。</li>
<li>行权方向，买入和卖出两种。</li>
<li>行权方式，指期权合约规定的期权多头可以执行期权的时间，到期日才执行的期权和在期权有效期内的任何时间都可以执行的期权。</li>
<li>执行价格又称履约价格，行权价格。</li>
<li>最后交易日是期权合约能在交易所交易的最后日期。</li>
<li>期权到期日，指期权买方可以执行期权的最后日期。</li>
</ul>
<h4 id="期权交易"><a href="#期权交易" class="headerlink" title="期权交易"></a>期权交易</h4><p>期权交易或买卖的对象是期权合约，买方支付期权费获得期权。在规定的行权期限内，买方可以行使权力买进或卖出标的资产。</p>
<h4 id="建仓和头寸了结"><a href="#建仓和头寸了结" class="headerlink" title="建仓和头寸了结"></a>建仓和头寸了结</h4><p>建仓方向和头寸类型：</p>
<ul>
<li>开仓买入期权，也称建立期权多头头寸，称交易者为期权多头。</li>
<li>开仓卖出期权，也称建立期权空头头寸，称交易者为期权空头。</li>
</ul>
<p>了结期权头寸的方式，期权多头可以通过对冲平仓，行权等方式将期权头寸了结，也可以持有期权至合约到期。当期权多头行权时，空头必须履约，即以履约的方式了结期权头寸。如果多头没有行权，则空头也可以通过对冲平仓了结期权头寸，或持有期权至合约到期。</p>
<h4 id="期权的特点"><a href="#期权的特点" class="headerlink" title="期权的特点"></a>期权的特点</h4><h5 id="买卖双方的权利义务不同"><a href="#买卖双方的权利义务不同" class="headerlink" title="买卖双方的权利义务不同"></a>买卖双方的权利义务不同</h5><p>期权交易是权力的买卖，期权买方支付期权费获得权力，卖方将权力出售给买方从而拥有了履约的义务。</p>
<h5 id="买卖双方的收益和损失特征不同"><a href="#买卖双方的收益和损失特征不同" class="headerlink" title="买卖双方的收益和损失特征不同"></a>买卖双方的收益和损失特征不同</h5><p>买方损失有限，最多为支付的期权费，收益可能很大。卖方最大收益为获得的期权费，损失可能超大。</p>
<h5 id="对买卖双方保证金缴纳的规定不同"><a href="#对买卖双方保证金缴纳的规定不同" class="headerlink" title="对买卖双方保证金缴纳的规定不同"></a>对买卖双方保证金缴纳的规定不同</h5><p>卖方损失巨大，必须缴纳保证金作为履约担保。</p>
<h5 id="独特的非线性损益结构"><a href="#独特的非线性损益结构" class="headerlink" title="独特的非线性损益结构"></a>独特的非线性损益结构</h5><h4 id="期权的基本类型"><a href="#期权的基本类型" class="headerlink" title="期权的基本类型"></a>期权的基本类型</h4><p>按行权时间区分：</p>
<h5 id="美式期权"><a href="#美式期权" class="headerlink" title="美式期权"></a>美式期权</h5><p>指期权买方在期权到期日前的人合计一日都可以形式权力的期权。</p>
<h5 id="欧式期权"><a href="#欧式期权" class="headerlink" title="欧式期权"></a>欧式期权</h5><p>指期权买方只能在期权到期日行使权力的期权。</p>
<p>按行权方向区分：</p>
<h5 id="看涨期权-买权-认购期权"><a href="#看涨期权-买权-认购期权" class="headerlink" title="看涨期权(买权/认购期权)"></a>看涨期权(买权/认购期权)</h5><p>指买方支付合约费从而拥有在合约期限内或特定时间内，安特定价格向期权卖方买入一定数量标的资产的权力。</p>
<h5 id="看跌期权-卖权-认沽期权"><a href="#看跌期权-卖权-认沽期权" class="headerlink" title="看跌期权(卖权/认沽期权)"></a>看跌期权(卖权/认沽期权)</h5><p>按标的资产类型区分：</p>
<h5 id="商品期权"><a href="#商品期权" class="headerlink" title="商品期权"></a>商品期权</h5><h5 id="金融期权"><a href="#金融期权" class="headerlink" title="金融期权"></a>金融期权</h5><p>按市场类型区分：<br>在交易所上市交易的期权成为场内期权也称为交易所期权；在交易所之外交易的期权成为场外期权。</p>
<h5 id="场内期权"><a href="#场内期权" class="headerlink" title="场内期权"></a>场内期权</h5><h5 id="场外期权"><a href="#场外期权" class="headerlink" title="场外期权"></a>场外期权</h5><h4 id="期权价格及影响因素"><a href="#期权价格及影响因素" class="headerlink" title="期权价格及影响因素"></a>期权价格及影响因素</h4><h4 id="期权内涵-内在-价值"><a href="#期权内涵-内在-价值" class="headerlink" title="期权内涵(内在)价值"></a>期权内涵(内在)价值</h4><p>期权内涵价值有无及大小取决于标的物的资产价格与执行价格的关系。</p>
<p>看涨期权的内涵价值 = 标的资产价格 - 执行价格</p>
<p>看跌期权的内涵价值 = 执行价格 - 标的资产价格</p>
<p>根据内涵价值计算结果的不同，可以将期权分为实值期权，虚值期权和平值期权；</p>
<h4 id="实值，平值与虚值期权的关系"><a href="#实值，平值与虚值期权的关系" class="headerlink" title="实值，平值与虚值期权的关系"></a>实值，平值与虚值期权的关系</h4><p><img src="http://oc4zuck5v.bkt.clouddn.com/%E6%9C%9F%E8%B4%A7-%E5%AE%9E%E5%80%BC.png" alt=""></p>
<h4 id="期货的时间价值"><a href="#期货的时间价值" class="headerlink" title="期货的时间价值"></a>期货的时间价值</h4><p>标的资产价格波动率越高，期权的时间价值应该越大。</p>
<p>时间价值 = 权利金 - 内涵价值</p>
<ul>
<li>平值期权和虚值期权的时间价值总是大于等于0.</li>
<li>美式期权的时间价值总是大于等于0.</li>
<li>实值欧式看跌期权的时间价值可能小于0.</li>
</ul>
<h3 id="交易期权的基本策略"><a href="#交易期权的基本策略" class="headerlink" title="交易期权的基本策略"></a>交易期权的基本策略</h3><p>期权交易的最基本策略有买进看涨期权，买进看跌期权，卖出看涨期权，卖出看跌期权四种。</p>
<h4 id="买进看涨期权"><a href="#买进看涨期权" class="headerlink" title="买进看涨期权"></a>买进看涨期权</h4><p>目的：预期价格上涨而买进。</p>
<h5 id="损益分析"><a href="#损益分析" class="headerlink" title="损益分析"></a>损益分析</h5><p>注：C为期权的价格，X为执行价格，S为标的资产价格。</p>
<p>损益平衡点 = X + C </p>
<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><h4 id="期权头寸"><a href="#期权头寸" class="headerlink" title="期权头寸"></a>期权头寸</h4><p>买方：期权的多头。</p>
<p>买方：期权的空头。</p>
<h4 id="期权四种头寸"><a href="#期权四种头寸" class="headerlink" title="期权四种头寸"></a>期权四种头寸</h4><ul>
<li>看跌期权多头</li>
<li>看涨期权多头</li>
<li>看跌期权空头</li>
<li>看涨期权空头</li>
</ul>
<h4 id="标的资产"><a href="#标的资产" class="headerlink" title="标的资产"></a>标的资产</h4><p>股票/货币/指数/期货期权</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-独立思考" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/05/26/独立思考/" class="article-date">
  	<time datetime="2017-05-25T16:00:00.000Z" itemprop="datePublished">2017-05-26</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/26/独立思考/">
        独立思考
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>学习批判性思维，会使你认清很多常人无法辨识的陷阱，也可以加强你的辩论能力。但是要切记，学习批判性思维不是为了赢，而是为了更好接近真理或者追求真理。</p>
<h4 id="SWOT分析"><a href="#SWOT分析" class="headerlink" title="SWOT分析"></a>SWOT分析</h4><ul>
<li>Strength （优势）—— 内部的有利因素</li>
<li>Weakness （劣势）—— 内部的不利因素</li>
<li>Opportunity（机会）—— 外部的有利因素</li>
<li>Threat （威胁）—— 外部的不利因素</li>
</ul>
<p>图片来自网络</p>
<p><img src="http://photocdn.sohu.com/20150708/mp21797287_1436323836502_5.jpeg" alt=""></p>
<h4 id="问题策略"><a href="#问题策略" class="headerlink" title="问题策略"></a>问题策略</h4><p>问题 : 想跳槽，找不到满意的工作。<br>对策 : 找心仪的公司的朋友内推，将简历发送到招聘网站，准备好面试复习。</p>
<h4 id="大部分人思考模式成长的四个过程"><a href="#大部分人思考模式成长的四个过程" class="headerlink" title="大部分人思考模式成长的四个过程"></a>大部分人思考模式成长的四个过程</h4><ul>
<li>1 轻信思维(依赖)</li>
<li>2 盲从思维(从众)</li>
<li>3 愤青思维(逆反)</li>
<li>4 理性思维(成熟)</li>
</ul>
<h4 id="抬杠，辩论不是批判性思维是偏激。一个人的辩论如果不是为了达到某个目的或者真相，只是为了赢，那无论赢多少次也不会成为一个理性的批判性思考者"><a href="#抬杠，辩论不是批判性思维是偏激。一个人的辩论如果不是为了达到某个目的或者真相，只是为了赢，那无论赢多少次也不会成为一个理性的批判性思考者" class="headerlink" title="抬杠，辩论不是批判性思维是偏激。一个人的辩论如果不是为了达到某个目的或者真相，只是为了赢，那无论赢多少次也不会成为一个理性的批判性思考者"></a>抬杠，辩论不是批判性思维是偏激。一个人的辩论如果不是为了达到某个目的或者真相，只是为了赢，那无论赢多少次也不会成为一个理性的批判性思考者</h4><h4 id="自己各阶段事件表"><a href="#自己各阶段事件表" class="headerlink" title="自己各阶段事件表"></a>自己各阶段事件表</h4><p>轻信阶段：18岁之前<br>盲从阶段：22岁之前<br>愤青阶段：26岁之前<br>理性阶段：正在修炼中</p>
<h4 id="思考动作流"><a href="#思考动作流" class="headerlink" title="思考动作流"></a>思考动作流</h4><ul>
<li>1 现在发生了什么，这是真的吗？(记录事实)</li>
<li>2 这真的是与我相关的事吗?(确定影响范围)</li>
<li>3 说服自己与某件事有关或无关是否自欺欺人?(摆脱情感判断)</li>
<li>4 我需要集中尽力来完成这件事吗?(判断事情的紧急度)</li>
<li>5 失败的后果严重吗?(判断事情的重要度)</li>
<li>6 我该如何准备?(构思具体对策，可展开多种不同方法)</li>
<li>7 我如何做才能做得更好?(对自己的对策进行评估)</li>
</ul>
<h4 id="优质思考者特征"><a href="#优质思考者特征" class="headerlink" title="优质思考者特征"></a>优质思考者特征</h4><ul>
<li>1 能找到关进问题和困难，并能清晰准确的表达这些问题。</li>
<li>2 能快速收集大量信息，并用简练的语言表达这些信息。</li>
<li>3 能提出有效的解决方案，并有标准检验是否有效。</li>
<li>4 能在遇到复杂问题时，和他人有效的交换信息。</li>
<li>5 能在遇到阻碍的时候，找到可替代的解决方案，放弃现有选择。</li>
</ul>
<h4 id="搜索能力"><a href="#搜索能力" class="headerlink" title="搜索能力"></a>搜索能力</h4><ul>
<li>1 能够利用互联网快速筛选出自己需要的信息的能力。</li>
<li>2 利用互联网快速辨别信息真伪。</li>
<li>3 保护自己隐私的能力。</li>
</ul>
<h4 id="表达问题"><a href="#表达问题" class="headerlink" title="表达问题"></a>表达问题</h4><ul>
<li>1 我要表达的观点是什么？</li>
<li>2 有哪些资料，数据可以支撑我的观点？</li>
<li>3 这些资料和数据有足够的说服力吗？</li>
<li>4 有哪些资料和数据可以削弱我的观点？</li>
<li>5 有哪些概念和定义需要澄清？</li>
<li>6 我该用什么样的呈现方式表达自己？</li>
<li>7 我呈现的逻辑有误吗？</li>
<li>8 什么样的语气更加合适？会不会太绝对？</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-自控力" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/05/23/自控力/" class="article-date">
  	<time datetime="2017-05-22T16:00:00.000Z" itemprop="datePublished">2017-05-23</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/23/自控力/">
        自控力
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="第一章-我要做，我不要，我想要-什么事意志力？为什么意志力至关重要？"><a href="#第一章-我要做，我不要，我想要-什么事意志力？为什么意志力至关重要？" class="headerlink" title="第一章 我要做，我不要，我想要:什么事意志力？为什么意志力至关重要？"></a>第一章 我要做，我不要，我想要:什么事意志力？为什么意志力至关重要？</h3><p>意志力就是驾驭”我要做，我不要，我想要”这三种力量。</p>
<h4 id="认清两个自我"><a href="#认清两个自我" class="headerlink" title="认清两个自我"></a>认清两个自我</h4><p>冲动的自己和控制的自己的竞争。</p>
<h4 id="训练大脑，增强意志力"><a href="#训练大脑，增强意志力" class="headerlink" title="训练大脑，增强意志力"></a>训练大脑，增强意志力</h4><h4 id="冥想：专心呼吸法"><a href="#冥想：专心呼吸法" class="headerlink" title="冥想：专心呼吸法"></a>冥想：专心呼吸法</h4><ul>
<li>1 原地不动，安静坐好。(冥想时一定不能烦躁)</li>
<li>2 注意你的呼吸。(吸气时在脑海里默念吸，呼气时在脑海里默念呼，走神时，及时调整)</li>
<li>3 感受呼吸，弄清楚自己是怎么走神的。(几分钟后不在默念，去感受空气从鼻子进入在呼出，感觉胸部的起伏)</li>
<li>4 开始时每天坚持5分钟，熟练后可增至10-15分钟。</li>
<li>5 冥想不是让你什么都不想，而是让你不要太分心。</li>
</ul>
<h3 id="第二章-意志力的本能-人生来就能抵制奶酪和蛋糕的诱惑"><a href="#第二章-意志力的本能-人生来就能抵制奶酪和蛋糕的诱惑" class="headerlink" title="第二章 意志力的本能:人生来就能抵制奶酪和蛋糕的诱惑"></a>第二章 意志力的本能:人生来就能抵制奶酪和蛋糕的诱惑</h3><h4 id="通过呼吸实现自控"><a href="#通过呼吸实现自控" class="headerlink" title="通过呼吸实现自控"></a>通过呼吸实现自控</h4><p>将呼吸频率降到每分钟4-6次，也就是每次呼吸用10-15秒。每天20分钟锻炼。</p>
<h4 id="锻炼提高生理上的意志力储备"><a href="#锻炼提高生理上的意志力储备" class="headerlink" title="锻炼提高生理上的意志力储备"></a>锻炼提高生理上的意志力储备</h4><h4 id="足够睡眠"><a href="#足够睡眠" class="headerlink" title="足够睡眠"></a>足够睡眠</h4><h4 id="自控力太强的代价"><a href="#自控力太强的代价" class="headerlink" title="自控力太强的代价"></a>自控力太强的代价</h4><p>长时间的自控就像压力一样，会削弱免疫系统。</p>
<h4 id="恢复意志力"><a href="#恢复意志力" class="headerlink" title="恢复意志力"></a>恢复意志力</h4><ul>
<li>放松：躺下，枕头垫着膝盖，腿稍微抬起。</li>
</ul>
<h3 id="第三章累到无力抵抗-为什么自控力和肌肉一样有极限？"><a href="#第三章累到无力抵抗-为什么自控力和肌肉一样有极限？" class="headerlink" title="第三章累到无力抵抗:为什么自控力和肌肉一样有极限？"></a>第三章累到无力抵抗:为什么自控力和肌肉一样有极限？</h3><p>自控力的消失，24小时没吸烟的人可能大吃一顿冰淇淋，节食的人可能背着配偶偷情。我们只有一定量的意志力，一旦你将它消耗殆尽，你在诱惑面前就会毫无防备力。</p>
<h4 id="自控力就像肌肉一样有极限"><a href="#自控力就像肌肉一样有极限" class="headerlink" title="自控力就像肌肉一样有极限"></a>自控力就像肌肉一样有极限</h4><p>它被使用后会渐渐疲惫，需要时间来恢复。很多你认为不需要意志力的事情，都要依靠这种有限的能量甚至要消耗能量。</p>
<h4 id="意志力波动"><a href="#意志力波动" class="headerlink" title="意志力波动"></a>意志力波动</h4><p>自控力从早上到晚上会逐渐减弱。</p>
<ul>
<li>把重要的事情放在第一位(最早处理)。</li>
</ul>
<h4 id="意志力实验-锻炼意志力"><a href="#意志力实验-锻炼意志力" class="headerlink" title="意志力实验:锻炼意志力"></a>意志力实验:锻炼意志力</h4><ul>
<li>增强”我不要”的力量：不要随便发誓，坐下的时候不要翘脚，用不常用的手进行日常活动，比如吃饭和开门。</li>
<li>增强”我想要”的力量：每天都做一些平时不常做的事。</li>
<li>增强自我监控的能力:认真记录一件你平常不关注的事。</li>
</ul>
<p>发现你的”我想要”的力量，发现自己最重要的”我想要”的力量，也就是你脆弱的时候给你动力的东西。</p>
<h4 id="只要你愿意，你就有意志力"><a href="#只要你愿意，你就有意志力" class="headerlink" title="只要你愿意，你就有意志力"></a>只要你愿意，你就有意志力</h4><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>自控力就像肌肉一样有极限，自控力用得太多会疲倦，但坚持训练能增强自控力。</p>
<h3 id="第四章-容忍罪恶-为何善行之后会有恶性？"><a href="#第四章-容忍罪恶-为何善行之后会有恶性？" class="headerlink" title="第四章 容忍罪恶:为何善行之后会有恶性？"></a>第四章 容忍罪恶:为何善行之后会有恶性？</h3>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-Kotlin" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/05/19/Kotlin/" class="article-date">
  	<time datetime="2017-05-18T16:00:00.000Z" itemprop="datePublished">2017-05-19</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/19/Kotlin/">
        Kotlin
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Kotlin 是一个基于 JVM 的新的编程语言，由 JetBrains 开发。<br>Kotlin可以编译成Java字节码，也可以编译成JavaScript，方便在没有JVM的设备上运行。</p>
<h3 id="使用-Kotlin-进行-Android-开发"><a href="#使用-Kotlin-进行-Android-开发" class="headerlink" title="使用 Kotlin 进行 Android 开发"></a>使用 Kotlin 进行 Android 开发</h3><ul>
<li>兼容性：Kotlin 与 JDK 6 完全兼容，保障了 Kotlin 应用程序可以在较旧的 Android 设备上运行而无任何问题。Kotlin 工具在 Android Studio 中会完全支持，并且兼容 Android 构建系统。</li>
<li>性能：由于非常相似的字节码结构，Kotlin 应用程序的运行速度与 Java 类似。 随着 Kotlin 对内联函数的支持，使用 lambda 表达式的代码通常比用 Java 写的代码运行得更快。</li>
<li>互操作性：Kotlin 可与 Java 进行 100％ 的互操作，允许在 Kotlin 应用程序中使用所有现有的 Android 库 。这包括注解处理，所以数据绑定和 Dagger 也是一样。</li>
<li>占用：Kotlin 具有非常紧凑的运行时库，可以通过使用 ProGuard 进一步减少。 在实际应用程序中，Kotlin 运行时 只增加几百个方法以及 .apk 文件不到 100K 大小。</li>
</ul>
<h3 id="AS中使用"><a href="#AS中使用" class="headerlink" title="AS中使用"></a>AS中使用</h3><h4 id="在主模块中配置-AS3-0中默认支持kotlin语法-："><a href="#在主模块中配置-AS3-0中默认支持kotlin语法-：" class="headerlink" title="在主模块中配置(AS3.0中默认支持kotlin语法)："></a>在主模块中配置(AS3.0中默认支持kotlin语法)：</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: 'kotlin-android'</span><br><span class="line">apply plugin: 'kotlin-android-extensions'</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">compile "org.jetbrains.kotlin:kotlin-stdlib-jre7:$kotlin_version"</span><br></pre></td></tr></table></figure>
<p>kotlin-android-extensions：是一个编译器扩展， 可以让你摆脱代码中的 findViewById() 调用，并将其替换为合成的编译器生成的 属性。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> kotlinx.android.synthetic.main.activity_main.*</span><br><span class="line"><span class="comment">//直接id访问</span></span><br><span class="line">tv_title.text = <span class="string">"hello kotlin"</span></span><br></pre></td></tr></table></figure>
<h4 id="java-转换为kotlin文件"><a href="#java-转换为kotlin文件" class="headerlink" title="java 转换为kotlin文件"></a>java 转换为kotlin文件</h4><p>Main menu -&gt; Code -&gt; Convert Java File to Kotlin File</p>
<p>快捷键：command + alt + shift + K </p>
<h3 id="kotlin-语法"><a href="#kotlin-语法" class="headerlink" title="kotlin 语法"></a>kotlin 语法</h3><h4 id="类和继承"><a href="#类和继承" class="headerlink" title="类和继承"></a>类和继承</h4><p>类声明由类名、类头（指定其类型参数、主 构造函数等）和由大括号包围的类体构成。类头和类体都是可选的； 如果一个类没有类体，可以省略花括号。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//类继承使用关键字 ':'</span></span><br><span class="line"><span class="comment">//类上的 open 标注与 Java 中 final 相反，它允许其他类 从这个类继承。默认情况下，在 Kotlin 中所有的类都是 final</span></span><br><span class="line">open <span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">    open val x: Int get &#123; …… &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Bar1 : Foo() &#123;</span><br><span class="line">    override val x: Int = ……</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Person constructor(firstName: String) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="新建类对象"><a href="#新建类对象" class="headerlink" title="新建类对象"></a>新建类对象</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注意 Kotlin 并没有 new 关键字。</span></span><br><span class="line">val invoice = Invoice()</span><br></pre></td></tr></table></figure>
<h5 id="覆盖方法-属性"><a href="#覆盖方法-属性" class="headerlink" title="覆盖方法/属性"></a>覆盖方法/属性</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">open <span class="class"><span class="keyword">class</span> <span class="title">Base</span> </span>&#123;</span><br><span class="line">    <span class="function">open fun <span class="title">v</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function">fun <span class="title">nv</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">class Derived() : Base() &#123;</span><br><span class="line">    <span class="function">override fun <span class="title">v</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">open <span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">    open val x: Int get &#123; …… &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Bar1 : Foo() &#123;</span><br><span class="line">    override val x: Int = ……</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="数据类"><a href="#数据类" class="headerlink" title="数据类"></a>数据类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用data 关键字自动生成get/set和toString()方法</span></span><br><span class="line"><span class="function">data class <span class="title">UserDto</span><span class="params">(var name: String, var sex: String, var age: Int)</span></span></span><br></pre></td></tr></table></figure>
<h4 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h4><h5 id="函数声明"><a href="#函数声明" class="headerlink" title="函数声明"></a>函数声明</h5><p>Kotlin 中的函数使用 fun 关键字声明</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">fun <span class="title">double</span><span class="params">(x: Int)</span>: Int </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="类型映射"><a href="#类型映射" class="headerlink" title="类型映射"></a>类型映射</h4><p><img src="http://oc4zuck5v.bkt.clouddn.com/kotlin.png" alt=""></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
    <article id="post-gradle 配置信息详解" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/05/09/gradle 配置信息详解/" class="article-date">
  	<time datetime="2017-05-08T16:00:00.000Z" itemprop="datePublished">2017-05-09</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/09/gradle 配置信息详解/">
        gradle 配置信息详解
        
      </a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><p>一个项目有一个setting.gradle、包括一个顶层的 build.gradle文件、每个Module 都有自己的一个build.gradle文件。</p>
<p><img src="http://static.open-open.com/lib/uploadImg/20160902/20160902211134_505.png?_=5855774" alt=""></p>
<h4 id="setting-gradle"><a href="#setting-gradle" class="headerlink" title="setting.gradle"></a>setting.gradle</h4><p>这个setting文件定义了哪些module 应该被加入到编译过程，对于单个module 的项目可以不用需要这个文件，但是对于 multimodule 的项目我们就需要这个文件，否则gradle 不知道要加载哪些项目。这个文件的代码在初始化阶段就会被执行。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">include(':app',</span><br><span class="line">    ':Provider',</span><br><span class="line">    ':data',</span><br><span class="line">    ':Quotation',</span><br><span class="line">    ':Tools',</span><br><span class="line">    ':Notification',</span><br><span class="line">    ':gdt',</span><br><span class="line">    ':im',</span><br><span class="line">    ':BloomplusTradeV3',</span><br><span class="line">    ':easechat',</span><br><span class="line">    ':reddot',</span><br><span class="line">    ':trade')</span><br></pre></td></tr></table></figure>
<h4 id="顶层的build-gradle"><a href="#顶层的build-gradle" class="headerlink" title="顶层的build.gradle"></a>顶层的build.gradle</h4><p>顶层的build.gradle文件的配置最终会被应用到所有项目中。它典型的配置如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        jcenter()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath 'com.android.tools.build:gradle:1.2.3'</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">allprojects&#123;</span><br><span class="line">    repositories&#123;</span><br><span class="line">        jcenter()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Repositories:epositories 就是代码仓库，这个相信大家都知道，我们平时的添加的一些 dependency 就是从这里下载的，Gradle 支持三种类型的仓库：Maven,Ivy和一些静态文件或者文件夹。在编译的执行阶段，gradle 将会从仓库中取出对应需要的依赖文件，当然，gradle 本地也会有自己的缓存，不会每次都去取这些依赖。</li>
<li>buildscript：定义了 Android 编译工具的类路径。repositories中,jCenter是一个著名的 Maven 仓库。</li>
<li>allprojects:中定义的属性会被应用到所有 moudle 中，但是为了保证每个项目的独立性，我们一般不会在这里面操作太多共有的东西。</li>
</ul>
<h4 id="每个项目单独的-build-gradle"><a href="#每个项目单独的-build-gradle" class="headerlink" title="每个项目单独的 build.gradle"></a>每个项目单独的 build.gradle</h4><p>针对每个moudle 的配置，如果这里的定义的选项和顶层build.gradle定义的相同，后者会被覆盖。典型的 配置内容如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    compileSdkVersion globalConfiguration.android.compileSdkVersion</span><br><span class="line">    buildToolsVersion globalConfiguration.android.buildToolsVersion</span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        applicationId globalConfiguration.android.applicationId</span><br><span class="line">        minSdkVersion globalConfiguration.android.minSdkVersion</span><br><span class="line">        targetSdkVersion globalConfiguration.android.targetSdkVersion</span><br><span class="line">        versionCode APP_VERSION_CODE</span><br><span class="line">        versionName APP_VERSION</span><br><span class="line">        manifestPlaceholders = [</span><br><span class="line">                PACKAGE_NAME: globalConfiguration.android.applicationId</span><br><span class="line">        ]</span><br><span class="line">        multiDexEnabled true</span><br><span class="line">        testInstrumentationRunner "android.support.test.runner.AndroidJUnitRunner"</span><br><span class="line">    &#125;</span><br><span class="line">    signingConfigs &#123;</span><br><span class="line">        config &#123;</span><br><span class="line">            keyAlias "YtxAegis"</span><br><span class="line">            keyPassword "ytxaegis"</span><br><span class="line">            storeFile file("../key_store.jks")</span><br><span class="line">            storePassword "ytxaegis"</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        def BOOLEAN = "boolean"</span><br><span class="line">        def TRUE = "true"</span><br><span class="line">        def FALSE = "false"</span><br><span class="line">        def ENV_DEBUG = "ENV_DEBUG"</span><br><span class="line">        def ENABLE_LOG = "ENABLE_LOG"</span><br><span class="line">        def PERFORMANCE_DEBUG = "PERFORMANCE_DEBUG"</span><br><span class="line">        release &#123;</span><br><span class="line">            buildConfigField BOOLEAN, ENV_DEBUG, FALSE</span><br><span class="line">            buildConfigField BOOLEAN, ENABLE_LOG, FALSE</span><br><span class="line">            buildConfigField BOOLEAN, PERFORMANCE_DEBUG, FALSE</span><br><span class="line">            minifyEnabled false</span><br><span class="line">            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'</span><br><span class="line">            signingConfig signingConfigs.config</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        debug &#123;</span><br><span class="line">            buildConfigField BOOLEAN, ENV_DEBUG, TRUE</span><br><span class="line">            buildConfigField BOOLEAN, ENABLE_LOG, TRUE</span><br><span class="line">            buildConfigField BOOLEAN, PERFORMANCE_DEBUG, TRUE</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    lintOptions &#123;</span><br><span class="line">        abortOnError false</span><br><span class="line">    &#125;</span><br><span class="line">    packagingOptions &#123;</span><br><span class="line">        exclude 'lib/arm64-v8a/librealm-jni.so'</span><br><span class="line">        exclude 'lib/mips/librealm-jni.so'</span><br><span class="line">        exclude 'lib/x86_64/librealm-jni.so'</span><br><span class="line">        exclude 'lib/x86/librealm-jni.so'</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    productFlavors &#123;</span><br><span class="line"></span><br><span class="line">        def NORMAL_TYPE = "\"normal_type\""</span><br><span class="line">        def QIHUO_TYPE = "\"qihuo_type\""</span><br><span class="line">        def PRODUCT_TYPE = "PRODUCT_TYPE"</span><br><span class="line">        def STRING = "String"</span><br><span class="line">        normal &#123;</span><br><span class="line">            buildConfigField STRING, PRODUCT_TYPE, NORMAL_TYPE</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        qihuo &#123;</span><br><span class="line">            buildConfigField STRING, PRODUCT_TYPE, QIHUO_TYPE</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile fileTree(include: ['*.jar'], dir: 'libs')</span><br><span class="line"></span><br><span class="line">    androidTestCompile('com.android.support.test.espresso:espresso-core:2.2.2', &#123;</span><br><span class="line">        exclude group: 'com.android.support', module: 'support-annotations'</span><br><span class="line">    &#125;)</span><br><span class="line">    testCompile 'junit:junit:4.12'</span><br><span class="line">    testCompile 'org.mockito:mockito-core:1.10.19'</span><br><span class="line"></span><br><span class="line">    rootProject.dependenciesMethod rootProject.ext.appDps, &#123; type, library, key -&gt;</span><br><span class="line">        if (type == 'compile') &#123;</span><br><span class="line">            compile library</span><br><span class="line">        &#125; else if (type == 'debugCompile') &#123;</span><br><span class="line">            debugCompile library</span><br><span class="line">        &#125; else if (type == 'testCompile') &#123;</span><br><span class="line">            testCompile library</span><br><span class="line">        &#125; else if (type == 'apt') &#123;</span><br><span class="line">            apt library</span><br><span class="line">        &#125; else if (type == 'debuggableReleaseCompile') &#123;</span><br><span class="line">            debuggableReleaseCompile library</span><br><span class="line">        &#125; else if (type == 'debugProCompile') &#123;</span><br><span class="line">            debugProCompile library</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="apply-plugin"><a href="#apply-plugin" class="headerlink" title="apply plugin"></a>apply plugin</h5><p>第一行代码应用了Android 程序的gradle插件，作为Android 的应用程序，这一步是必须的，因为plugin中提供了Android 编译、测试、打包等等的所有task。</p>
<h5 id="android"><a href="#android" class="headerlink" title="android"></a>android</h5><p>这是编译文件中最大的代码块，关于android 的所有特殊配置都在这里，这就是又我们前面的声明的 plugin 提供的。</p>
<ul>
<li>productFlavors:做差异化打包，包括包名，资源等信息的差异化处理。</li>
<li>signingConfigs:签名信息</li>
</ul>
<h5 id="defaultConfig"><a href="#defaultConfig" class="headerlink" title="defaultConfig"></a>defaultConfig</h5><p>就是程序的默认配置，注意，如果在AndroidMainfest.xml里面定义了与这里相同的属性，会以这里的为主。这里最有必要要说明的是applicationId的选项：在我们曾经定义的AndroidManifest.xml中，那里定义的包名有两个用途：一个是作为程序的唯一识别ID,防止在同一手机装两个一样的程序；另一个就是作为我们R资源类的包名。在以前我们修改这个ID会导致所有用引用R资源类的地方都要修改。但是现在我们如果修改applicationId只会修改当前程序的ID,而不会去修改源码中资源文件的引用。</p>
<h5 id="buildTypes"><a href="#buildTypes" class="headerlink" title="buildTypes"></a>buildTypes</h5><p>定义了编译类型，针对每个类型我们可以有不同的编译配置，不同的编译配置对应的有不同的编译命令。默认的有debug、release 的类型。</p>
<h5 id="dependencies"><a href="#dependencies" class="headerlink" title="dependencies"></a>dependencies</h5><p>是属于gradle 的依赖配置。它定义了当前项目需要依赖的其他库。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
      
    
  </div>
  
</article>







  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/6/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><a class="extend next" rel="next" href="/page/8/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2018 ShenYonghe
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/smackgg/hexo-theme-smackdown" target="_blank">Smackdown</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="/js/main.js"></script>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js"></script>


  </div>
</body>
</html>